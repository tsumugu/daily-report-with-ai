import{f as h,j as c,s as g,x as m}from"./chunk-HCRNHK5J.js";import{Gb as u,J as i,M as a,S as o,k as s,na as l,ra as p,v as t}from"./chunk-TUMKYTCV.js";var v=class n{http=o(c);router=o(g);platformId=o(p);apiUrl=`${m.apiUrl}/auth`;currentUserSignal=l(null);currentUser=this.currentUserSignal.asReadonly();isAuthenticated=u(()=>this.currentUserSignal()!==null);signup(e){return this.http.post(`${this.apiUrl}/signup`,e).pipe(i(r=>{this.setToken(r.token),this.currentUserSignal.set(r.user)}),t(this.handleError))}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(i(r=>{this.setToken(r.token),this.currentUserSignal.set(r.user)}),t(this.handleError))}logout(){return this.http.post(`${this.apiUrl}/logout`,{}).pipe(i(()=>{this.clearToken(),this.currentUserSignal.set(null),this.router.navigate(["/login"])}),t(this.handleError))}getMe(){return this.http.get(`${this.apiUrl}/me`).pipe(i(e=>{this.currentUserSignal.set(e)}),t(this.handleError))}isBrowser(){return h(this.platformId)}getToken(){return this.isBrowser()?localStorage.getItem("auth_token"):null}setToken(e){this.isBrowser()&&localStorage.setItem("auth_token",e)}clearToken(){this.isBrowser()&&localStorage.removeItem("auth_token")}handleError(e){return console.error("Auth error:",e),s(()=>e)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=a({token:n,factory:n.\u0275fac,providedIn:"root"})};export{v as a};
