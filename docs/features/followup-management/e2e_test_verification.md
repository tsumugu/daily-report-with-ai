# フォローアップ管理機能 E2Eテスト検証レポート

**作成日**: 2025-12-06  
**作成者**: Eng  
**対象**: followup-management機能のE2Eテスト網羅性検証

---

## 1. 現状確認

### 1.1 既存のE2Eテストファイル

- ✅ `apps/web/e2e/tests/daily-report-input.spec.ts` - 日報入力のE2Eテスト
- ✅ `apps/web/e2e/tests/daily-report-list.spec.ts` - 日報一覧のE2Eテスト
- ❌ **`apps/web/e2e/tests/followup-management.spec.ts` - 未作成**

### 1.2 実装済み機能

以下の機能は実装済みであることを確認：

- ✅ フォロー項目一覧画面 (`/followups`)
- ✅ フォローアップ入力モーダル
- ✅ 週次フォーカスセクション（ホーム画面）
- ✅ フォローアップAPI
- ✅ 週次フォーカスAPI

---

## 2. PRD要件に基づく必須テストケース

### 2.1 フォロー項目一覧画面

#### US-1: フォロー項目の確認

| テストケース                                          | 優先度 | 状態      |
| :---------------------------------------------------- | :----- | :-------- |
| ホーム画面からフォロー項目一覧画面に遷移できること    | 高     | ❌ 未作成 |
| フォロー項目がない場合は空状態が表示されること        | 高     | ❌ 未作成 |
| フォロー項目が一覧に表示されること                    | 高     | ❌ 未作成 |
| デフォルトで未完了（未着手/進行中）のみ表示されること | 高     | ❌ 未作成 |
| 日報日付の降順（新しい順）でソートされていること      | 中     | ❌ 未作成 |

#### US-4: ステータスでのフィルタリング

| テストケース                                              | 優先度 | 状態      |
| :-------------------------------------------------------- | :----- | :-------- |
| ステータスフィルタで「すべて」を選択できること            | 高     | ❌ 未作成 |
| ステータスフィルタで「未着手」を選択できること            | 高     | ❌ 未作成 |
| ステータスフィルタで「進行中」を選択できること            | 高     | ❌ 未作成 |
| ステータスフィルタで「成功」を選択できること              | 高     | ❌ 未作成 |
| ステータスフィルタで「定着」を選択できること              | 中     | ❌ 未作成 |
| ステータスフィルタで「失敗」を選択できること              | 中     | ❌ 未作成 |
| 種別フィルタで「すべて」を選択できること                  | 高     | ❌ 未作成 |
| 種別フィルタで「よかったこと」を選択できること            | 高     | ❌ 未作成 |
| 種別フィルタで「改善点」を選択できること                  | 高     | ❌ 未作成 |
| フィルタ結果が0件の場合、空状態メッセージが表示されること | 中     | ❌ 未作成 |

#### ページング

| テストケース                                       | 優先度 | 状態      |
| :------------------------------------------------- | :----- | :-------- |
| 「もっと見る」ボタンで追加20件を読み込めること     | 高     | ❌ 未作成 |
| 全件表示後、「もっと見る」ボタンが非表示になること | 中     | ❌ 未作成 |

### 2.2 フォローアップ入力

#### US-2: フォローアップ入力（よかったこと）

| テストケース                                                           | 優先度 | 状態      |
| :--------------------------------------------------------------------- | :----- | :-------- |
| フォロー項目カードをクリックするとフォローアップ入力モーダルが開くこと | 高     | ❌ 未作成 |
| よかったことのフォローアップで「未着手」を選択できること               | 高     | ❌ 未作成 |
| よかったことのフォローアップで「進行中」を選択できること               | 高     | ❌ 未作成 |
| よかったことのフォローアップで「再現成功」を選択できること             | 高     | ❌ 未作成 |
| よかったことのフォローアップで「再現できず」を選択できること           | 高     | ❌ 未作成 |
| ステータスが「再現成功」の場合、再現日が必須であること                 | 高     | ❌ 未作成 |
| ステータスが「再現成功」以外の場合、再現日は任意であること             | 中     | ❌ 未作成 |
| 再現メモを入力できること（最大500文字）                                | 高     | ❌ 未作成 |
| 再現メモの文字数カウントが表示されること                               | 中     | ❌ 未作成 |
| フォローアップを保存できること                                         | 高     | ❌ 未作成 |
| 保存成功時にトースト通知が表示されること                               | 高     | ❌ 未作成 |
| 保存後にモーダルが閉じること                                           | 高     | ❌ 未作成 |
| 保存後に一覧が更新されること                                           | 高     | ❌ 未作成 |
| 入力途中でキャンセルすると離脱確認ダイアログが表示されること           | 高     | ❌ 未作成 |
| 入力途中でモーダル外をクリックすると離脱確認ダイアログが表示されること | 中     | ❌ 未作成 |
| 入力内容がない場合、キャンセルでモーダルが閉じること                   | 中     | ❌ 未作成 |

#### US-3: フォローアップ入力（改善点）

| テストケース                                           | 優先度 | 状態      |
| :----------------------------------------------------- | :----- | :-------- |
| 改善点のフォローアップで「未着手」を選択できること     | 高     | ❌ 未作成 |
| 改善点のフォローアップで「進行中」を選択できること     | 高     | ❌ 未作成 |
| 改善点のフォローアップで「完了」を選択できること       | 高     | ❌ 未作成 |
| 改善点のフォローアップで「未達成」を選択できること     | 高     | ❌ 未作成 |
| ステータスが「完了」の場合、完了日が必須であること     | 高     | ❌ 未作成 |
| ステータスが「完了」以外の場合、完了日は任意であること | 中     | ❌ 未作成 |
| 進捗メモを入力できること（最大500文字）                | 高     | ❌ 未作成 |
| 進捗メモの文字数カウントが表示されること               | 中     | ❌ 未作成 |
| 改善点のフォローアップを保存できること                 | 高     | ❌ 未作成 |

### 2.3 成功カウント・定着バッジ

| テストケース                                                                       | 優先度 | 状態      |
| :--------------------------------------------------------------------------------- | :----- | :-------- |
| 成功回数が表示されること（「成功回数: 2回」形式）                                  | 高     | ❌ 未作成 |
| 成功回数が3回以上の場合、定着バッジが表示されること（よかったこと）                | 高     | ❌ 未作成 |
| 成功回数が3回以上の場合、習慣化バッジが表示されること（改善点）                    | 高     | ❌ 未作成 |
| 成功回数が3回未満の場合、定着バッジが表示されないこと                              | 中     | ❌ 未作成 |
| フォローアップ追加後、成功回数がインクリメントされること                           | 高     | ❌ 未作成 |
| 成功回数が3回以上になると、ステータスが自動的に「定着」/「習慣化」に更新されること | 高     | ❌ 未作成 |

### 2.4 週次フォーカス

#### US-5: 週次フォーカスの設定

| テストケース                                                         | 優先度 | 状態      |
| :------------------------------------------------------------------- | :----- | :-------- |
| ホーム画面に週次フォーカスセクションが表示されること                 | 高     | ❌ 未作成 |
| 週次フォーカスが未設定の場合、空状態メッセージが表示されること       | 高     | ❌ 未作成 |
| 「＋追加」ボタンでフォロー項目一覧画面に遷移できること               | 高     | ❌ 未作成 |
| 週次フォーカスが表示されること                                       | 高     | ❌ 未作成 |
| 週次フォーカスカードにステータスバッジが表示されること               | 中     | ❌ 未作成 |
| 週次フォーカスカードに成功回数が表示されること                       | 中     | ❌ 未作成 |
| 週次フォーカスカードの「日報を見る」リンクで日報詳細に遷移できること | 中     | ❌ 未作成 |
| 週次フォーカスを削除できること                                       | 高     | ❌ 未作成 |
| 週次フォーカスは最大5件まで設定できること                            | 高     | ❌ 未作成 |
| 6件目を追加しようとするとエラーが表示されること                      | 中     | ❌ 未作成 |
| 同じ項目を重複して追加しようとするとエラーが表示されること           | 中     | ❌ 未作成 |

### 2.5 日報詳細画面からのフォローアップ入力

| テストケース                                                                       | 優先度 | 状態      |
| :--------------------------------------------------------------------------------- | :----- | :-------- |
| 日報詳細画面で「よかったこと」をクリックするとフォローアップ入力モーダルが開くこと | 高     | ❌ 未作成 |
| 日報詳細画面で「改善点」をクリックするとフォローアップ入力モーダルが開くこと       | 高     | ❌ 未作成 |
| 日報詳細画面からフォローアップを保存後、詳細画面が更新されること                   | 中     | ❌ 未作成 |

### 2.6 エッジケース・エラー処理

#### データ関連

| テストケース                                                          | 優先度 | 状態      |
| :-------------------------------------------------------------------- | :----- | :-------- |
| よかったこと/改善点が0件の場合、空状態メッセージが表示されること      | 高     | ❌ 未作成 |
| フィルタ結果が0件の場合、「該当する項目がありません」が表示されること | 中     | ❌ 未作成 |

#### 操作関連

| テストケース                                    | 優先度 | 状態      |
| :---------------------------------------------- | :----- | :-------- |
| 同じ項目に複数回フォローアップを追加できること  | 高     | ❌ 未作成 |
| ステータスを戻す（完了→進行中）ことができること | 中     | ❌ 未作成 |

#### エラー関連

| テストケース                                                           | 優先度 | 状態      |
| :--------------------------------------------------------------------- | :----- | :-------- |
| ネットワークエラー時にエラーメッセージとリトライボタンが表示されること | 高     | ❌ 未作成 |
| 認証切れ時にログイン画面へリダイレクトされること                       | 高     | ❌ 未作成 |
| サーバーエラー（500）時にエラーメッセージが表示されること              | 中     | ❌ 未作成 |
| バリデーションエラー時にエラーメッセージが表示されること               | 高     | ❌ 未作成 |
| 必須項目未入力時にエラーメッセージが表示されること                     | 高     | ❌ 未作成 |
| 文字数超過時にエラーメッセージが表示されること                         | 中     | ❌ 未作成 |

---

## 3. テストケース網羅性分析

### 3.1 カバレッジ状況

| カテゴリ                           | 必須テスト数 | 推奨テスト数 | 合計   | 未作成数 | カバレッジ |
| :--------------------------------- | :----------- | :----------- | :----- | :------- | :--------- |
| フォロー項目一覧                   | 8            | 4            | 12     | 12       | 0%         |
| フォローアップ入力（よかったこと） | 10           | 6            | 16     | 16       | 0%         |
| フォローアップ入力（改善点）       | 7            | 2            | 9      | 9        | 0%         |
| 成功カウント・定着バッジ           | 5            | 1            | 6      | 6        | 0%         |
| 週次フォーカス                     | 8            | 3            | 11     | 11       | 0%         |
| 日報詳細からの入力                 | 2            | 1            | 3      | 3        | 0%         |
| エッジケース・エラー処理           | 8            | 4            | 12     | 12       | 0%         |
| **合計**                           | **58**       | **21**       | **79** | **79**   | **0%**     |

### 3.2 優先度別分析

| 優先度   | テスト数 | 未作成数 | カバレッジ |
| :------- | :------- | :------- | :--------- |
| 高       | 48       | 48       | 0%         |
| 中       | 31       | 31       | 0%         |
| **合計** | **79**   | **79**   | **0%**     |

---

## 4. 不足しているテストケースの詳細

### 4.1 必須テスト（優先度: 高）

以下の48件のテストケースが未作成です：

1. **フォロー項目一覧画面**
   - ホーム画面からフォロー項目一覧画面に遷移できること
   - フォロー項目がない場合は空状態が表示されること
   - フォロー項目が一覧に表示されること
   - デフォルトで未完了（未着手/進行中）のみ表示されること
   - ステータスフィルタで各オプションを選択できること（5件）
   - 種別フィルタで各オプションを選択できること（3件）
   - 「もっと見る」ボタンで追加20件を読み込めること

2. **フォローアップ入力（よかったこと）**
   - フォロー項目カードをクリックするとフォローアップ入力モーダルが開くこと
   - 各ステータスを選択できること（4件）
   - ステータスが「再現成功」の場合、再現日が必須であること
   - 再現メモを入力できること（最大500文字）
   - フォローアップを保存できること
   - 保存成功時にトースト通知が表示されること
   - 保存後にモーダルが閉じること
   - 保存後に一覧が更新されること
   - 入力途中でキャンセルすると離脱確認ダイアログが表示されること

3. **フォローアップ入力（改善点）**
   - 各ステータスを選択できること（4件）
   - ステータスが「完了」の場合、完了日が必須であること
   - 進捗メモを入力できること（最大500文字）
   - 改善点のフォローアップを保存できること

4. **成功カウント・定着バッジ**
   - 成功回数が表示されること
   - 成功回数が3回以上の場合、定着バッジが表示されること（よかったこと）
   - 成功回数が3回以上の場合、習慣化バッジが表示されること（改善点）
   - フォローアップ追加後、成功回数がインクリメントされること
   - 成功回数が3回以上になると、ステータスが自動的に「定着」/「習慣化」に更新されること

5. **週次フォーカス**
   - ホーム画面に週次フォーカスセクションが表示されること
   - 週次フォーカスが未設定の場合、空状態メッセージが表示されること
   - 「＋追加」ボタンでフォロー項目一覧画面に遷移できること
   - 週次フォーカスが表示されること
   - 週次フォーカスを削除できること
   - 週次フォーカスは最大5件まで設定できること

6. **日報詳細画面からのフォローアップ入力**
   - 日報詳細画面で「よかったこと」をクリックするとフォローアップ入力モーダルが開くこと
   - 日報詳細画面で「改善点」をクリックするとフォローアップ入力モーダルが開くこと

7. **エッジケース・エラー処理**
   - よかったこと/改善点が0件の場合、空状態メッセージが表示されること
   - 同じ項目に複数回フォローアップを追加できること
   - ネットワークエラー時にエラーメッセージとリトライボタンが表示されること
   - 認証切れ時にログイン画面へリダイレクトされること
   - バリデーションエラー時にエラーメッセージが表示されること
   - 必須項目未入力時にエラーメッセージが表示されること

### 4.2 推奨テスト（優先度: 中）

以下の31件のテストケースが未作成です：

1. **フォロー項目一覧画面**
   - 日報日付の降順（新しい順）でソートされていること
   - ステータスフィルタで「定着」を選択できること
   - ステータスフィルタで「失敗」を選択できること
   - フィルタ結果が0件の場合、空状態メッセージが表示されること
   - 全件表示後、「もっと見る」ボタンが非表示になること

2. **フォローアップ入力（よかったこと）**
   - ステータスが「再現成功」以外の場合、再現日は任意であること
   - 再現メモの文字数カウントが表示されること
   - 入力途中でモーダル外をクリックすると離脱確認ダイアログが表示されること
   - 入力内容がない場合、キャンセルでモーダルが閉じること

3. **フォローアップ入力（改善点）**
   - ステータスが「完了」以外の場合、完了日は任意であること
   - 進捗メモの文字数カウントが表示されること

4. **成功カウント・定着バッジ**
   - 成功回数が3回未満の場合、定着バッジが表示されないこと

5. **週次フォーカス**
   - 週次フォーカスカードにステータスバッジが表示されること
   - 週次フォーカスカードに成功回数が表示されること
   - 週次フォーカスカードの「日報を見る」リンクで日報詳細に遷移できること
   - 6件目を追加しようとするとエラーが表示されること
   - 同じ項目を重複して追加しようとするとエラーが表示されること

6. **日報詳細画面からのフォローアップ入力**
   - 日報詳細画面からフォローアップを保存後、詳細画面が更新されること

7. **エッジケース・エラー処理**
   - フィルタ結果が0件の場合、「該当する項目がありません」が表示されること
   - ステータスを戻す（完了→進行中）ことができること
   - サーバーエラー（500）時にエラーメッセージが表示されること
   - 文字数超過時にエラーメッセージが表示されること

---

## 5. 推奨事項

### 5.1 即座に対応すべき項目（優先度: 高）

1. **E2Eテストファイルの作成**
   - `apps/web/e2e/tests/followup-management.spec.ts` を作成
   - 既存のテストファイル（`daily-report-input.spec.ts`, `daily-report-list.spec.ts`）を参考に実装

2. **必須テストケースの実装**
   - 優先度「高」の48件のテストケースを実装
   - 特に以下を優先：
     - フォロー項目一覧画面の基本機能
     - フォローアップ入力モーダルの基本機能
     - 週次フォーカスの基本機能
     - エラーハンドリング

### 5.2 段階的に対応すべき項目（優先度: 中）

1. **推奨テストケースの実装**
   - 優先度「中」の31件のテストケースを実装
   - エッジケースや細かいUI動作のテスト

2. **テストの保守性向上**
   - テストヘルパー関数の作成
   - テストデータの共通化
   - ページオブジェクトパターンの導入（検討）

### 5.3 テスト実装時の注意点

1. **既存テストの形式に合わせる**
   - `test.describe` でテストグループ化
   - `test.beforeEach` で認証・初期化
   - `test` で個別テストケースを記述

2. **セレクタの使用**
   - 既存テストと同様に、クラス名やIDを使用
   - 例: `.followup-list-page`, `.followup-card`, `.followup-input-modal`

3. **非同期処理の待機**
   - `page.waitForSelector()` で要素の出現を待機
   - `page.waitForURL()` でURL遷移を待機
   - `expect().toBeVisible()` で要素の表示を確認

4. **カバレッジの確認**
   - E2Eテスト実行時にカバレッジを収集
   - `coverage/e2e/` に出力されるカバレッジを確認

---

## 6. テスト実装計画

### Phase 1: 基本機能のテスト（優先度: 高）

1. フォロー項目一覧画面の基本機能
   - 画面遷移
   - 一覧表示
   - 空状態表示
   - デフォルトフィルタ

2. フォローアップ入力モーダルの基本機能
   - モーダル表示
   - ステータス選択
   - メモ入力
   - 日付入力（条件付き必須）
   - 保存処理

3. 週次フォーカスの基本機能
   - セクション表示
   - 空状態表示
   - 追加・削除

### Phase 2: フィルタ・ページングのテスト（優先度: 高）

1. ステータスフィルタ
2. 種別フィルタ
3. ページング（「もっと見る」ボタン）

### Phase 3: 成功カウント・定着バッジのテスト（優先度: 高）

1. 成功回数表示
2. 定着バッジ表示
3. 自動ステータス更新

### Phase 4: エラーハンドリングのテスト（優先度: 高）

1. バリデーションエラー
2. ネットワークエラー
3. 認証エラー

### Phase 5: エッジケースのテスト（優先度: 中）

1. 複数回フォローアップ
2. ステータス変更
3. 文字数制限
4. 離脱確認ダイアログ

---

## 7. 結論

### 7.1 現状

- **E2Eテストファイルが未作成**
- **全79件のテストケースが未実装**
- **カバレッジ: 0%**

### 7.2 対応が必要な項目

1. **即座に対応**: E2Eテストファイルの作成と必須テストケース（48件）の実装
2. **段階的に対応**: 推奨テストケース（31件）の実装

### 7.3 推奨アクション

1. `apps/web/e2e/tests/followup-management.spec.ts` を作成
2. Phase 1〜4の必須テストケースを実装
3. Phase 5の推奨テストケースを実装
4. カバレッジを確認し、不足している箇所を補完

---

_本レポートは 2025-12-06 に作成されました。E2Eテスト実装の参考としてご活用ください。_
