# フォローアップ管理機能 PRD

**バージョン**: Phase 2 v1  
**作成日**: 2025-12-06  
**作成者**: PdM  
**ステータス**: Approved  
**承認日**: 2025-12-06  
**承認者**: PdM, Eng, Des

---

## 1. 概要（Why）

### 背景

Phase 1で日報入力・一覧機能を実装したが、記録した「よかったこと」「改善点」が**書きっぱなし**になっている。ユーザーが振り返りを行い、成長を実感するためには、記録した内容を追跡し、再現・達成状況を管理する仕組みが必要。

### 目的

- 「よかったこと」が再現できたかを追跡し、成功パターンを定着させる
- 「改善点」のアクションが実施されたかを追跡し、成長を可視化する
- 書きっぱなしを防ぎ、継続的な振り返り習慣を形成する

### Phase 2 v1 スコープ

| 機能               | Phase 2 v1 | Phase 2 v2 |
| :----------------- | :--------- | :--------- |
| フォローアップ入力 | ✅         | -          |
| フォロー項目一覧   | ✅         | -          |
| ステータス管理     | ✅         | -          |
| UI改善（全体）     | ✅         | -          |
| タグ・要因追加     | -          | ✅         |
| リマインダー通知   | -          | ✅         |

---

## 2. ユーザーストーリー

### US-1: フォロー項目の確認

```
As a ユーザー
I want to 未完了のよかったこと/改善点を一覧で確認したい
So that 何を追跡すべきか把握できる
```

### US-2: フォローアップ入力（よかったこと）

```
As a ユーザー
I want to 「よかったこと」に対して再現できたかを記録したい
So that 成功パターンを定着させ、再現性を高められる
```

### US-3: フォローアップ入力（改善点）

```
As a ユーザー
I want to 「改善点」に対してアクションの進捗を記録したい
So that 改善が実施されたかを追跡し、成長を実感できる
```

### US-4: ステータスでのフィルタリング

```
As a ユーザー
I want to ステータスでフォロー項目を絞り込みたい
So that 対応が必要な項目に集中できる
```

### US-5: 週次フォーカスの設定

```
As a ユーザー
I want to 今週取り組む項目を選択したい
So that 集中して取り組むべき改善点や再現テストが明確になり、実行率が上がる
```

**補足**: 週次フォーカスの追加は、フォロー項目一覧から既存のよかったこと/改善点を選択する方式とする。

---

## 3. 機能要件

### 3.1 フォロー項目一覧

| 項目           | 仕様                                             |
| :------------- | :----------------------------------------------- |
| 表示対象       | 過去に入力した「よかったこと」「改善点」すべて   |
| デフォルト表示 | 未完了（未着手/進行中）のみ表示                  |
| ソート         | 日報日付の降順（新しい順）                       |
| ページング     | 「もっと見る」ボタン（1回20件）                  |
| フィルタ       | ステータス別（すべて/未着手/進行中/完了/未達成） |
| フィルタ       | 種別（すべて/よかったこと/改善点）               |

### 3.2 フォローアップ入力

#### よかったこと

| フィールド | 必須 | 仕様                                                 |
| :--------- | :--- | :--------------------------------------------------- |
| ステータス | ✅   | 未着手/進行中/再現成功/再現できず                    |
| 再現メモ   | -    | どのように再現したか/できなかった理由（500文字以内） |
| 再現日     | -    | 再現した日付（ステータスが「再現成功」の場合は必須） |

#### 改善点

| フィールド | 必須 | 仕様                                             |
| :--------- | :--- | :----------------------------------------------- |
| ステータス | ✅   | 未着手/進行中/完了/未達成                        |
| 進捗メモ   | -    | 実施内容/できなかった理由（500文字以内）         |
| 完了日     | -    | 完了した日付（ステータスが「完了」の場合は必須） |

### 3.3 ステータス定義

#### よかったこと

※ 補足: 各「よかったこと」「改善点」については内部的に `success_count`（成功/達成回数）を保持します。UIには成功回数を表示し、定着判定に利用します。

| ステータス | 説明                                                            | バッジ色 |
| :--------- | :-------------------------------------------------------------- | :------- |
| 未着手     | まだ再現を試みていない                                          | グレー   |
| 進行中     | 再現を試みている最中                                            | 青       |
| 再現成功   | 少なくとも1回再現できた                                         | 緑       |
| 定着       | 複数回（例: 3回以上）再現でき、行動が習慣化・パターン化した状態 | 濃い緑   |
| 再現できず | 再現を試みたができなかった                                      | オレンジ |

#### 改善点

| ステータス | 説明                                              | バッジ色 |
| :--------- | :------------------------------------------------ | :------- |
| 未着手     | まだアクションを開始していない                    | グレー   |
| 進行中     | アクションを実施中                                | 青       |
| 完了       | 期待する成果が得られた（少なくとも1回）           | 緑       |
| 習慣化     | 複数回（例: 3回以上）実施され、行動が定着した状態 | 濃い緑   |
| 未達成     | 実施を試みたが完了できなかった                    | オレンジ |

※ 改善点も `success_count` を保持し、定着判定（習慣化）に利用する。

---

## 4. UI改善（Phase 2 v1）

### 4.1 概要

Phase 1の振り返りで挙がった改善点と、ユーザー体験向上のためのUI改善を実施する。

### 4.2 改善項目（Des と詳細検討）

| 項目                          | 説明                                                                                   | 優先度 |
| :---------------------------- | :------------------------------------------------------------------------------------- | :----- |
| トースト通知                  | 保存成功時のフィードバック表示                                                         | 高     |
| 離脱確認ダイアログ            | 入力途中での離脱時に確認                                                               | 高     |
| 全体的なUI/UXブラッシュアップ | Des主導で改善点を洗い出し                                                              | 中     |
| ローディング表示の改善        | スケルトンローダー等                                                                   | 低     |
| 週次フォーカスUI              | 「今週のフォーカス」を設定・表示するUI（ホーム/Dashboardでの可視化、週次リマインダー） | 高     |
| 成功カウント表示・定着バッジ  | 各項目に成功回数を表示し、定着（定義例: 3回以上）をバッジで示す                        | 高     |

※ 具体的な改善内容は Des と協議のうえ、`ui_design.md` に定義する

---

## 5. 非機能要件

| 項目             | 仕様                                              |
| :--------------- | :------------------------------------------------ |
| レスポンシブ対応 | モバイル/PC両対応                                 |
| パフォーマンス   | 一覧表示は1秒以内                                 |
| アクセシビリティ | キーボード操作対応                                |
| データ整合性     | フォローアップは対象のよかったこと/改善点に紐付く |

---

## 6. 成功基準

| 基準                 | 測定方法                                                               |
| :------------------- | :--------------------------------------------------------------------- |
| フォローアップ入力率 | よかったこと/改善点のうち、1回以上フォローアップされた割合 ≥ 30%       |
| 完了率               | フォローアップされた項目のうち、「再現成功」「完了」になった割合 ≥ 50% |
| ユーザビリティ       | フォローアップ入力が3タップ以内で完了できる                            |
| 定着率               | フォローアップされた項目のうち、`定着`（成功回数≧3）になった割合 ≥ 25% |

---

## 7. エッジケースの洗い出し

### 7.1 データ関連

| ケース                                | 対応                                               |
| :------------------------------------ | :------------------------------------------------- |
| よかったこと/改善点が0件              | 空状態メッセージを表示し、日報入力へ誘導           |
| 対象のよかったこと/改善点が削除された | フォローアップも連動して削除                       |
| 日報が削除された                      | 紐付くよかったこと/改善点/フォローアップも連動削除 |

### 7.2 操作関連

| ケース                          | 対応                       |
| :------------------------------ | :------------------------- |
| フォローアップ入力中に画面離脱  | 離脱確認ダイアログを表示   |
| 同じ項目に複数回フォローアップ  | 許可する（履歴として蓄積） |
| ステータスを戻す（完了→進行中） | 許可する                   |

### 7.3 エラー関連

| ケース                | 対応                                         |
| :-------------------- | :------------------------------------------- |
| ネットワークエラー    | リトライボタン付きエラーメッセージ表示       |
| 認証切れ              | ログイン画面へリダイレクト                   |
| サーバーエラー（500） | 「しばらく経ってから再試行してください」表示 |

---

## 8. メッセージ仕様

### 8.1 成功メッセージ

| 操作               | メッセージ                       |
| :----------------- | :------------------------------- |
| フォローアップ保存 | 「フォローアップを保存しました」 |

### 8.2 エラーメッセージ

| 状況               | メッセージ                                                     |
| :----------------- | :------------------------------------------------------------- |
| 必須項目未入力     | 「{フィールド名}を入力してください」                           |
| 文字数超過         | 「{フィールド名}は{N}文字以内で入力してください」              |
| ネットワークエラー | 「通信エラーが発生しました。再試行してください」               |
| サーバーエラー     | 「エラーが発生しました。しばらく経ってから再試行してください」 |

### 8.3 空状態メッセージ

| 状況            | メッセージ                                                                             |
| :-------------- | :------------------------------------------------------------------------------------- |
| フォロー項目0件 | 「フォローする項目がありません。日報を入力して、よかったことや改善点を記録しましょう」 |
| フィルタ結果0件 | 「該当する項目がありません」                                                           |

---

## 9. 画面遷移図

```
[ホーム]
    │
    ├──→ [日報一覧] ──→ [日報詳細]
    │                       │
    │                       └──→ [フォローアップ入力モーダル]
    │                                    │
    │                                    └──→ [日報詳細（更新後）]
    │
    └──→ [フォロー項目一覧]
              │
              ├──→ [フォローアップ入力モーダル]
              │           │
              │           └──→ [フォロー項目一覧（更新後）]
              │
              └──→ [日報詳細へ遷移]
```

### 遷移詳細

| 操作                                     | 遷移先                          |
| :--------------------------------------- | :------------------------------ |
| ホームで「フォロー項目」メニュー押下     | フォロー項目一覧                |
| 日報詳細で「よかったこと」「改善点」押下 | フォローアップ入力モーダル      |
| フォロー項目一覧でカード押下             | フォローアップ入力モーダル      |
| フォロー項目一覧で日報リンク押下         | 日報詳細                        |
| フォローアップ保存後                     | モーダルを閉じ、一覧/詳細を更新 |

---

## 10. ビジネスルール

| ルール                     | 説明                                                                 |
| :------------------------- | :------------------------------------------------------------------- |
| フォローアップは複数回可能 | 1つのよかったこと/改善点に対して、複数回のフォローアップを記録できる |
| ステータス変更は自由       | 完了→未着手への変更も許可                                            |
| 削除は連動                 | 日報削除時、紐付くデータはすべて削除                                 |
| 再現日/完了日の必須条件    | 「再現成功」「完了」選択時のみ必須                                   |
| メモの文字数上限           | 500文字                                                              |

---

## 11. API設計（概要）

※ 詳細は `tech_spec.md` で定義

| エンドポイント                     | メソッド | 説明                                 |
| :--------------------------------- | :------- | :----------------------------------- |
| `/api/followups`                   | GET      | フォロー項目一覧取得                 |
| `/api/good-points/{id}/followups`  | GET      | よかったことのフォローアップ履歴取得 |
| `/api/good-points/{id}/followups`  | POST     | よかったことにフォローアップ追加     |
| `/api/improvements/{id}/followups` | GET      | 改善点のフォローアップ履歴取得       |
| `/api/improvements/{id}/followups` | POST     | 改善点にフォローアップ追加           |

---

## 12. 他ロールへの依頼

### To Eng

- `tech_spec.md` で以下を定義してください：
  - DBスキーマ（followupsテーブル）
  - API詳細設計
  - フロントエンド状態管理

### To Des

- `ui_design.md` で以下を定義してください：
  - フォロー項目一覧画面のUI
  - フォローアップ入力モーダルのUI
  - UI改善（トースト、離脱確認、全体ブラッシュアップ）の詳細

---

## 13. 関連ドキュメント

| ドキュメント                              | 説明                         |
| :---------------------------------------- | :--------------------------- |
| `docs/general/roadmap.md`                 | Phase 2 の位置付け           |
| `docs/features/daily-report-input/prd.md` | 日報入力機能の仕様           |
| `docs/retro/daily-report-input/retro.md`  | トースト通知等の引き継ぎ事項 |

---

_本PRDは Approved ステータスです。クロスレビュー完了後、2025-12-06 に承認されました。_
