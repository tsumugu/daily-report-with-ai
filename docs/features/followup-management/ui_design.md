# フォローアップ管理機能 UI/UX設計書（UI Design）

**バージョン**: Phase 2 v1  
**作成日**: 2025-12-06  
**作成者**: Des  
**ステータス**: Approved  
**承認日**: 2025-12-06  
**承認者**: PdM, Eng, Des

---

## 1. 概要

フォローアップ管理機能のUI/UX設計方針を定義する。  
日報に記録した「よかったこと」「改善点」を追跡し、再現・達成状況を管理する画面・コンポーネントの設計を記載する。

---

## 2. 画面構成

### 2.1 フォロー項目一覧画面

- ヘッダー：画面タイトル「フォロー項目」、戻るボタン
- フィルタ部：ステータスフィルタ、種別フィルタ
- リスト部：フォロー項目カード一覧
- フッター：ページング（「もっと見る」ボタン）

### 2.2 フォローアップ入力モーダル

- ヘッダー：モーダルタイトル（「よかったことのフォローアップ」/「改善点のフォローアップ」）、閉じるボタン
- フォーム部：ステータス選択、メモ入力、日付入力（条件付き必須）
- フッター：キャンセルボタン、保存ボタン

### 2.3 週次フォーカスセクション（ホーム/Dashboard）

- ヘッダー：セクションタイトル「今週のフォーカス」、追加ボタン
- リスト部：週次フォーカスカード一覧（最大5件）
- 空状態：フォーカス未設定時のメッセージ

---

## 3. UIコンポーネント

### 3.1 フォロー項目一覧画面

| 項目               | コンポーネント     | 備考                                                                          |
| :----------------- | :----------------- | :---------------------------------------------------------------------------- |
| ステータスフィルタ | Select / Tabs      | すべて/未着手/進行中/完了/未達成/定着/習慣化                                  |
| 種別フィルタ       | Select / Tabs      | すべて/よかったこと/改善点                                                    |
| フォロー項目カード | Card               | よかったこと/改善点の情報、ステータスバッジ、成功回数、定着バッジ、日報リンク |
| もっと見るボタン   | Button (Secondary) | ページング用                                                                  |
| 空状態メッセージ   | AlertBanner        | フォロー項目0件時                                                             |

### 3.2 フォローアップ入力モーダル

| 項目             | コンポーネント     | 備考                                                                                 |
| :--------------- | :----------------- | :----------------------------------------------------------------------------------- |
| モーダル         | Dialog             | オーバーレイ付きモーダル                                                             |
| ステータス選択   | Select             | よかったこと: 未着手/進行中/再現成功/再現できず<br>改善点: 未着手/進行中/完了/未達成 |
| メモ入力         | TextareaField      | 再現メモ/進捗メモ、最大500文字、文字数カウンター                                     |
| 日付入力         | DateField          | 条件付き必須（ステータスが「再現成功」「完了」の場合）                               |
| 保存ボタン       | Button (Primary)   | 「保存する」                                                                         |
| キャンセルボタン | Button (Secondary) | 「キャンセル」                                                                       |

### 3.3 週次フォーカスセクション

| 項目             | コンポーネント     | 備考                                  |
| :--------------- | :----------------- | :------------------------------------ |
| 追加ボタン       | Button (Secondary) | 「＋ フォーカスを追加」               |
| フォーカスカード | Card               | よかったこと/改善点の情報、削除ボタン |
| 空状態メッセージ | AlertBanner        | フォーカス未設定時                    |

### 3.4 共通コンポーネント

| 項目               | コンポーネント | 備考                                                      |
| :----------------- | :------------- | :-------------------------------------------------------- |
| ステータスバッジ   | Badge          | ステータスに応じた色（グレー/青/緑/濃い緑/オレンジ）      |
| 定着バッジ         | Badge          | 成功回数3回以上の場合に表示（濃い緑、「定着」「習慣化」） |
| 成功回数表示       | Text           | 「成功回数: 2回」形式で表示                               |
| トースト通知       | Toast          | 保存成功時のフィードバック                                |
| 離脱確認ダイアログ | Dialog         | 入力途中での離脱時に確認                                  |

---

## 4. レイアウト方針

- モバイルファースト設計
- 縦1カラム配置、スクロールで全項目表示
- PC時は中央寄せ・最大幅制限で見やすく
- モーダルは画面中央に配置、オーバーレイで背景を暗く

---

## 5. インタラクション

### 5.1 フォロー項目一覧画面

- フィルタ変更時：即座にフィルタ適用、リストを更新
- カードタップ時：フォローアップ入力モーダルを開く
- 日報リンクタップ時：日報詳細画面へ遷移
- 「もっと見る」ボタン押下時：追加20件を読み込み、リストに追加

### 5.2 フォローアップ入力モーダル

- ステータス変更時：日付フィールドの必須/任意を動的に切り替え
- 保存ボタン押下時：バリデーション → 保存 → トースト通知 → モーダル閉じる → 一覧/詳細を更新
- キャンセルボタン押下時：入力内容がある場合は離脱確認ダイアログ、なければモーダル閉じる
- モーダル外クリック時：離脱確認ダイアログ

### 5.3 週次フォーカスセクション

- 追加ボタン押下時：フォロー項目一覧画面を開き、フォーカスに追加したい項目を選択する方式
- 削除ボタン押下時：確認ダイアログ → 削除 → リスト更新

---

## 6. デザイントークン

### 6.1 カラー

| 用途                          | トークン              | 説明     |
| :---------------------------- | :-------------------- | :------- |
| ステータス: 未着手            | `--color-gray-500`    | グレー   |
| ステータス: 進行中            | `--color-primary-500` | 青       |
| ステータス: 再現成功/完了     | `--color-success`     | 緑       |
| ステータス: 定着/習慣化       | `--color-success-700` | 濃い緑   |
| ステータス: 再現できず/未達成 | `--color-error-500`   | オレンジ |
| エラー表示                    | `--color-error`       | 赤       |
| 背景: オーバーレイ            | `rgba(0, 0, 0, 0.5)`  | 半透明黒 |

### 6.2 スペーシング

- カード間の余白: `1rem` (16px)
- モーダル内のパディング: `1.5rem` (24px)
- フィルタとリスト間の余白: `1rem` (16px)

---

## 7. ワイヤーフレーム

### 7.1 フォロー項目一覧画面

```
┌──────────────────────────┐
│  ← フォロー項目          │
├──────────────────────────┤
│ [すべて ▼] [すべて ▼]    │ ← フィルタ
├──────────────────────────┤
│ ┌────────────────────┐   │
│ │ ✨ よかったこと     │   │
│ │ 内容: チーム会議で...│   │
│ │ [進行中] 成功: 1回  │   │
│ │ 📅 2025-12-05      │   │
│ │ [日報を見る]        │   │
│ └────────────────────┘   │
│ ┌────────────────────┐   │
│ │ 📝 改善点           │   │
│ │ 内容: 朝の準備を... │   │
│ │ [未着手] 成功: 0回  │   │
│ │ 📅 2025-12-04      │   │
│ │ [日報を見る]        │   │
│ └────────────────────┘   │
├──────────────────────────┤
│    [ もっと見る ]        │
└──────────────────────────┘
```

### 7.2 フォローアップ入力モーダル（よかったこと）

```
┌──────────────────────────┐
│ よかったことのフォローアップ  ×│
├──────────────────────────┤
│ ■ ステータス *（必須）    │
│ [進行中 ▼]               │
├──────────────────────────┤
│ ■ 再現メモ               │
│ ┌────────────────────┐   │
│ │ どのように再現したか...│   │
│ └────────────────────┘   │
│                    0/500 │
├──────────────────────────┤
│ ■ 再現日                 │
│ [2025-12-10 ▼]          │
│ ※ ステータスが「再現成功」│
│    の場合は必須          │
├──────────────────────────┤
│ [ キャンセル ] [ 保存する ]│
└──────────────────────────┘
```

### 7.3 週次フォーカスセクション（ホーム/Dashboard）

```
┌──────────────────────────┐
│ 今週のフォーカス  [＋追加] │
├──────────────────────────┤
│ ┌────────────────────┐   │
│ │ ✨ よかったこと     │   │
│ │ 内容: チーム会議で...│   │
│ │ [進行中] 成功: 1回  │   │
│ │                    [×]│   │
│ └────────────────────┘   │
│ ┌────────────────────┐   │
│ │ 📝 改善点           │   │
│ │ 内容: 朝の準備を... │   │
│ │ [未着手] 成功: 0回  │   │
│ │                    [×]│   │
│ └────────────────────┘   │
└──────────────────────────┘
```

---

## 8. 状態別表示

### 8.1 初期状態

- フォロー項目一覧：デフォルトで未完了（未着手/進行中）のみ表示
  - ステータスフィルタの初期値は「未完了」を選択状態
  - 種別フィルタの初期値は「すべて」を選択状態
- 週次フォーカス：今週のフォーカスのみ表示

### 8.2 ローディング状態

- フォロー項目一覧：スケルトンローダーまたはスピナー表示
- フォローアップ保存中：保存ボタン非活性 + スピナー表示
- 週次フォーカス読み込み中：スケルトンローダー

### 8.3 成功状態

- フォローアップ保存完了：トースト通知「フォローアップを保存しました」→ モーダル閉じる → 一覧/詳細を更新
- 週次フォーカス追加完了：トースト通知「フォーカスを追加しました」→ リスト更新

### 8.4 エラー状態

- バリデーションエラー：該当フィールド下に赤字メッセージ表示
- 必須未入力：フィールド枠を赤色に、エラーメッセージ表示
- ネットワークエラー：AlertBannerでエラーメッセージ表示、リトライボタン付き
- サーバーエラー：AlertBannerでエラーメッセージ表示

### 8.5 空状態

- フォロー項目0件：
  ```
  ┌──────────────────────────┐
  │ ⚠️ フォローする項目が     │
  │    ありません            │
  │                          │
  │ 日報を入力して、よかった  │
  │ ことや改善点を記録       │
  │ しましょう               │
  │                          │
  │ [ 日報を書く ]           │
  └──────────────────────────┘
  ```
- フィルタ結果0件：
  ```
  ┌──────────────────────────┐
  │ 該当する項目がありません  │
  └──────────────────────────┘
  ```
- 週次フォーカス未設定：
  ```
  ┌──────────────────────────┐
  │ 今週のフォーカスが       │
  │ 設定されていません       │
  │                          │
  │ [＋ フォーカスを追加]    │
  └──────────────────────────┘
  ```

---

## 9. UI改善（Phase 2 v1）

### 9.1 トースト通知

**実装方針**:

- 画面右上に表示（モバイル時は上部中央）
- 自動的に3秒後に非表示
- アニメーション：フェードイン/フェードアウト

**使用コンポーネント**:

- 新規コンポーネント `Toast` を作成
- Storybookに登録

**表示例**:

```
┌──────────────────────────┐
│                          │
│  ┌──────────────────┐   │
│  │ ✓ フォローアップを  │   │
│  │   保存しました      │   │
│  └──────────────────┘   │
│                          │
└──────────────────────────┘
```

### 9.2 離脱確認ダイアログ

**実装方針**:

- フォローアップ入力モーダルで入力途中に離脱しようとした場合に表示
- 確認メッセージ + 「キャンセル」「離脱する」ボタン

**使用コンポーネント**:

- 既存の `Dialog` コンポーネントを活用
- `canDeactivate` ガードで実装

**表示例**:

```
┌──────────────────────────┐
│ 入力内容が失われます      │
│                          │
│ 入力内容を保存せずに      │
│ 離脱しますか？            │
│                          │
│ [ キャンセル ] [ 離脱する ]│
└──────────────────────────┘
```

### 9.3 成功カウント表示・定着バッジ

**実装方針**:

- 各フォロー項目カードに成功回数を表示（「成功回数: 2回」形式）
- `success_count >= 3` の場合、定着バッジを表示（「定着」「習慣化」）

**表示例**:

```
┌──────────────────────────┐
│ ✨ よかったこと           │
│ 内容: ...                │
│ [進行中] 成功: 2回       │ ← 成功回数表示
│                          │
└──────────────────────────┘

┌──────────────────────────┐
│ ✨ よかったこと           │
│ 内容: ...                │
│ [定着] 成功: 3回          │ ← 定着バッジ
│                          │
└──────────────────────────┘
```

### 9.4 全体的なUI/UXブラッシュアップ

**改善項目**:

- カードのホバー効果：軽いシャドウ追加
- ボタンのホバー/アクティブ状態の視覚的フィードバック強化
- ローディング表示の改善：スケルトンローダーの導入
- アニメーション：モーダルの開閉、トーストの表示にトランジション追加

---

## 10. アクセシビリティ

- キーボード操作対応：Tabでフィールド間を移動、Enterで保存、Escでモーダル閉じる
- フォーカス状態の視覚的フィードバック：`:focus-visible` でフォーカスリング表示
- エラーメッセージの関連付け：`aria-describedby` でフォームフィールドとエラーメッセージを関連付け
- モーダル開閉時のフォーカス管理：モーダル開閉時に適切な要素にフォーカスを移動

---

## 11. レスポンシブ対応

### 11.1 モバイル（< 768px）

- フィルタ：縦並び、全幅表示
- カード：全幅、パディング調整
- モーダル：全画面表示（または画面幅いっぱい）
- トースト：上部中央に表示

### 11.2 PC（≥ 768px）

- フィルタ：横並び、適切な幅
- カード：最大幅制限、中央寄せ
- モーダル：中央配置、適切な幅（例: 600px）
- トースト：右上に表示

---

## 12. 使用コンポーネント一覧

### 既存コンポーネント（再利用）

- `Button` (Primary, Secondary)
- `TextareaField`
- `DateField`
- `AlertBanner`
- `Card` (既存のReportCardを参考に新規作成)

### 新規コンポーネント（作成が必要）

- `FollowupCard` - フォロー項目カード
- `FollowupInputModal` - フォローアップ入力モーダル
- `WeeklyFocusCard` - 週次フォーカスカード
- `WeeklyFocusSection` - 週次フォーカスセクション
- `Toast` - トースト通知
- `StatusBadge` - ステータスバッジ（汎用化）

---

## 13. Storybook登録

以下のコンポーネントをStorybookに登録する：

1. `FollowupCard` - 各ステータス、定着バッジ有無のバリエーション
2. `FollowupInputModal` - よかったこと/改善点のバリエーション
3. `WeeklyFocusCard` - 各ステータスのバリエーション
4. `WeeklyFocusSection` - 空状態、通常状態のバリエーション
5. `Toast` - 成功/エラーのバリエーション
6. `StatusBadge` - 各ステータスのバリエーション

---

## 14. 実装ファイル

### フロントエンド

- `apps/web/src/app/features/followup/`
  - `pages/followup-list-page/` - フォロー項目一覧画面
  - `components/followup-input-modal/` - フォローアップ入力モーダル
  - `components/followup-card/` - フォロー項目カード
- `apps/web/src/app/shared/components/`
  - `toast/` - トースト通知コンポーネント
  - `status-badge/` - ステータスバッジコンポーネント
  - `weekly-focus-section/` - 週次フォーカスセクション
  - `weekly-focus-card/` - 週次フォーカスカード

---

## 15. 補足

- デザイントークンは `src/styles/tokens/_colors.scss` を参照
- 既存コンポーネントは `shared/components/` を確認してから新規作成を検討
- モーダルの開閉は `@angular/cdk/dialog` を活用
- トースト通知はグローバルサービスとして実装

---

※ 要件は `prd.md`、技術設計は `tech_spec.md` 参照
