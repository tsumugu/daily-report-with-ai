# フォローアップ動作改善 要件定義書（PRD）

**バージョン**: Phase 2 v2  
**作成日**: 2025-12-10  
**作成者**: PdM  
**ステータス**: Pending  
**承認日**: -  
**承認者**: -

---

## 1. 概要（Why）

### 背景

現在のフォローアップ機能では、ユーザーが手動でステータスを選択する必要があり、複数のエピソードやアクションを記録する際に手間がかかる。また、ステータスの判定がユーザーの主観に依存しており、一貫性が保ちにくい。

### 目的

- エピソード/アクションを複数登録できるようにし、記録の負担を軽減する
- 登録数に基づいて自動的にステータスを判定し、一貫性を保つ
- ユーザーがより簡単にフォローアップを記録できるようにする

---

## 2. ユーザーストーリー

### US-1: よかったことの再現エピソードを複数記録したい

```
As a ユーザー
I want to よかったことに対して再現できたエピソードを複数登録したい
So that 再現性の高さを定量的に把握できる
```

### US-2: 改善点のアクションを複数記録したい

```
As a ユーザー
I want to 改善点に対して実施したアクションを複数登録したい
So that 改善の進捗を定量的に把握できる
```

### US-3: ステータスを自動判定してほしい

```
As a ユーザー
I want to 登録数に応じてステータスが自動的に更新される
So that 手動でのステータス管理が不要になり、記録に集中できる
```

### US-4: ホーム画面から直接フォローアップを入力したい

```
As a ユーザー
I want to 今週のフォーカスカードから直接フォローアップを入力したい
So that ホーム画面にいながらフォローアップを記録できる
```

---

## 3. 機能要件

### 3.1 よかったことのフォローアップ改善

#### 3.1.1 エピソード登録機能

| 項目           | 仕様                                           |
| :------------- | :--------------------------------------------- |
| 登録方法       | 再現性を持たせられたエピソードを複数登録できる |
| エピソード情報 | 再現日、再現メモ（500文字以内）                |
| 表示           | 登録されたエピソードを一覧で表示               |

#### 3.1.2 ステータス自動判定

| エピソード数 | ステータス | 説明                        |
| :----------- | :--------- | :-------------------------- |
| 0件          | 未着手     | まだ再現を試みていない      |
| 1件以上      | 進行中     | 再現を試みている最中        |
| 閾値以上     | 再現成功   | 閾値（初期値: 3回）を超えた |

**閾値設定**:

- 初期値: 3回（固定）
- 将来的に設定可能にすることを検討（Phase 3以降）

#### 3.1.3 既存機能との互換性

- 既存のフォローアップデータとの互換性を保つ
- 既存の「再現成功」ステータスは維持される
- `success_count`はエピソード数と連動する

### 3.2 改善点のフォローアップ改善

#### 3.2.1 アクション登録機能

| 項目           | 仕様                                           |
| :------------- | :--------------------------------------------- |
| 登録方法       | 課題に対して実施したアクションを複数登録できる |
| アクション情報 | 完了日、進捗メモ（500文字以内）                |
| 表示           | 登録されたアクションを一覧で表示               |

#### 3.2.2 ステータス自動判定

| アクション数 | ステータス | 説明                           |
| :----------- | :--------- | :----------------------------- |
| 0件          | 未着手     | まだアクションを開始していない |
| 1件以上      | 進行中     | アクションを実施中             |
| 閾値以上     | 完了       | 閾値（初期値: 3回）を超えた    |

**閾値設定**:

- 初期値: 3回（固定）
- 将来的に設定可能にすることを検討（Phase 3以降）

#### 3.2.3 既存機能との互換性

- 既存のフォローアップデータとの互換性を保つ
- 既存の「完了」ステータスは維持される
- `success_count`はアクション数と連動する

### 3.3 週次フォーカスカードへのフォローアップボタン追加

#### 3.3.1 機能概要

ホーム画面の「今週のフォーカス」セクションに表示される週次フォーカスカードに、フォローアップボタンを追加する。

#### 3.3.2 UI要件

| 項目           | 仕様                                                             |
| :------------- | :--------------------------------------------------------------- |
| ボタン配置     | フォロー項目カードと同じレイアウト（フッターのアクションエリア） |
| ボタンスタイル | フォロー項目カードと同じ（variant="outline", size="sm"）         |
| ボタンラベル   | 「フォローアップ」                                               |
| カードデザイン | フォロー項目カードと統一されたデザイン                           |

#### 3.3.3 動作仕様

- 週次フォーカスカードの「フォローアップ」ボタンをクリックすると、フォローアップ入力モーダルが開く
- モーダル内での動作は、フォロー項目一覧画面と同様（エピソード/アクションの複数登録、ステータス自動判定）
- フォローアップ入力後、週次フォーカスカードのステータス表示が自動的に更新される

#### 3.3.4 既存機能との統合

- 週次フォーカスカードとフォロー項目カードで、同じフォローアップ入力モーダルを使用
- 週次フォーカスカードから入力したフォローアップは、フォロー項目一覧画面にも反映される

---

## 4. 非機能要件

### 4.1 パフォーマンス

- エピソード/アクションの登録は1秒以内に完了すること
- 一覧表示のパフォーマンスを維持すること

### 4.2 データ整合性

- エピソード/アクションの削除時、ステータスが自動的に再計算されること
- 既存データとの互換性を保つこと

### 4.3 UI/UX

- エピソード/アクションの追加・削除が直感的に操作できること
- 登録数とステータスの関係が視覚的に分かりやすいこと
- 週次フォーカスカードとフォロー項目カードのデザインが統一されていること
- ホーム画面から直接フォローアップを入力できること

---

## 5. 成功基準

- ユーザーがエピソード/アクションを複数登録できる
- 登録数に応じてステータスが自動的に更新される
- 既存のフォローアップ機能との互換性が保たれる
- ホーム画面の週次フォーカスカードから直接フォローアップを入力できる
- 週次フォーカスカードとフォロー項目カードのデザインが統一されている

---

## 6. エッジケース

| ケース                            | 対応                                                         |
| :-------------------------------- | :----------------------------------------------------------- |
| エピソード/アクションが0件        | ステータスは「未着手」のまま                                 |
| エピソード/アクションを削除       | 削除後にステータスを再計算（閾値を下回った場合は「進行中」） |
| 既存のフォローアップデータ        | 既存データはそのまま維持、新規登録から新方式を適用           |
| 閾値ちょうどの場合                | 閾値以上（>=）で判定するため、「再現成功」「完了」になる     |
| エピソード/アクションの登録エラー | エラーメッセージを表示し、登録をキャンセル                   |
| 週次フォーカスカードからの入力    | フォロー項目一覧画面と同様の動作を保証                       |

---

## 7. 画面遷移図

### 7.1 よかったことのフォローアップ入力

```
フォロー項目一覧
  ↓ カードクリック
フォローアップ入力モーダル（よかったこと）
  ↓ 「エピソードを追加」ボタン
エピソード入力フォーム
  ↓ 保存
エピソード一覧に追加
  ↓ 自動判定
ステータス更新（エピソード数に応じて）
```

### 7.2 改善点のフォローアップ入力

```
フォロー項目一覧
  ↓ カードクリック
フォローアップ入力モーダル（改善点）
  ↓ 「アクションを追加」ボタン
アクション入力フォーム
  ↓ 保存
アクション一覧に追加
  ↓ 自動判定
ステータス更新（アクション数に応じて）
```

### 7.3 週次フォーカスカードからのフォローアップ入力

```
ホーム画面（今週のフォーカスセクション）
  ↓ 週次フォーカスカードの「フォローアップ」ボタンクリック
フォローアップ入力モーダル（よかったこと/改善点）
  ↓ 「エピソードを追加」/「アクションを追加」ボタン
エピソード/アクション入力フォーム
  ↓ 保存
エピソード/アクション一覧に追加
  ↓ 自動判定
ステータス更新（エピソード/アクション数に応じて）
  ↓ 週次フォーカスカードの表示も更新
```

---

## 8. メッセージ仕様

### 8.1 成功メッセージ

- 「エピソードを追加しました」
- 「アクションを追加しました」
- 「エピソードを削除しました」
- 「アクションを削除しました」

### 8.2 エラーメッセージ

- 「エピソードの追加に失敗しました」
- 「アクションの追加に失敗しました」
- 「再現日は必須です」
- 「完了日は必須です」
- 「メモは500文字以内で入力してください」

### 8.3 情報メッセージ

- 「エピソードが3件以上になりました。ステータスが「再現成功」に更新されました」
- 「アクションが3件以上になりました。ステータスが「完了」に更新されました」

---

## 9. ビジネスルール

### 9.1 ステータス自動判定ルール

1. **よかったこと**:
   - エピソード数 = 0 → 「未着手」
   - エピソード数 >= 1 かつ < 閾値 → 「進行中」
   - エピソード数 >= 閾値 → 「再現成功」

2. **改善点**:
   - アクション数 = 0 → 「未着手」
   - アクション数 >= 1 かつ < 閾値 → 「進行中」
   - アクション数 >= 閾値 → 「完了」

### 9.2 閾値設定

- 初期値: 3回（固定）
- 将来的にユーザー設定可能にすることを検討（Phase 3以降）

### 9.3 既存データとの互換性

- 既存のフォローアップデータはそのまま維持
- 新規登録から新方式（エピソード/アクション複数登録）を適用
- 既存データと新方式のデータが混在しても問題なく動作する

---

## 10. 他ロールへの依頼

### To Eng

- `tech_spec.md` で以下を定義してください：
  - エピソード/アクションのデータモデル設計
  - API設計（エピソード/アクションの追加・削除・一覧取得）
  - ステータス自動判定ロジックの実装方針
  - 既存データとの互換性確保方法
  - パフォーマンス最適化方針

### To Des

- `ui_design.md` で以下を定義してください：
  - エピソード/アクションの追加・削除UI
  - エピソード/アクション一覧の表示方法
  - 登録数とステータスの関係の視覚化
  - モーダル内での複数エピソード/アクション管理UI
  - 週次フォーカスカードへのフォローアップボタン追加
  - 週次フォーカスカードとフォロー項目カードのデザイン統一

---

## 11. 関連ドキュメント

| ドキュメント                                      | 説明                               |
| :------------------------------------------------ | :--------------------------------- |
| `docs/features/followup-management/prd.md`        | フォローアップ管理機能のPRD        |
| `docs/features/followup-management/tech_spec.md`  | フォローアップ管理機能の技術設計書 |
| `docs/features/followup-enhancement/tech_spec.md` | 技術設計書（作成予定）             |
| `docs/features/followup-enhancement/ui_design.md` | UI設計書（作成予定）               |

---

## 12. Phase分け

### Phase 2 v2（MVP）

- ✅ エピソード/アクションの複数登録機能
- ✅ ステータス自動判定機能（閾値: 3回固定）
- ✅ 既存データとの互換性確保
- ✅ 週次フォーカスカードへのフォローアップボタン追加

### 将来実装（Phase 3以降）

- 閾値のユーザー設定機能
- エピソード/アクションの編集機能
- エピソード/アクションの並び替え機能
- エピソード/アクションの検索・フィルタリング機能

---

_本PRDは Pending ステータスです。クロスレビュー後に承認予定です。_
