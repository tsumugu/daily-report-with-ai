# 週次フォーカス管理機能 Helperレビュー

**実施日**: 2025-12-06  
**レビュアー**: Helper  
**対象ドキュメント**: PRD, Tech Spec, UI Design, Cross Review

---

## 1. レビュー方針

helperロールとして、ドキュメント全体を横断的にレビューし、実装前に検討すべき事項や不足している観点を洗い出す。

---

## 2. 不足している検討事項

### 2.1 エッジケース・境界値

#### ⚠️ 未検討のエッジケース

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **週の切り替えタイミング** | 週が変わる瞬間（日曜日23:59 → 月曜日00:00）の挙動が不明確 | 中 | PRD/Tech Specに「週の切り替えはサーバー側で判定し、クライアント側のタイムゾーンに依存しない」と明記 |
| **タイムゾーンの違い** | ユーザーが海外にいる場合、週の開始日が異なる可能性 | 中 | Tech Specに「サーバー側のタイムゾーン（JST）で統一」と明記 |
| **同時追加の競合** | 複数デバイスから同時にフォーカスを追加した場合の挙動 | 低 | Tech Specに「サーバー側でバリデーションを行うため、競合は発生しない」と明記 |
| **フォロー項目削除時の挙動** | フォロー項目が削除された時、週次フォーカスも削除されるが、ユーザーへの通知方法が不明確 | 中 | UI Designに「フォロー項目削除時、週次フォーカスも自動削除されることをホーム画面で通知」を追加 |
| **週次フォーカスが5件ある状態での追加試行** | 既に5件ある状態で追加ボタンを押した場合のUI挙動 | 低 | UI Designに「5件に達している場合、追加ボタンを無効化または警告表示」を追加 |

### 2.2 パフォーマンス・最適化

#### ⚠️ 未検討のパフォーマンス課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **フォロー項目一覧での週次フォーカス判定** | フォロー項目が100件ある場合、各カードで週次フォーカス判定を行うとパフォーマンス低下の可能性 | 高 | Tech Specに「週次フォーカス一覧を1回取得し、Map構造で判定することでO(1)で判定可能」と明記 |
| **週次フォーカス一覧のキャッシュ** | ホーム画面とフォロー項目一覧で週次フォーカス一覧を取得する際、重複リクエストが発生する可能性 | 中 | Tech Specに「サービス層でキャッシュを実装し、短時間内の重複リクエストを防ぐ」を検討事項として追加 |
| **週の開始日計算の最適化** | クライアント側で週の開始日を計算する場合、毎回計算するのではなくキャッシュする | 低 | Tech Specに「週の開始日は1日1回のみ計算し、キャッシュする」を検討事項として追加 |

### 2.3 ユーザビリティ・UX

#### ⚠️ 未検討のUX課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **フォーカス追加後のフィードバック** | フォーカス追加後、ホーム画面に戻った時に週次フォーカスセクションが更新されているか不明確 | 中 | UI Designに「フォーカス追加後、ホーム画面に戻った時に週次フォーカスセクションを自動更新」を追加 |
| **既にフォーカス設定済みの視覚的フィードバック** | 既にフォーカスに設定されている項目を視覚的に区別しにくい | 中 | UI Designに「既にフォーカスに設定されている項目は、カードにバッジやアイコンを表示」を追加 |
| **週次フォーカス削除の確認** | PRDでは「削除確認は任意実装」とあるが、誤削除を防ぐため確認ダイアログを推奨 | 低 | PRDに「Phase 2 v2では削除確認は省略するが、Phase 3で追加を検討」と明記 |
| **週次フォーカスの優先順位** | 最大5件まで設定できるが、優先順位や順序が不明確 | 低 | PRDに「Phase 2 v2では順序は作成日時順、Phase 3で優先順位機能を追加予定」と明記 |

### 2.4 データ整合性・一貫性

#### ⚠️ 未検討のデータ整合性課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **週次フォーカスの履歴保持** | 前週のフォーカスはデータとして保持されるが、履歴として参照できるか不明確 | 低 | Tech Specに「前週のフォーカスはデータベースに保持されるが、APIでは取得できない（Phase 3で履歴機能を追加予定）」と明記 |
| **週次フォーカスとフォローアップの関係** | 週次フォーカスに設定した項目のフォローアップ入力率を追跡する機能が不明確 | 中 | PRDに「週次フォーカスに設定された項目のフォローアップ入力率を追跡し、成功基準の測定に利用」と明記 |
| **週次フォーカスの自動削除** | 対象のよかったこと/改善点が削除された場合、週次フォーカスも削除されるが、ユーザーへの通知方法が不明確 | 中 | UI Designに「フォロー項目削除時、週次フォーカスも自動削除されることをトースト通知で表示」を追加 |

### 2.5 セキュリティ・権限

#### ⚠️ 未検討のセキュリティ課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **週次フォーカスのアクセス制御** | 既存APIで実装済みとあるが、具体的な権限チェックの実装が不明確 | 低 | Tech Specに「既存の認証ミドルウェアで実装済み。ユーザーは自分の週次フォーカスのみ操作可能」と明記 |
| **週次フォーカスのデータ漏洩** | 他のユーザーの週次フォーカスが取得されないか | 低 | Tech Specに「APIレスポンスには認証されたユーザーのデータのみ含まれる」と明記 |

### 2.6 テスト観点

#### ⚠️ 未検討のテストケース

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **週の切り替えテスト** | 週が変わる瞬間の挙動をテストする方法が不明確 | 中 | Tech Specに「E2Eテストで週の開始日をモックし、週の切り替えをテストする」を追加 |
| **同時追加のテスト** | 複数デバイスから同時に追加した場合のテスト | 低 | Tech Specに「並列リクエストで同時追加をテストし、バリデーションが正しく動作することを確認」を追加 |
| **パフォーマンステスト** | フォロー項目が大量にある場合のパフォーマンステスト | 中 | Tech Specに「フォロー項目100件、週次フォーカス5件の場合のパフォーマンステストを実施」を追加 |

### 2.7 運用・保守性

#### ⚠️ 未検討の運用課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **週次フォーカスのデータクリーンアップ** | 前週のフォーカスがデータベースに蓄積されるが、クリーンアップポリシーが不明確 | 低 | Tech Specに「前週のフォーカスはデータベースに保持し、Phase 3で履歴機能を実装予定。現時点ではクリーンアップ不要」と明記 |
| **週次フォーカスの統計情報** | 週次フォーカスの設定率や達成率などの統計情報を取得する機能が不明確 | 低 | PRDに「Phase 3で週次フォーカスの統計情報（設定率、達成率など）を表示する機能を追加予定」と明記 |

### 2.8 既存機能との整合性

#### ⚠️ 未検討の整合性課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **フォロー項目一覧のフィルタとの整合性** | フォロー項目一覧でフィルタを変更した場合、週次フォーカス判定に影響があるか | 低 | Tech Specに「フィルタ変更時も週次フォーカス判定は全フォロー項目に対して行う（フィルタ結果に依存しない）」と明記 |
| **週次フォーカスとフォローアップ入力の関係** | 週次フォーカスに設定した項目のフォローアップ入力画面への遷移方法が不明確 | 低 | UI Designに「週次フォーカスカードからフォローアップ入力画面へ遷移できるボタンを追加（Phase 3で検討）」を追加 |

### 2.9 将来拡張性

#### ⚠️ 未検討の拡張性課題

| 項目 | 説明 | 影響度 | 対応推奨 |
| :--- | :--- | :----- | :------- |
| **週次フォーカスの優先順位機能** | Phase 3で優先順位機能を追加する場合のデータモデル拡張が不明確 | 低 | Tech Specに「Phase 3で優先順位機能を追加する場合、WeeklyFocusモデルに`priority`フィールドを追加予定」と明記 |
| **週次フォーカスの共有機能** | 将来的にチームで週次フォーカスを共有する機能を追加する場合の設計が不明確 | 低 | PRDに「Phase 3以降でチーム共有機能を検討。現時点では個人の週次フォーカスのみ」と明記 |

---

## 3. 優先度別の対応推奨

### 🔴 高優先度（実装前に必須対応）

1. **フォロー項目一覧での週次フォーカス判定の最適化**
   - Tech Specに「週次フォーカス一覧を1回取得し、Map構造で判定」を明記
   - パフォーマンスに直接影響するため、実装前に設計を明確化

2. **週の切り替えタイミングの明確化**
   - PRD/Tech Specに「週の切り替えはサーバー側で判定」を明記
   - ユーザー体験に影響するため、実装前に仕様を明確化

### 🟡 中優先度（実装時に考慮）

1. **フォーカス追加後のフィードバック**
   - UI Designに「ホーム画面に戻った時に週次フォーカスセクションを自動更新」を追加

2. **既にフォーカス設定済みの視覚的フィードバック**
   - UI Designに「既にフォーカスに設定されている項目にバッジやアイコンを表示」を追加

3. **フォロー項目削除時の週次フォーカス削除通知**
   - UI Designに「フォロー項目削除時、週次フォーカスも自動削除されることを通知」を追加

### 🟢 低優先度（将来検討）

1. **週次フォーカスの優先順位機能**
2. **週次フォーカスの履歴表示**
3. **週次フォーカスの統計情報**

---

## 4. クロスレビューとの整合性確認

### ✅ クロスレビューで指摘された項目

- ローディング表示の追加 → **本レビューでも確認済み**
- パフォーマンス最適化の方針 → **本レビューで詳細化**

### ⚠️ クロスレビューで未指摘の項目

- 週の切り替えタイミングの明確化
- 既にフォーカス設定済みの視覚的フィードバック
- フォロー項目削除時の週次フォーカス削除通知

---

## 5. 推奨アクション

### 必須対応（実装前）

1. **Tech Specの更新**
   - 週次フォーカス判定の最適化方針を追加
   - 週の切り替えタイミングを明確化
   - パフォーマンステストの方針を追加

2. **UI Designの更新**
   - 既にフォーカス設定済みの視覚的フィードバックを追加
   - フォーカス追加後のフィードバックを追加

3. **PRDの更新**
   - 週次フォーカスとフォローアップの関係を明確化
   - 週の切り替えタイミングを明確化

### 推奨対応（実装時）

1. **フォロー項目削除時の週次フォーカス削除通知**
2. **週次フォーカスの優先順位機能（Phase 3で検討）**

---

## 6. 総合評価

### ✅ 良好な点

- 基本的な機能要件は明確に定義されている
- 既存APIを活用する設計で実装コストが低い
- エラーハンドリングが適切に定義されている

### ⚠️ 改善が必要な点

- パフォーマンス最適化の方針が不足している
- 週の切り替えタイミングの仕様が不明確
- ユーザビリティの観点で視覚的フィードバックが不足している

---

## 7. 次のステップ

1. **高優先度項目の対応**
   - Tech Spec、UI Design、PRDを更新
   - クロスレビューで指摘された項目と合わせて対応

2. **ドキュメントステータス更新**
   - 必須対応完了後、各ドキュメントを Approved ステータスに更新

3. **実装開始**
   - 必須対応項目の修正完了後、実装を開始

---

_本レビューは Helper ロールとして実施しました。実装前に高優先度項目の対応を推奨します。_

