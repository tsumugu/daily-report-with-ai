# 週次フォーカス管理機能 PRD

**バージョン**: Phase 2 v2  
**作成日**: 2025-12-06  
**作成者**: PdM  
**ステータス**: Draft  
**承認日**: -  
**承認者**: -

---

## 1. 概要（Why）

### 背景

フォローアップ管理機能で「よかったこと」「改善点」を追跡できるようになったが、**今週集中して取り組むべき項目が明確でない**。ユーザーが週単位で優先順位を設定し、実行率を高めるための仕組みが必要。

### 目的

- 今週取り組むべき項目を明確にし、実行率を向上させる
- 週単位で目標を設定し、達成感を高める
- ホーム画面で今週のフォーカスを可視化し、意識を高める

---

## 2. ユーザーストーリー

### US-1: 週次フォーカスの設定

```
As a ユーザー
I want to 今週取り組む項目を選択したい
So that 集中して取り組むべき改善点や再現テストが明確になり、実行率が上がる
```

### US-2: 週次フォーカスの確認

```
As a ユーザー
I want to ホーム画面で今週のフォーカスを確認したい
So that 毎日意識して取り組むべき項目を把握できる
```

### US-3: 週次フォーカスの削除

```
As a ユーザー
I want to 不要になったフォーカスを削除したい
So that 今週のフォーカスを適切に管理できる
```

---

## 3. 機能要件

### 3.1 週次フォーカスの設定

| 項目           | 仕様                                                                 |
| :------------- | :------------------------------------------------------------------- |
| 設定方法       | フォロー項目一覧画面の各カードに「フォーカスに追加」ボタンを配置     |
| 設定可能数     | 1ユーザーあたり最大5件まで                                           |
| 設定条件       | 既に今週のフォーカスに設定されている項目は追加できない             |
| 設定対象       | 過去に入力した「よかったこと」「改善点」すべて                       |
| 週の定義       | 月曜日を週の開始日とする（ISO 8601準拠）                             |
| 週の切り替え   | **週の切り替えはサーバー側で判定し、クライアント側のタイムゾーンに依存しない** |
| 自動リセット   | 週が変わると自動的に前週のフォーカスは表示されなくなる（データは保持） |
| 順序           | Phase 2 v2では作成日時順で表示。Phase 3で優先順位機能を追加予定     |

### 3.2 週次フォーカスの表示

| 項目           | 仕様                                                                 |
| :------------- | :------------------------------------------------------------------- |
| 表示場所       | ホーム画面の「今週のフォーカス」セクションに表示                     |
| 表示内容       | よかったこと/改善点の内容、ステータス、成功回数、定着バッジ         |
| 表示件数       | 最大5件                                                              |
| 表示順序       | 作成日時順（Phase 2 v2）。Phase 3で優先順位機能を追加予定           |
| 空状態         | フォーカスが0件の場合は「今週のフォーカスが設定されていません」と表示 |
| 追加ボタン     | 空状態時とリスト表示時、両方に「＋ フォーカスを追加」ボタンを配置     |
| 5件制限時のUI  | 5件に達している場合、追加ボタンを無効化または警告表示（推奨：無効化） |

### 3.3 週次フォーカスの削除

| 項目           | 仕様                                                                 |
| :------------- | :------------------------------------------------------------------- |
| 削除方法       | ホーム画面の週次フォーカスカードに削除ボタンを配置                   |
| 削除確認       | Phase 2 v2では削除確認は省略。Phase 3で確認ダイアログを追加予定    |
| 削除後の動作   | カードを削除し、リストを更新                                         |
| 自動削除       | 対象のよかったこと/改善点が削除された場合、週次フォーカスも自動削除。削除時はトースト通知で表示 |

---

## 4. 非機能要件

| 項目             | 仕様                                              |
| :--------------- | :------------------------------------------------ |
| レスポンシブ対応 | モバイル/PC両対応                                 |
| パフォーマンス   | 週次フォーカス一覧の取得は500ms以内               |
| アクセシビリティ | キーボード操作対応                                |
| データ整合性     | 週次フォーカスは対象のよかったこと/改善点に紐付く |

---

## 5. 成功基準

| 基準                 | 測定方法                                                               |
| :------------------- | :--------------------------------------------------------------------- |
| 週次フォーカス設定率 | ユーザーのうち、週次フォーカスを1回以上設定した割合 ≥ 50%              |
| 実行率向上           | 週次フォーカスに設定された項目のフォローアップ入力率が、未設定項目より20%以上高い |
| ユーザビリティ       | 週次フォーカスの追加が3タップ以内で完了できる                          |

---

## 6. エッジケースの洗い出し

### 6.1 データ関連

| ケース                                | 対応                                               |
| :------------------------------------ | :------------------------------------------------- |
| フォロー項目が0件                      | フォロー項目一覧画面で空状態メッセージを表示       |
| 対象のよかったこと/改善点が削除された   | 週次フォーカスも連動して削除                       |
| 週が変わった                          | 前週のフォーカスは表示されなくなる（データは保持） |

### 6.2 操作関連

| ケース                          | 対応                       |
| :------------------------------ | :------------------------- |
| 週次フォーカスが既に5件ある     | 「今週のフォーカスは最大5件まで設定できます」とエラー表示。追加ボタンを無効化 |
| 既にフォーカスに設定済みの項目  | 「この項目は既に今週のフォーカスに設定されています」とエラー表示。ボタンを非表示し、「今週のフォーカス」バッジを表示 |
| 週次フォーカス削除              | 削除後、リストを更新         |
| フォーカス追加後のフィードバック | フォーカス追加後、ホーム画面に戻った時に週次フォーカスセクションを自動更新 |

### 6.3 エラー関連

| ケース                | 対応                                         |
| :-------------------- | :------------------------------------------- |
| ネットワークエラー    | リトライボタン付きエラーメッセージ表示       |
| 認証切れ              | ログイン画面へリダイレクト                   |
| サーバーエラー（500） | 「しばらく経ってから再試行してください」表示 |

---

## 7. メッセージ仕様

### 7.1 成功メッセージ

| 操作               | メッセージ                       |
| :----------------- | :------------------------------- |
| 週次フォーカス追加 | 「今週のフォーカスに追加しました」 |
| 週次フォーカス削除 | 「フォーカスを削除しました」     |

### 7.2 エラーメッセージ

| 状況               | メッセージ                                                     |
| :----------------- | :------------------------------------------------------------- |
| ネットワークエラー | 「通信エラーが発生しました。再試行してください」               |
| サーバーエラー     | 「エラーが発生しました。しばらく経ってから再試行してください」 |
| 週次フォーカス上限 | 「今週のフォーカスは最大5件まで設定できます」                 |
| 週次フォーカス重複 | 「この項目は既に今週のフォーカスに設定されています」         |

### 7.3 空状態メッセージ

| 状況            | メッセージ                                                                             |
| :-------------- | :------------------------------------------------------------------------------------- |
| 週次フォーカス0件 | 「今週のフォーカスが設定されていません」                                               |
| フォロー項目0件 | 「フォローする項目がありません。日報を入力して、よかったことや改善点を記録しましょう」 |

---

## 8. 画面遷移図

```
[ホーム]
    │
    └──→ [フォロー項目一覧]（週次フォーカス追加目的で遷移）
              │
              ├──→ [フォロー項目カード]「フォーカスに追加」ボタン押下
              │           │
              │           └──→ 週次フォーカスに追加（トースト通知）
              │                       │
              │                       └──→ [ホーム]（週次フォーカスセクション更新）
              │
              └──→ [ホーム]（戻るボタン）

[ホーム]
    │
    └──→ [週次フォーカスセクション]「削除」ボタン押下
              │
              └──→ 週次フォーカス削除（トースト通知）
                          │
                          └──→ [ホーム]（週次フォーカスセクション更新）
```

### 遷移詳細

| 操作                                     | 遷移先                          |
| :--------------------------------------- | :------------------------------ |
| ホームで「週次フォーカス追加」ボタン押下 | フォロー項目一覧                |
| フォロー項目一覧で「フォーカスに追加」押下 | 週次フォーカスに追加（トースト通知） |
| ホームで週次フォーカス「削除」ボタン押下 | 週次フォーカス削除（トースト通知） |

---

## 9. ビジネスルール

| ルール                     | 説明                                                                 |
| :------------------------- | :------------------------------------------------------------------- |
| 週次フォーカス最大件数     | 1ユーザーあたり最大5件まで                                           |
| 週次フォーカス重複禁止     | 同じ項目を今週のフォーカスに複数回追加することはできない             |
| 週次フォーカスの週定義     | 月曜日を週の開始日とし、週ごとに自動リセット。サーバー側で判定       |
| 削除は連動                 | 対象のよかったこと/改善点が削除された場合、週次フォーカスも連動削除 |
| 週次フォーカスとフォローアップ | 週次フォーカスに設定された項目のフォローアップ入力率を追跡し、成功基準の測定に利用 |
| 順序                       | Phase 2 v2では作成日時順。Phase 3で優先順位機能を追加予定           |

---

## 10. API設計（概要）

※ 詳細は `tech_spec.md` で定義

| エンドポイント        | メソッド | 説明                 |
| :-------------------- | :------- | :------------------- |
| `/api/weekly-focuses` | GET      | 今週のフォーカス一覧取得 |
| `/api/weekly-focuses` | POST     | 週次フォーカス追加   |
| `/api/weekly-focuses/{id}` | DELETE   | 週次フォーカス削除   |

**補足**: 既存のフォローアップ管理機能で実装済みのAPIを利用する。

---

## 11. 他ロールへの依頼

### To Eng

- `tech_spec.md` で以下を定義してください：
  - フロントエンド状態管理（週次フォーカス追加/削除）
  - エラーハンドリング
  - 既存APIとの連携方法

### To Des

- `ui_design.md` で以下を定義してください：
  - フォロー項目カードに「フォーカスに追加」ボタンの配置
  - 週次フォーカスカードの削除ボタンUI
  - トースト通知のデザイン

---

## 12. 関連ドキュメント

| ドキュメント                              | 説明                         |
| :---------------------------------------- | :--------------------------- |
| `docs/features/followup-management/prd.md` | フォローアップ管理機能の仕様 |
| `docs/general/roadmap.md`                 | Phase 2 の位置付け           |

---

## 13. Phase分け

### Phase 2 v2（MVP）

- ✅ 週次フォーカスの追加（フォロー項目一覧から）
- ✅ 週次フォーカスの表示（ホーム画面）
- ✅ 週次フォーカスの削除
- ✅ トースト通知

### 将来実装（Phase 3以降）

- 週次フォーカスの編集（優先順位変更など）
- 週次フォーカスの履歴表示（前週のフォーカスを参照可能）
- 週次フォーカスのリマインダー通知
- 週次フォーカスの達成率表示
- 週次フォーカスの統計情報（設定率、達成率など）
- 週次フォーカスの削除確認ダイアログ
- チームで週次フォーカスを共有する機能（検討）

---

_本PRDは Draft ステータスです。Eng/Des とのクロスレビュー後に承認予定です。_

