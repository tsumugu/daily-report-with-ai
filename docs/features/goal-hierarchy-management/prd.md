# 目標階層管理機能 PRD

**バージョン**: v1  
**作成日**: 2025-12-13  
**作成者**: PdM  
**ステータス**: Approved  
**承認日**: 2025-12-13  
**承認者**: PdM

---

## 1. 概要（Why）

### 背景

現在、長期目標（半期スパン）、中期目標（1ヶ月スパン）、短期目標（1週間スパン）を階層的にブレイクダウンする仕組みが存在しない。目標の階層構造を定義・管理する機能がないため、目標間の関係性が不明確になっている。

また、既存の週次フォーカス機能は存在するが、目標との接続ができていない。日々の活動（日報、フォローアップ）と目標の関連性が不明確で、目標達成への道筋が見えない状態になっている。

### 目的

- 長期目標から中期目標、短期目標へと階層的にブレイクダウンできるようにする
- 目標間の関係性（因果関係、依存関係）を明確に可視化する
- 目標の階層構造を一元的に管理できるようにする
- 既存の週次フォーカス機能と目標を接続し、日々の活動と目標達成を結びつける

### Phase分け

| 機能                                         | Phase 1 | Phase 2 | 将来 |
| :------------------------------------------- | :------ | :------ | :--- |
| 目標の階層構造定義・管理                     | ✅      | -       | -    |
| 目標の性質に応じたブレイクダウン方法サポート | ✅      | -       | -    |
| 週次フォーカスとの接続                       | ✅      | -       | -    |
| 目標間の関係性可視化                         | ✅      | -       | -    |
| 目標設定の質向上（SMART基準チェック等）      | -       | ✅      | -    |
| 目標テンプレート機能                         | -       | ✅      | -    |
| 目標の進捗状況可視化                         | -       | -       | ✅   |

---

## 2. ユーザーストーリー

### US-1: 長期目標の作成

```
As a ユーザー
I want to 長期目標（半期スパン等）を作成したい
So that 自分の成長目標を明確にし、計画的な目標達成ができるようになる
```

### US-2: 目標の階層的ブレイクダウン

```
As a ユーザー
I want to 長期目標から中期目標、短期目標へと階層的にブレイクダウンしたい
So that 長期目標を具体的なアクションに落とし込めるようになる
```

### US-3: 目標間の関係性の確認

```
As a ユーザー
I want to 目標間の関係性（因果関係、依存関係）を確認したい
So that 目標の優先順位や依存関係を理解し、効率的に目標達成を進められるようになる
```

### US-4: 目標の階層構造の一覧表示

```
As a ユーザー
I want to 目標の階層構造を一覧で確認したい
So that すべての目標を階層的に把握し、目標達成の全体像を理解できるようになる
```

### US-5: 週次フォーカスと短期目標の接続

```
As a ユーザー
I want to 週次フォーカスと短期目標を接続したい
So that 日々の活動（週次フォーカス）が目標達成にどう貢献しているか明確になる
```

### US-6: 目標の編集・削除

```
As a ユーザー
I want to 作成した目標を編集・削除したい
So that 目標の内容や期間を変更したり、不要になった目標を削除できるようになる
```

---

## 3. 機能要件

### 3.1 目標の作成・編集・削除

#### 3.1.1 目標の基本情報

| 項目       | 仕様                                                                      |
| :--------- | :------------------------------------------------------------------------ |
| 目標名     | 必須、最大100文字                                                         |
| 目標の説明 | 任意、最大1000文字                                                        |
| 目標の期間 | 必須、開始日と終了日を設定（目標の性質に応じて柔軟に設定可能）            |
| 目標の階層 | 必須、上位目標を選択（最上位の場合は「なし」を選択）                      |
| 目標の性質 | 任意、スキル習得/プロジェクト完了/習慣形成/その他から選択（将来の拡張用） |
| 達成基準   | 任意、最大500文字（目標達成の判断基準）                                   |

#### 3.1.2 目標の階層構造

| 項目         | 仕様                                               |
| :----------- | :------------------------------------------------- |
| 階層数       | 2階層〜4階層程度を想定（柔軟に設定可能）           |
| 基本階層     | 長期目標（最上位）→ 中期目標 → 短期目標（最下位）  |
| 階層の深さ   | 最上位から最下位まで、最大4階層まで設定可能        |
| 階層の関係性 | 下位目標は必ず1つの上位目標に紐づく（1対多の関係） |

#### 3.1.3 目標の期間設定

| 項目         | 仕様                                                                             |
| :----------- | :------------------------------------------------------------------------------- |
| 期間の柔軟性 | 固定期間（半期、四半期、1ヶ月、1週間）ではなく、目標の性質に応じて柔軟に設定可能 |
| 期間の例     | 半期（6ヶ月）、四半期（3ヶ月）、1ヶ月、2ヶ月、1週間、2週間など                   |
| 期間の検証   | 下位目標の期間は上位目標の期間内に収まること                                     |

### 3.2 目標の階層構造の可視化

| 項目             | 仕様                                                   |
| :--------------- | :----------------------------------------------------- |
| 表示方法         | 階層構造をツリー形式で表示                             |
| 関係性の表示     | 目標間の因果関係、依存関係を視覚的に表現               |
| 展開・折りたたみ | 各階層を展開・折りたたみ可能                           |
| フィルタ         | 階層レベル、期間、目標の性質でフィルタ可能（将来実装） |

### 3.3 週次フォーカスとの接続

| 項目       | 仕様                                       |
| :--------- | :----------------------------------------- |
| 接続方法   | 短期目標から週次フォーカスを設定可能       |
| 接続の表示 | 週次フォーカスカードに紐づく短期目標を表示 |
| 接続の解除 | 週次フォーカスと短期目標の接続を解除可能   |

### 3.4 目標の性質に応じたブレイクダウン方法のサポート

| 項目               | 仕様                                                                                         |
| :----------------- | :------------------------------------------------------------------------------------------- |
| ブレイクダウン方法 | 目標の性質（スキル習得、プロジェクト完了、習慣形成など）に応じたブレイクダウン方法をサポート |
| ガイド表示         | 目標の性質に応じたブレイクダウン方法のガイドを表示（将来実装）                               |
| 推奨事項           | 目標の性質に応じた推奨事項を表示（将来実装）                                                 |

---

## 4. 非機能要件

| 項目             | 仕様                                                       |
| :--------------- | :--------------------------------------------------------- |
| レスポンシブ対応 | モバイル/PC両対応                                          |
| パフォーマンス   | 目標階層構造の取得は1秒以内                                |
| アクセシビリティ | キーボード操作対応、スクリーンリーダー対応                 |
| データ整合性     | 目標の階層構造は整合性が保たれること（循環参照の防止など） |

---

## 5. エッジケースの洗い出し

### エラー発生時のフロー

- **ネットワークエラー**: リトライボタン付きエラーメッセージ表示
- **認証切れ**: ログイン画面へリダイレクト
- **サーバーエラー（500）**: 「しばらく経ってから再試行してください」表示
- **バリデーションエラー**: 該当フィールドにエラーメッセージを表示

### 例外的な操作フロー

- **循環参照の防止**: 下位目標を上位目標に設定しようとした場合、エラーメッセージを表示
- **期間の整合性**: 下位目標の期間が上位目標の期間外の場合、エラーメッセージを表示
- **目標の削除**: 下位目標が存在する場合、削除前に確認ダイアログを表示（将来実装）
- **目標の編集**: 期間を変更する際、下位目標の期間との整合性を確認

### 境界値・限界値

- **目標名の最大文字数**: 100文字
- **目標の説明の最大文字数**: 1000文字
- **達成基準の最大文字数**: 500文字
- **階層の最大深さ**: 4階層
- **1つの上位目標に紐づく下位目標の最大数**: 制限なし（ただし、UI上は適切な数に制限）

---

## 6. メッセージ仕様

### エラーメッセージ

- **目標名が未入力**: "目標名を入力してください"
- **目標の期間が未設定**: "目標の期間を設定してください"
- **下位目標の期間が上位目標の期間外**: "下位目標の期間は上位目標の期間内に収まる必要があります"
- **循環参照エラー**: "この目標を上位目標に設定することはできません（循環参照が発生します）"
- **ネットワークエラー**: "通信エラーが発生しました。再試行してください"
- **サーバーエラー**: "エラーが発生しました。しばらく経ってから再試行してください"

### 成功メッセージ

- **目標作成**: "目標を作成しました"
- **目標更新**: "目標を更新しました"
- **目標削除**: "目標を削除しました"
- **週次フォーカスとの接続**: "週次フォーカスと目標を接続しました"

### バリデーションメッセージ

- **目標名が100文字超過**: "目標名は100文字以内で入力してください"
- **目標の説明が1000文字超過**: "目標の説明は1000文字以内で入力してください"
- **達成基準が500文字超過**: "達成基準は500文字以内で入力してください"

---

## 7. 画面遷移図

```
[ホーム]
    │
    └──→ [目標一覧]（目標管理画面）
              │
              ├──→ [目標作成]（新規目標作成画面）
              │           │
              │           ├──→ 目標情報入力
              │           │           │
              │           │           └──→ [目標一覧]（作成完了、トースト通知）
              │           │
              │           └──→ [目標一覧]（キャンセル）
              │
              ├──→ [目標詳細]（目標の詳細・編集画面）
              │           │
              │           ├──→ [目標編集]（目標情報編集）
              │           │           │
              │           │           └──→ [目標詳細]（更新完了、トースト通知）
              │           │
              │           ├──→ [下位目標作成]（下位目標作成画面）
              │           │           │
              │           │           └──→ [目標詳細]（作成完了、トースト通知）
              │           │
              │           └──→ [目標削除]（削除確認ダイアログ）
              │                       │
              │                       └──→ [目標一覧]（削除完了、トースト通知）
              │
              └──→ [目標階層表示]（階層構造の可視化画面）
                          │
                          └──→ [目標詳細]（目標をクリック）
```

### 遷移詳細

| 操作                             | 遷移先             |
| :------------------------------- | :----------------- |
| ホームで「目標管理」ボタン押下   | 目標一覧           |
| 目標一覧で「目標を作成」押下     | 目標作成画面       |
| 目標一覧で目標をクリック         | 目標詳細           |
| 目標詳細で「編集」押下           | 目標編集画面       |
| 目標詳細で「下位目標を作成」押下 | 下位目標作成画面   |
| 目標詳細で「削除」押下           | 削除確認ダイアログ |
| 目標一覧で「階層表示」押下       | 目標階層表示画面   |

---

## 8. ビジネスルール

- **階層構造の整合性**: 下位目標は必ず1つの上位目標に紐づく（1対多の関係）
- **期間の整合性**: 下位目標の期間は上位目標の期間内に収まること
- **循環参照の防止**: 目標Aが目標Bの上位目標である場合、目標Bを目標Aの上位目標に設定することはできない
- **目標の削除**: 下位目標が存在する場合、削除前に確認が必要（将来実装）
- **目標の階層数**: 2階層〜4階層程度を想定（柔軟に設定可能）
- **目標の期間**: 固定期間ではなく、目標の性質に応じて柔軟に設定可能
- **週次フォーカスとの接続**: 短期目標から週次フォーカスを設定可能（既存の週次フォーカス機能との接続）

---

## 9. 成功基準

- [ ] ユーザーが目標の階層構造を理解し、設定できる
- [ ] 目標間の関係性が明確に可視化されている
- [ ] 目標の階層構造を一元的に管理できる
- [ ] 週次フォーカスと短期目標を接続できる
- [ ] 目標の性質に応じたブレイクダウン方法をサポートできる

---

## 10. 受入基準（AC）

### AC-1: 長期目標の作成

- Given: ユーザーがログインしている
- When: 目標一覧画面で「目標を作成」をクリックし、目標情報（目標名、期間、説明等）を入力して保存する
- Then: 目標が作成され、目標一覧に表示される

### AC-2: 目標の階層的ブレイクダウン

- Given: 長期目標が作成されている
- When: 長期目標の詳細画面で「下位目標を作成」をクリックし、中期目標を作成する
- Then: 中期目標が作成され、長期目標の下位目標として表示される

### AC-3: 目標間の関係性の可視化

- Given: 複数の目標が階層構造で作成されている
- When: 目標一覧画面で「階層表示」をクリックする
- Then: 目標の階層構造がツリー形式で表示され、目標間の関係性が明確に可視化される

### AC-4: 週次フォーカスと短期目標の接続

- Given: 短期目標が作成されている
- When: 短期目標の詳細画面で「週次フォーカスを設定」をクリックし、既存の週次フォーカスを選択する
- Then: 週次フォーカスと短期目標が接続され、週次フォーカスカードに紐づく短期目標が表示される

### AC-5: 目標の編集

- Given: 目標が作成されている
- When: 目標の詳細画面で「編集」をクリックし、目標情報を変更して保存する
- Then: 目標が更新され、変更内容が反映される

### AC-6: 目標の削除

- Given: 目標が作成されている（下位目標が存在しない）
- When: 目標の詳細画面で「削除」をクリックし、確認ダイアログで「削除」を選択する
- Then: 目標が削除され、目標一覧から削除される

### AC-7: 期間の整合性チェック

- Given: 長期目標（2025-01-01 〜 2025-06-30）が作成されている
- When: 長期目標の下位目標として、期間が2025-07-01 〜 2025-07-31の中期目標を作成しようとする
- Then: エラーメッセージ「下位目標の期間は上位目標の期間内に収まる必要があります」が表示される

### AC-8: 循環参照の防止

- Given: 目標Aが目標Bの上位目標として設定されている
- When: 目標Bの詳細画面で「編集」をクリックし、目標Aを上位目標として設定しようとする
- Then: エラーメッセージ「この目標を上位目標に設定することはできません（循環参照が発生します）」が表示される

---

## 関連ドキュメント

- Tech Spec: `docs/features/goal-hierarchy-management/tech_spec.md`
- UI Design: `docs/features/goal-hierarchy-management/ui_design.md`
- Discovery成果物: `.discovery/archived/2025-12-13/`
- 既存機能: `docs/features/weekly-focus-management/prd.md`（週次フォーカス管理機能）

---

## 11. 他ロールへの依頼

### To Eng

- `tech_spec.md` で以下を定義してください：
  - データモデル（目標の階層構造、期間、目標の性質等）
  - API設計（目標のCRUD、階層構造の取得等）
  - バリデーションロジック（期間の整合性、循環参照の防止等）
  - 既存の週次フォーカス機能との接続方法

### To Des

- `ui_design.md` で以下を定義してください：
  - 目標一覧画面のデザイン
  - 目標作成・編集画面のデザイン
  - 目標階層表示画面のデザイン（ツリー形式）
  - 週次フォーカスとの接続UI
  - 既存コンポーネントの活用計画

---

## 12. Phase分けの詳細

### Phase 1（MVP）

- ✅ 目標の階層構造定義・管理（作成、編集、削除）
- ✅ 目標間の関係性可視化（階層構造の表示）
- ✅ 週次フォーカスとの接続（短期目標から週次フォーカスを設定）
- ✅ 目標の性質に応じたブレイクダウン方法のサポート（基本的なガイド表示）

### Phase 2（将来実装）

- 目標設定の質向上（SMART基準のチェック機能）
- 目標テンプレート機能
- 目標の性質に応じたブレイクダウン方法の詳細ガイド
- 目標設定のベストプラクティス共有

### 将来実装（Phase 3以降）

- 目標の進捗状況可視化（BL-05で実装予定）
- 目標の達成率計算・表示
- 目標の統計情報（設定率、達成率など）
- 目標のリマインダー通知

---

## 13. 注意事項

- **既存機能との接続**: 既存の週次フォーカス機能との接続を考慮すること
- **柔軟な設計**: 期間と階層数を柔軟に設定できる設計を重視すること
- **批判的レビュー結果の反映**: `.discovery/archived/2025-12-13/critical_review.md` の改善点を反映すること
- **段階的実装**: Phase 1では基本的な機能に絞り、Phase 2以降で拡張機能を実装すること
