# 目標階層管理機能 UI/UX設計書（UI Design）

**バージョン**: v1.2  
**作成日**: 2025-12-13  
**更新日**: 2025-12-13  
**作成者**: Des  
**ステータス**: Approved  
**承認日**: 2025-12-13  
**承認者**: PdM, Helper, human

---

## 1. 概要

目標階層管理機能のUI/UX設計方針を定義する。  
目標を階層的に定義・管理し、既存の週次フォーカス機能と接続する画面・コンポーネントの設計を記載する。

---

## 2. 画面構成

### 2.1 目標一覧画面

- ヘッダー：画面タイトル「目標管理」、戻るボタン
- アクションバー：「目標を作成」ボタン、ビュー切り替えトグル（階層表示/カード表示）
- リスト部：目標ツリー一覧（デフォルト表示、縦に階段状に積む形式）または目標カード一覧（切り替え表示）
- 空状態：目標未作成時のメッセージ

**重要**: デフォルト表示は階層表示（ツリー形式）とする。階層は横並び（インデント）ではなく、縦に階段状に積んでいく形式で表示する。

### 2.2 目標作成画面

- ヘッダー：画面タイトル「目標を作成」、戻るボタン
- フォーム部：各入力フィールド
- フッター：保存ボタン、キャンセルボタン

### 2.3 目標編集画面

- ヘッダー：画面タイトル「目標を編集」、戻るボタン
- フォーム部：各入力フィールド（既存値で初期化）
- フッター：保存ボタン、キャンセルボタン

### 2.4 目標詳細画面

- ヘッダー：画面タイトル「目標詳細」、戻るボタン
- コンテンツ部：目標の詳細情報、下位目標一覧
- アクションバー：「編集」ボタン、「下位目標を作成」ボタン、「削除」ボタン
- 週次フォーカス接続部：短期目標の場合、「週次フォーカスを設定」ボタン

### 2.5 目標階層表示画面

- ヘッダー：画面タイトル「目標階層」、戻るボタン
- コンテンツ部：階層構造をツリー形式で表示
- 展開・折りたたみ機能

---

## 3. UIコンポーネント

### 3.1 目標一覧画面

| 項目                 | コンポーネント       | 備考                                                          |
| :------------------- | :------------------- | :------------------------------------------------------------ |
| 目標を作成ボタン     | Button (Primary)     | 「目標を作成」                                                |
| ビュー切り替えトグル | ViewToggle（新規）   | 「階層表示」/「カード表示」を切り替え（デフォルト: 階層表示） |
| 目標ツリー           | GoalTreeView（新規） | 階層構造を縦に階段状に積む形式で表示（デフォルト表示）        |
| 目標カード           | GoalCard（新規）     | 目標の基本情報（目標名、期間、階層等）を表示（切り替え表示）  |
| 空状態メッセージ     | AlertBanner          | 目標未作成時                                                  |

### 3.2 目標作成・編集画面

| 項目             | コンポーネント          | 備考                                                           |
| :--------------- | :---------------------- | :------------------------------------------------------------- |
| 目標名入力       | InputField              | 必須、最大100文字、文字数カウンター                            |
| 目標の説明入力   | TextareaField           | 任意、最大1000文字、文字数カウンター                           |
| 開始日入力       | DateField               | 必須                                                           |
| 終了日入力       | DateField               | 必須                                                           |
| 上位目標選択     | GoalSelectField（新規） | 任意、ドロップダウンで上位目標を選択（最上位の場合は「なし」） |
| 目標の性質選択   | Select（新規）          | 任意、スキル習得/プロジェクト完了/習慣形成/その他から選択      |
| 達成基準入力     | TextareaField           | 任意、最大500文字、文字数カウンター                            |
| 保存ボタン       | Button (Primary)        | 「保存する」                                                   |
| キャンセルボタン | Button (Secondary)      | 「キャンセル」                                                 |

### 3.3 目標詳細画面

| 項目                     | コンポーネント     | 備考                                               |
| :----------------------- | :----------------- | :------------------------------------------------- |
| 目標情報セクション       | Card               | 目標の詳細情報を表示                               |
| 下位目標一覧セクション   | Card               | 下位目標の一覧を表示                               |
| 編集ボタン               | Button (Secondary) | 「編集」                                           |
| 下位目標を作成ボタン     | Button (Secondary) | 「下位目標を作成」                                 |
| 削除ボタン               | Button (Danger)    | 「削除」                                           |
| 週次フォーカス設定ボタン | Button (Secondary) | 「週次フォーカスを設定」（短期目標の場合のみ表示） |

### 3.4 目標階層表示画面

**注意**: 目標一覧画面のデフォルト表示が階層表示になったため、この画面は削除または統合を検討（Phase 1では実装しない可能性あり）

### 3.5 週次フォーカス接続UI（既存機能の拡張）

| 項目                 | コンポーネント          | 備考                                            |
| :------------------- | :---------------------- | :---------------------------------------------- |
| 週次フォーカスカード | WeeklyFocusCard（既存） | 短期目標を表示（`goalId` が設定されている場合） |
| 目標表示             | Badge（新規）           | 週次フォーカスカードに短期目標名をバッジで表示  |

---

## 4. 既存コンポーネントの活用計画

### 4.1 使用可能な既存コンポーネント

| コンポーネント  | 用途                                       | 備考                     |
| :-------------- | :----------------------------------------- | :----------------------- |
| Button          | 保存ボタン、キャンセルボタン、削除ボタン等 | 既存コンポーネントを活用 |
| InputField      | 目標名入力                                 | 既存コンポーネントを活用 |
| TextareaField   | 目標の説明、達成基準入力                   | 既存コンポーネントを活用 |
| DateField       | 開始日・終了日入力                         | 既存コンポーネントを活用 |
| Card            | 目標詳細、下位目標一覧のカード             | 既存コンポーネントを活用 |
| AlertBanner     | エラーメッセージ、空状態メッセージ         | 既存コンポーネントを活用 |
| Toast           | 成功メッセージ表示                         | 既存コンポーネントを活用 |
| WeeklyFocusCard | 週次フォーカスカード（拡張）               | 既存コンポーネントを拡張 |

### 4.2 新規コンポーネントが必要な項目

| コンポーネント  | 用途             | 理由                                                       |
| :-------------- | :--------------- | :--------------------------------------------------------- |
| GoalCard        | 目標カード       | 目標の基本情報（目標名、期間、階層等）を表示する専用カード |
| GoalTreeView    | 階層構造の可視化 | 階層構造をツリー形式で表示する専用コンポーネント           |
| GoalSelectField | 上位目標選択     | 上位目標を選択するドロップダウン（既存Selectの拡張を検討） |

**判断根拠**:

- GoalCard: 目標の基本情報（目標名、期間、階層等）を表示する専用カードが必要
- GoalTreeView: 階層構造の可視化は専用のコンポーネントが必要
- GoalSelectField: 上位目標を選択するドロップダウンが必要（既存Selectの拡張を検討）

---

## 5. レイアウト方針

### 5.1 モバイルファースト設計

- すべての画面をモバイルファーストで設計
- レスポンシブ対応（PC時は中央寄せ・最大幅制限）

### 5.2 グリッドシステム

- 既存のグリッドシステムを活用
- 12カラムグリッドシステム（PC時）

### 5.3 スペーシング

- カード間の余白: `1rem` (16px)
- セクション間の余白: `1.5rem` (24px)
- フォームフィールド間の余白: `1rem` (16px)

---

## 6. インタラクション

### 6.1 目標作成・編集

- 必須項目未入力時は保存ボタン非活性 or エラー表示
- バリデーションエラーはリアルタイムで表示
- 保存完了時はトースト通知 + 目標一覧画面へ遷移
- キャンセル時は確認ダイアログ（入力がある場合）

### 6.2 目標削除

- 削除ボタン押下時は確認ダイアログを表示
- 下位目標が存在する場合は削除を許可しない（エラーメッセージを表示）
- 削除完了時はトースト通知 + 目標一覧画面へ遷移

### 6.3 階層構造の可視化

- 階層ツリーで展開・折りたたみが可能
- 目標をクリックで目標詳細に遷移
- 階層の深さをインデントで表現

### 6.4 週次フォーカスとの接続

- 短期目標の詳細画面で「週次フォーカスを設定」ボタンを表示
- ボタン押下時は既存の週次フォーカス一覧を表示
- 週次フォーカスを選択して接続
- 接続完了時はトースト通知

---

## 7. デザイントークン

### 7.1 カラー

既存のデザインシステムを利用。

| 用途             | トークン              | 説明 |
| :--------------- | :-------------------- | :--- |
| 保存ボタン       | `--color-primary-500` | 青   |
| 削除ボタン       | `--color-error-500`   | 赤   |
| エラーメッセージ | `--color-error-500`   | 赤   |
| 成功メッセージ   | `--color-success`     | 緑   |

### 7.2 スペーシング

- カード間の余白: `1rem` (16px)
- セクション間の余白: `1.5rem` (24px)
- フォームフィールド間の余白: `1rem` (16px)

---

## 8. ワイヤーフレーム

### 8.1 目標一覧画面（階層表示 - デフォルト）

```
┌──────────────────────────┐
│ ← 目標管理                │
├──────────────────────────┤
│ [ 目標を作成 ] [階層|カード]│ ← トグルボタン
├──────────────────────────┤
│ ┌────────────────────┐   │
│ │ ▼ 🎯 スキル習得     │   │ ← 長期目標
│ │   長期目標          │   │
│ │   2025-01-01 〜     │   │
│ │   2025-06-30        │   │
│ └────────────────────┘   │
│     │                    │
│     ├─┌────────────────┐ │
│     │ │ ▼ 🎯 React基礎  │ │ ← 中期目標（階段状）
│     │ │   中期目標      │ │
│     │ │   2025-01-01 〜 │ │
│     │ │   2025-03-31    │ │
│     │ └────────────────┘ │
│     │     │              │
│     │     ├─┌──────────┐ │
│     │     │ │ 🎯 週次  │ │ ← 短期目標（階段状）
│     │     │ │ 短期目標 │ │
│     │     │ │ 2025-01  │ │
│     │     │ └──────────┘ │
│     │     │              │
│     │     └─┌──────────┐ │
│     │       │ 🎯 チュート│ │ ← 短期目標（階段状）
│     │       │ 短期目標  │ │
│     │       │ 2025-01   │ │
│     │       └──────────┘ │
│     │                    │
│     └─┌────────────────┐ │
│       │ ▶ 🎯 Next.js    │ │ ← 中期目標（折りたたみ）
│       │   中期目標      │ │
│       │   2025-04-01 〜 │ │
│       │   2025-06-30    │ │
│       └────────────────┘ │
│                          │
│ ┌────────────────────┐   │
│ │ ▶ 🎯 プロジェクト完了│ │ ← 長期目標（折りたたみ）
│ │   長期目標          │   │
│ │   2025-01-01 〜     │   │
│ │   2025-12-31        │   │
│ └────────────────────┘   │
└──────────────────────────┘
```

### 8.1-2 目標一覧画面（カード表示 - 切り替え表示）

```
┌──────────────────────────┐
│ ← 目標管理                │
├──────────────────────────┤
│ [ 目標を作成 ] [階層|カード]│ ← トグルボタン（カード選択）
├──────────────────────────┤
│ ┌────────────────────┐   │
│ │ 🎯 スキル習得       │   │
│ │ 2025-01-01 〜      │   │
│ │ 2025-06-30         │   │
│ │ 📊 長期目標        │   │
│ └────────────────────┘   │
│ ┌────────────────────┐   │
│ │ 🎯 React基礎を習得 │   │
│ │ 2025-01-01 〜      │   │
│ │ 2025-03-31         │   │
│ │ 📊 中期目標        │   │
│ └────────────────────┘   │
└──────────────────────────┘
```

### 8.2 目標作成画面

```
┌──────────────────────────┐
│ ← 目標を作成              │
├──────────────────────────┤
│ 目標名 *                  │
│ [________________]        │
│                           │
│ 目標の説明                │
│ [________________]        │
│ [________________]        │
│                           │
│ 開始日 *                  │
│ [2025-01-01 ▼]            │
│                           │
│ 終了日 *                  │
│ [2025-06-30 ▼]            │
│                           │
│ 上位目標                  │
│ [なし ▼]                  │
│                           │
│ 目標の性質                │
│ [スキル習得 ▼]            │
│                           │
│ 達成基準                  │
│ [________________]        │
│                           │
│ [ キャンセル ] [ 保存する ]│
└──────────────────────────┘
```

### 8.3 目標詳細画面

```
┌──────────────────────────┐
│ ← 目標詳細                │
├──────────────────────────┤
│ 🎯 スキル習得             │
│                           │
│ 期間: 2025-01-01 〜      │
│       2025-06-30         │
│                           │
│ 説明:                     │
│ フロントエンド開発の...   │
│                           │
│ 達成基準:                 │
│ React/Next.jsで...        │
│                           │
│ [ 編集 ] [ 下位目標を作成 ]│
│ [ 削除 ]                  │
│                           │
│ ── 下位目標 ──            │
│                           │
│ • 中期目標1               │
│ • 中期目標2               │
│                           │
│ [ 週次フォーカスを設定 ]  │ ← 短期目標の場合のみ
└──────────────────────────┘
```

### 8.4 目標階層表示画面

```
┌──────────────────────────┐
│ ← 目標階層                │
├──────────────────────────┤
│ ▼ 長期目標1               │
│   ├─ 中期目標1            │
│   │  ├─ 短期目標1         │
│   │  └─ 短期目標2         │
│   └─ 中期目標2            │
│      └─ 短期目標3         │
│                           │
│ ▶ 長期目標2               │
│                           │
│ ▼ 長期目標3               │
│   └─ 中期目標3            │
└──────────────────────────┘
```

### 8.5 週次フォーカスカード（拡張）

```
┌──────────────────────────┐
│ ✨ よかったこと           │
│ 内容: チーム会議で...     │
│ [進行中] 成功: 1回       │
│                           │
│ 🎯 短期目標: スキル習得   │ ← 新規追加（goalId接続時）
│                           │
│ 📅 2025-12-05            │
│ [ フォローアップ ]        │
│ [ 日報を見る ]            │
└──────────────────────────┘
```

---

## 9. 状態遷移

### 9.1 目標作成フロー

```
[目標一覧] → [目標作成] → [入力] → [保存] → [目標一覧]（トースト通知）
                ↓
            [キャンセル] → [目標一覧]
```

### 9.2 目標編集フロー

```
[目標詳細] → [編集] → [入力] → [保存] → [目標詳細]（トースト通知）
                ↓
            [キャンセル] → [目標詳細]
```

### 9.3 目標削除フロー

```
[目標詳細] → [削除] → [確認ダイアログ] → [削除実行] → [目標一覧]（トースト通知）
                ↓
            [キャンセル] → [目標詳細]
```

### 9.4 下位目標作成フロー

```
[目標詳細] → [下位目標を作成] → [目標作成]（parentId自動設定） → [保存] → [目標詳細]（トースト通知）
```

### 9.5 週次フォーカス接続フロー

```
[目標詳細]（短期目標） → [週次フォーカスを設定] → [週次フォーカス選択] → [接続] → [目標詳細]（トースト通知）
```

---

## 10. エラーハンドリング

### 10.1 バリデーションエラー

- エラーメッセージは該当フィールドの下に表示
- エラーフィールドは視覚的に強調（赤枠等）
- 保存ボタンは非活性化

### 10.2 ネットワークエラー

- リトライボタン付きエラーメッセージを表示
- AlertBannerコンポーネントを使用

### 10.3 サーバーエラー

- 「エラーが発生しました。しばらく経ってから再試行してください」を表示
- AlertBannerコンポーネントを使用

---

## 11. アクセシビリティ

### 11.1 キーボード操作

- すべての操作をキーボードで実行可能
- Tabキーでフォーカス移動
- Enterキーでボタン実行

### 11.2 スクリーンリーダー対応

- 適切なaria-labelを設定
- フォームフィールドにaria-describedbyを設定
- エラーメッセージにaria-liveを設定

### 11.3 フォーカス状態

- フォーカス状態を視覚的に明確に表示
- フォーカスリングを表示

---

## 12. レスポンシブ対応

### 12.1 モバイル（< 768px）

- 1カラムレイアウト
- カードは全幅表示
- フォームは全幅表示

### 12.2 タブレット（768px 〜 1024px）

- 1カラムレイアウト
- カードは最大幅を制限して中央寄せ
- フォームは最大幅を制限して中央寄せ

### 12.3 PC（> 1024px）

- 1カラムレイアウト
- カードは最大幅を制限して中央寄せ
- フォームは最大幅を制限して中央寄せ

---

## 13. 既存コンポーネントの拡張

### 13.1 WeeklyFocusCardの拡張

**追加項目**:

- `goalId` フィールドが設定されている場合、短期目標名をバッジで表示
- バッジは「🎯 短期目標名」の形式で表示

**実装方針**:

- 既存のWeeklyFocusCardコンポーネントを拡張
- `goalId` が設定されている場合のみバッジを表示

---

## 14. 新規コンポーネントの設計

### 14.1 GoalCard

**用途**: 目標の基本情報を表示するカード

**Props**:

- `goal`: Goal（目標データ）
- `onClick`: クリック時のコールバック

**表示項目**:

- 目標名
- 期間（開始日 〜 終了日）
- 階層レベル（長期目標/中期目標/短期目標）
- 目標の性質（オプション）

### 14.2 GoalTreeView

**用途**: 階層構造をツリー形式で表示（縦に階段状に積む形式）

**Props**:

- `goals`: Goal[]（階層構造を含む目標データ）
- `onGoalClick`: 目標クリック時のコールバック

**機能**:

- 階層構造をツリー形式で表示
- 展開・折りたたみ機能
- 縦に階段状に積む形式で階層の深さを表現（横並びのインデントではなく、縦に積み重ねる）
- 各階層を視覚的に区別（線やインデントで表現）

**コンポーネント化の方針**:

- ツリー構造をコンポーネント化することで、他の画面でも再利用可能にする
- 例: 目標詳細画面の下位目標一覧でも、同じツリー構造コンポーネントを使用可能
- 汎用的なTreeViewコンポーネントとして設計し、目標以外の階層構造にも対応できるようにする（将来拡張）

### 14.3 GoalSelectField

**用途**: 上位目標を選択するドロップダウン

**Props**:

- `value`: string | null（選択された目標ID）
- `onChange`: (goalId: string | null) => void
- `excludeGoalId`: string | null（除外する目標ID、循環参照防止用）

**機能**:

- 上位目標の一覧を表示
- 「なし」オプション（最上位目標の場合）
- 除外する目標IDを指定可能（循環参照防止）

### 14.4 ViewToggle

**用途**: ビュー切り替えトグル（階層表示/カード表示）

**Props**:

- `viewType`: 'tree' | 'card'（現在のビュー）
- `onChange`: (viewType: 'tree' | 'card') => void

**機能**:

- 階層表示とカード表示を切り替え
- デフォルトは階層表示
- アクティブ状態の視覚的フィードバック

---

## 15. 実装チェックリスト

### Phase 1（MVP）

- [ ] GoalCardコンポーネント実装
- [ ] GoalTreeViewコンポーネント実装（縦に階段状に積む形式）
- [ ] GoalSelectFieldコンポーネント実装
- [ ] ViewToggleコンポーネント実装
- [ ] 目標一覧画面実装（デフォルト: 階層表示、切り替え: カード表示）
- [ ] 目標作成画面実装
- [ ] 目標編集画面実装
- [ ] 目標詳細画面実装
- [ ] 週次フォーカスカードの拡張
- [ ] バリデーション実装
- [ ] エラーハンドリング実装
- [ ] レスポンシブ対応

---

## 関連ドキュメント

- PRD: `docs/features/goal-hierarchy-management/prd.md`
- Tech Spec: `docs/features/goal-hierarchy-management/tech_spec.md`
- Design Research: `docs/features/goal-hierarchy-management/des_research.md`
- デザインシステムルール: `.cursor/rules/design_system_rules.mdc`（実体はStorybook: `apps/web/src/stories/`）
- 既存機能: `docs/features/weekly-focus-management/ui_design.md`（週次フォーカス管理機能）

---

---

## 16. セルフレビュー結果

### 16.1 PRD ↔ UI Design 整合性チェック

#### ✅ 整合している項目

| 項目                       | PRD                                                      | UI Design                                    | 状態 |
| :------------------------- | :------------------------------------------------------- | :------------------------------------------- | :--- |
| 目標の階層構造定義・管理   | 目標を階層的に定義・管理できる                           | 目標一覧、目標作成・編集画面で実現           | ✅   |
| 目標間の関係性可視化       | 階層構造をツリー形式で表示                               | 目標階層表示画面でGoalTreeViewを使用         | ✅   |
| 週次フォーカスとの接続     | 短期目標から週次フォーカスを設定可能                     | 目標詳細画面で「週次フォーカスを設定」ボタン | ✅   |
| 目標の作成・編集・削除     | 目標の作成・編集・削除が可能                             | 目標作成・編集・詳細画面で実現               | ✅   |
| 目標の階層的ブレイクダウン | 長期目標から中期目標、短期目標へと階層的にブレイクダウン | 目標詳細画面で「下位目標を作成」ボタン       | ✅   |

#### ✅ ユーザーストーリーの実現確認

| US   | ユーザーストーリー             | UI Designでの実現方法                        | 状態 |
| :--- | :----------------------------- | :------------------------------------------- | :--- |
| US-1 | 長期目標の作成                 | 目標作成画面で実現                           | ✅   |
| US-2 | 目標の階層的ブレイクダウン     | 目標詳細画面で「下位目標を作成」ボタン       | ✅   |
| US-3 | 目標間の関係性の確認           | 目標階層表示画面でGoalTreeViewを使用         | ✅   |
| US-4 | 目標の階層構造の一覧表示       | 目標一覧画面で実現                           | ✅   |
| US-5 | 週次フォーカスと短期目標の接続 | 目標詳細画面で「週次フォーカスを設定」ボタン | ✅   |
| US-6 | 目標の編集・削除               | 目標詳細画面で「編集」「削除」ボタン         | ✅   |

### 16.2 UX品質の確認

#### ✅ 画面構成

- すべての画面が適切に定義されている
- 画面遷移が明確
- ユーザーフローが自然

#### ✅ UIコンポーネント

- 既存コンポーネントを適切に活用
- 新規コンポーネントが必要な項目が明確
- コンポーネントの用途が明確

#### ✅ レイアウト

- モバイルファースト設計
- レスポンシブ対応
- 既存のグリッドシステムを活用

#### ✅ インタラクション

- ユーザー操作が明確
- エラーハンドリングが適切
- フィードバック（トースト通知等）が適切

#### ✅ アクセシビリティ

- キーボード操作対応
- スクリーンリーダー対応
- フォーカス状態の視覚化

### 16.3 改善点

**現時点での改善点**: なし

UI DesignはPRDの要件を正しく実現しており、UX品質も確認できました。

---

---

## 17. レビュー結果

### PdMレビュー

- **レビュー日**: 2025-12-13
- **承認者**: PdM
- **評価**: PRDの要件を正しく実現しており、要件充足度は十分。ユーザーストーリーもすべて実現されている。

---

---

## 18. プロトタイプ改善（humanフィードバック反映）

### 18.1 改善内容

**humanからのフィードバック**:

- ツリー構造をデフォルトの見え方にしたい
- 見せ方の切り替えはトグルボタンでできるとよさそう
- 階層は横並びではなく、縦に階段状に積んでいく感じでできる？

**反映内容**:

- 目標一覧画面のデフォルト表示を階層表示（ツリー形式）に変更
- ビュー切り替えトグルボタン（階層表示/カード表示）を追加
- 階層構造を縦に階段状に積む形式で表示（横並びのインデントではなく、縦に積み重ねる）
- ViewToggleコンポーネントを新規追加

**更新日**: 2025-12-13

---

## 19. レビュー結果

### PdMレビュー

- **レビュー日**: 2025-12-13
- **承認者**: PdM
- **評価**: PRDの要件を正しく実現しており、要件充足度は十分。ユーザーストーリーもすべて実現されている。

### Helperレビュー

- **レビュー日**: 2025-12-13
- **承認者**: Helper
- **評価**: 適切に設計されているが、改善提案あり（目標名・説明の表示最適化、下位目標一覧の表示最適化、目標一覧のパフォーマンス最適化）

**改善提案の反映状況**: Phase 2以降で検討（Phase 1のMVPとしては問題なし）

### humanレビュー

- **レビュー日**: 2025-12-13
- **承認者**: human
- **評価**: 承認（Approved）
- **フィードバック**: ツリー構造をコンポーネント化すると再利用できて良さそう

**改善提案の反映状況**: GoalTreeViewのコンポーネント化方針を追加（再利用性を考慮した設計）

---

_本UI Designは Approved ステータスです。すべてのレビュー（PdM、Helper、human）完了後、承認されました。_
