# Tech Spec PdMレビュー

**機能名**: 日報と目標の関連付け機能
**レビュー日**: 2025-12-16
**レビュアー**: PdM
**ステータス**: Approved

---

## 1. レビュー観点

### 1.1 PRDの要件が正しく実現されているか

#### US-1: 日報作成時の目標関連付け

- [x] `CreateDailyReportRequest` に `goalIds` フィールドが追加されている
- [x] 関連付けは任意（必須ではない）として設計されている
- [x] 複数の目標を選択できる設計になっている
- [x] 選択した目標が日報作成画面に表示される（`GoalSelectField` コンポーネント）

**判定**: ✅ 要件を満たしている

#### US-2: 日報編集時の目標関連付けの変更

- [x] `UpdateDailyReportRequest` に `goalIds` フィールドが追加されている
- [x] 既存の関連付けを削除し、新しい関連付けを作成する設計になっている
- [x] 目標の関連付けを変更しても、他のフィールドに影響しない

**判定**: ✅ 要件を満たしている

#### US-3: 日報一覧での目標表示

- [x] `DailyReportResponse` に `goals` フィールドが追加されている
- [x] 目標が複数ある場合は、すべて表示される（最大3つまで、それ以上は「+N」）
- [x] 目標が関連付けられていない日報は、空状態を表示する（`GoalChip` コンポーネント）

**判定**: ✅ 要件を満たしている

#### US-4: 目標詳細画面での関連日報表示

- [x] `GoalDetailResponse` に `relatedDailyReports` フィールドが追加されている
- [x] 日報は時系列（新しい順/古い順）で並び替えられる（`sort` パラメータ）
- [x] 関連日報の総数が表示される（`relatedDailyReportsCount`）
- [x] 日報をクリックすると、日報詳細画面に遷移できる（フロントエンドで実装）

**判定**: ✅ 要件を満たしている

#### US-5: 目標階層構造との整合性

- [x] 長期目標、中期目標、短期目標のいずれにも日報を関連付けられる
- [x] 目標選択時に、目標の階層構造が視覚的に表現される（`GoalSelectField` コンポーネント）
- [x] どの階層レベルの目標に関連付けられているか明確に分かる（`GoalSummary` に階層情報を含める）

**判定**: ✅ 要件を満たしている

### 1.2 機能要件の実現

#### 3.1 日報と目標の関連付け

- [x] 日報作成時の目標選択が実装されている
- [x] 日報編集時の目標変更が実装されている
- [x] 目標選択の制約が定義されている（削除された目標は選択できない）

**判定**: ✅ 要件を満たしている

#### 3.2 日報一覧での目標表示

- [x] 目標名をチップ形式で表示する（`GoalChip` コンポーネント）
- [x] 複数目標の表示が実装されている（最大3つまで）
- [x] 目標クリック動作が定義されている（目標詳細画面に遷移）
- [x] 空状態の表示が定義されている

**判定**: ✅ 要件を満たしている

#### 3.3 目標詳細画面での関連日報表示

- [x] 関連日報を一覧表示する（`RelatedDailyReportsList` コンポーネント）
- [x] 並び替え機能が実装されている（`sort` パラメータ）
- [x] 日報総数表示が実装されている（`relatedDailyReportsCount`）
- [x] ページネーションが実装されている（`limit` と `offset` パラメータ）
- [x] 空状態の表示が定義されている

**判定**: ✅ 要件を満たしている

#### 3.4 目標階層構造との整合性

- [x] 階層レベルの表示が実装されている（`GoalSummary` に `parentId` を含める）
- [x] 親子関係の表示が実装されている（`GoalSelectField` コンポーネント）

**判定**: ✅ 要件を満たしている

### 1.3 非機能要件の実現

#### 4.1 パフォーマンス

- [x] 日報作成画面の読み込み時間: 1秒以内（目標選択のキャッシュで対応）
- [x] 目標詳細画面での関連日報表示: 1秒以内（ページネーションで対応）
- [x] 目標選択のサジェスト表示: 500ms以内（debounceで対応）

**判定**: ✅ 要件を満たしている

#### 4.2 データ整合性

- [x] 削除された目標への関連付けは保持されるが、選択肢には表示されない
- [x] 目標の期間変更は、既存の関連付けに影響しない

**判定**: ✅ 要件を満たしている

#### 4.3 アクセシビリティ

- [x] 目標選択フィールドはキーボード操作に対応（`GoalSelectField` コンポーネント）
- [x] スクリーンリーダーに対応（目標名と階層レベルを読み上げ）

**判定**: ✅ 要件を満たしている（実装時に確認）

#### 4.4 レスポンシブ対応

- [x] デザインシステムに準拠したレスポンシブ対応が計画されている

**判定**: ✅ 要件を満たしている（実装時に確認）

### 1.4 エッジケースの対応

#### 6.1 削除された目標への対応

- [x] 削除された目標は「削除済み」として表示し、クリックできない

**判定**: ✅ PRDの要件を満たしている

#### 6.2 目標の期間外の日報

- [x] 期間外でも関連付け可能（警告表示なし）

**判定**: ✅ PRDの要件を満たしている

#### 6.3 大量の目標が関連付けられた場合

- [x] 日報一覧では最大3つまで表示し、それ以上は「+N」と表示
- [x] 関連付け可能な目標数に上限を設ける（最大10個）

**判定**: ✅ PRDの要件を満たしている（Helperレビューで追加された改善）

#### 6.4 目標の名前変更

- [x] 関連付けはIDで管理されるため、目標名が変更されても自動的に最新の名前が表示される

**判定**: ✅ PRDの要件を満たしている

### 1.5 ビジネスルールの実現

#### 7.1 関連付けの任意性

- [x] 日報と目標の関連付けは任意（必須ではない）
- [x] 関連付けなしでも日報を作成・保存できる

**判定**: ✅ PRDの要件を満たしている

#### 7.2 複数目標への関連付け

- [x] 1つの日報を複数の目標に関連付けられる
- [x] 関連付ける目標の数に上限がある（最大10個）

**判定**: ✅ PRDの要件を満たしている（Helperレビューで追加された改善）

#### 7.3 削除時の挙動

- [x] 日報を削除した場合、目標との関連付けも削除される
- [x] 目標を削除した場合、関連付けは保持されるが「削除済み」として表示される

**判定**: ✅ PRDの要件を満たしている

---

## 2. 要件充足度の総合評価

### 2.1 機能要件

- **US-1**: ✅ 完全に満たしている
- **US-2**: ✅ 完全に満たしている
- **US-3**: ✅ 完全に満たしている
- **US-4**: ✅ 完全に満たしている
- **US-5**: ✅ 完全に満たしている
- **US-6**: ✅ 完全に満たしている（日報編集・削除は既存機能）

### 2.2 非機能要件

- **パフォーマンス**: ✅ 完全に満たしている
- **データ整合性**: ✅ 完全に満たしている
- **アクセシビリティ**: ✅ 計画されている（実装時に確認）
- **レスポンシブ対応**: ✅ 計画されている（実装時に確認）

### 2.3 ビジネスルール

- **関連付けの任意性**: ✅ 完全に満たしている
- **複数目標への関連付け**: ✅ 完全に満たしている
- **削除時の挙動**: ✅ 完全に満たしている

---

## 3. 追加コメント

### 3.1 Helperレビューの改善提案について

Helperレビューで提案された改善点（N+1問題の回避、日報削除時の関連付けデータの削除、関連付け可能な目標数の上限）は、すべて Tech Spec に反映されており、適切です。

### 3.2 実装時の注意点

#### 3.2.1 目標選択UIのユーザビリティ

Helperレビューで指摘されているように、目標選択UIのユーザビリティは重要です。以下の点に注意してください：

- 階層構造をツリー形式で表示する（親目標名をインデントまたはラベルで表示）
- 目標数が多い場合でも、スムーズに検索できるようにする（debounce、キャッシュ）
- 選択済みの目標が視覚的に分かりやすいようにする

#### 3.2.2 日報一覧での目標表示の優先順位

Tech Specでは「ユーザーが選択した順序（最初の3つ）」と定義されていますが、これで問題ありません。Phase 2以降で、優先順位のカスタマイズを検討することもできます。

#### 3.2.3 Phase 2以降の機能拡張

Phase 2以降で検討する機能（自動関連付けの提案、関連付けの履歴管理等）は、ユーザーフィードバックを基に優先順位を決定してください。

---

## 4. 承認

Tech Spec は PRD の要件を完全に満たしており、Helperレビューの改善提案も適切に反映されています。

**承認日**: 2025-12-16
**承認者**: PdM

**ステータス**: Approved

次のステップ（QAによるテスト戦略の策定、Desによる UI Design作成）に進むことを承認します。

---

_本レビューは、Tech Spec が PRD の要件を満たしているか確認したものです。_
