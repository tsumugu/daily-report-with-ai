# 日報と目標の関連付け機能 UI/UX設計書（UI Design）

**バージョン**: v1
**作成日**: 2025-12-16
**作成者**: Des
**ステータス**: Approved
**承認日**: 2025-12-16
**承認者**: PdM, Helper

---

## 1. 概要

日報と目標の関連付け機能のUI/UX設計方針を定義する。
日報作成・編集時に目標を選択し、日報一覧・目標詳細画面で関連情報を表示する画面・コンポーネントの設計を記載する。

---

## 2. 画面構成

### 2.1 日報作成画面（既存画面の拡張）

既存の日報作成画面に以下を追加：

- **目標選択セクション**（新規追加）：目標選択フィールド、選択済み目標のチップ表示
- **既存のフィールド**：日付、やったこと、学んだこと、よかったこと、改善点
- **フッター**：保存ボタン、キャンセルボタン

**追加位置**: 日付フィールドの直後、「やったこと」フィールドの前

### 2.2 日報編集画面（既存画面の拡張）

既存の日報編集画面に以下を追加：

- **目標選択セクション**（新規追加）：目標選択フィールド、選択済み目標のチップ表示（削除ボタン付き）
- **既存のフィールド**：日付、やったこと、学んだこと、よかったこと、改善点
- **フッター**：保存ボタン、キャンセルボタン

**追加位置**: 日付フィールドの直後、「やったこと」フィールドの前

### 2.3 日報一覧画面（既存画面の拡張）

既存の日報一覧画面（カード形式）に以下を追加：

- **日報カード内**: 各日報カードに関連目標をチップ形式で表示（最大3つ、それ以上は「+N」）
- **表示位置**: 日付の下、「やったこと」の前

### 2.4 日報詳細画面（既存画面の拡張）

既存の日報詳細画面に以下を追加：

- **関連目標セクション**（新規追加）：関連目標をチップ形式で表示
- **表示位置**: 日付の下、「やったこと」の前

### 2.5 目標詳細画面（既存画面の拡張）

既存の目標詳細画面に以下を追加：

- **関連日報セクション**（新規追加）：関連する日報の一覧を表示
- **表示位置**: 週次フォーカスセクションの下

---

## 3. UIコンポーネント

### 3.1 日報作成・編集画面

| 項目               | コンポーネント               | 備考                                                                 |
| :----------------- | :--------------------------- | :------------------------------------------------------------------- |
| 目標選択フィールド | GoalMultiSelectField（新規） | 複数選択可能、検索可能、階層構造を視覚的に表示                       |
| 選択済み目標チップ | GoalChip（新規）             | 目標名を表示、削除ボタン付き（編集時）、クリックで目標詳細画面に遷移 |
| 既存のフィールド   | InputField, TextareaField 等 | 既存コンポーネントを活用                                             |
| 保存ボタン         | Button (Primary)             | 「保存する」                                                         |
| キャンセルボタン   | Button (Secondary)           | 「キャンセル」                                                       |

### 3.2 日報一覧画面

| 項目       | コンポーネント   | 備考                                                              |
| :--------- | :--------------- | :---------------------------------------------------------------- |
| 日報カード | Card（既存）     | 既存の日報カードに目標チップを追加                                |
| 目標チップ | GoalChip（新規） | 最大3つ表示、それ以上は「+N」と表示、クリックで目標詳細画面に遷移 |

### 3.3 日報詳細画面

| 項目               | コンポーネント   | 備考                                       |
| :----------------- | :--------------- | :----------------------------------------- |
| 関連目標セクション | Card（既存）     | 関連目標を表示するカード                   |
| 目標チップ         | GoalChip（新規） | 目標名を表示、クリックで目標詳細画面に遷移 |

### 3.4 目標詳細画面

| 項目               | コンポーネント                  | 備考                                                               |
| :----------------- | :------------------------------ | :----------------------------------------------------------------- |
| 関連日報セクション | Card（既存）                    | 関連日報を表示するカード                                           |
| 関連日報一覧       | RelatedDailyReportsList（新規） | 日報の一覧を表示、並び替え・ページネーション対応                   |
| 日報アイテム       | DailyReportListItem（新規）     | 日報の概要（日付、やったこと）を表示、クリックで日報詳細画面に遷移 |
| 並び替えセレクト   | Select（既存）                  | 「新しい順」/「古い順」を選択                                      |
| もっと見るボタン   | Button (Secondary)              | 追加の日報を読み込む                                               |

---

## 4. 既存コンポーネントの活用計画

### 4.1 使用可能な既存コンポーネント

| コンポーネント    | 用途                                               | 備考                                                  |
| :---------------- | :------------------------------------------------- | :---------------------------------------------------- |
| Button            | 保存ボタン、キャンセルボタン、もっと見るボタン等   | 既存コンポーネントを活用                              |
| InputField        | 目標名入力（目標選択フィールド内）                 | 既存コンポーネントを活用                              |
| Card              | 日報カード、関連目標セクション、関連日報セクション | 既存コンポーネントを活用                              |
| Select            | 並び替えセレクト                                   | 既存コンポーネントを活用                              |
| EntitySelectField | 目標選択フィールドの参考                           | BL-01で作成、複数選択対応のため新規コンポーネント作成 |
| Toast             | 成功メッセージ表示                                 | 既存コンポーネントを活用                              |

### 4.2 新規コンポーネントが必要な項目

| コンポーネント          | 用途                                 | 理由                                                                                       |
| :---------------------- | :----------------------------------- | :----------------------------------------------------------------------------------------- |
| GoalMultiSelectField    | 目標を複数選択するセレクトフィールド | 複数選択可能、検索可能、階層構造を表示する専用コンポーネントが必要                         |
| GoalChip                | 目標を表示するチップ                 | 目標名を表示し、クリックで目標詳細画面に遷移する専用チップが必要                           |
| RelatedDailyReportsList | 関連日報の一覧を表示                 | 並び替え・ページネーション対応の関連日報一覧コンポーネントが必要                           |
| DailyReportListItem     | 日報の概要を表示するアイテム         | 日報の概要（日付、やったこと）を表示し、クリックで日報詳細画面に遷移する専用アイテムが必要 |

**判断根拠**:

- **GoalMultiSelectField**: EntitySelectField（BL-01で作成）は単一選択だが、BL-03では複数選択が必要なため、新規コンポーネントを作成
- **GoalChip**: 目標名を表示し、クリックで目標詳細画面に遷移する専用チップが必要（StatusBadgeとは用途が異なる）
- **RelatedDailyReportsList**: 並び替え・ページネーション対応の関連日報一覧コンポーネントが必要
- **DailyReportListItem**: 日報の概要を表示し、クリックで日報詳細画面に遷移する専用アイテムが必要

---

## 5. 新規コンポーネント詳細設計

### 5.1 GoalMultiSelectField

**目的**: 目標を複数選択するセレクトフィールド

**Props**:

```typescript
interface GoalMultiSelectFieldProps {
  value: string[]; // 選択された目標のIDリスト
  onChange: (goalIds: string[]) => void;
  label?: string; // フィールドのラベル（デフォルト: 「関連する目標」）
  placeholder?: string; // プレースホルダー（デフォルト: 「目標を選択」）
  disabled?: boolean; // 無効化フラグ
  error?: string; // エラーメッセージ
  helperText?: string; // ヘルパーテキスト
  maxSelection?: number; // 最大選択数（デフォルト: 10）
}
```

**機能**:

- 目標を検索・選択できる（ドロップダウン形式）
- 検索時は debounce（300ms）を実装し、検索APIの呼び出し回数を減らす
- 複数選択可能（最大10個）
- 目標の階層構造を視覚的に表示（親目標名をラベルで表示）
- 選択された目標はチップ形式で表示される（フィールドの下に表示）
- チップにはGoalChip コンポーネントを使用
- 最大選択数に達した場合は、選択を無効化し、ヘルパーテキストを表示

**デザイン**:

- EntitySelectField（BL-01）を参考にデザイン
- ドロップダウンメニューには目標名と階層レベルを表示
- 親目標がある場合は「親目標名 > 目標名」の形式で表示
- 選択済みの目標はチェックマークを表示

**パフォーマンス**:

- 目標リストをキャッシュし、検索時はクライアント側でフィルタリングする（目標数が100件以下の場合）
- 検索APIには debounce（300ms）を実装する

### 5.2 GoalChip

**目的**: 目標を表示するチップコンポーネント

**Props**:

```typescript
interface GoalChipProps {
  goalId: string; // 目標ID
  goalName: string; // 目標名
  onClick?: () => void; // クリック時のハンドラ（目標詳細画面に遷移）
  onRemove?: () => void; // 削除ボタンのハンドラ（編集時のみ）
  showRemoveButton?: boolean; // 削除ボタンを表示するか（デフォルト: false）
  size?: "small" | "medium"; // サイズ（デフォルト: 'medium')
}
```

**機能**:

- 目標名を表示
- 目標名が長い場合（20文字以上）は省略し「...」を表示
- ホバー時にツールチップで全文を表示
- クリック時に目標詳細画面に遷移（`onClick` が指定されている場合）
- 削除ボタンを表示（`showRemoveButton` が `true` の場合）
- 削除ボタンをクリックすると、`onRemove` ハンドラが呼ばれる

**デザイン**:

- 角丸の矩形（border-radius: 16px）
- 背景色: `--color-neutral-100`（薄いグレー）
- テキスト色: `--color-neutral-900`（濃いグレー）
- パディング: 0.5rem 1rem
- 最小クリック領域: 44px×44px（iOSガイドライン準拠）
- ホバー時: 背景色を少し濃くする（`--color-neutral-200`）、ツールチップで全文を表示（省略されている場合）
- 削除ボタン: 右端に表示、アイコンは「×」、ホバー時は赤くする

### 5.3 RelatedDailyReportsList

**目的**: 関連日報の一覧を表示するコンポーネント

**Props**:

```typescript
interface RelatedDailyReportsListProps {
  goalId: string; // 目標ID
  limit?: number; // 初期表示件数（デフォルト: 10）
  sort?: "asc" | "desc"; // 並び順（デフォルト: 'desc'）
  onSortChange?: (sort: "asc" | "desc") => void; // 並び順変更時のハンドラ
}
```

**機能**:

- 関連日報を一覧表示（日報アイテム形式）
- 並び替え機能（新しい順/古い順）
- 「もっと見る」ボタンで追加読み込み（10件ずつ）
- 空状態の表示（関連日報がない場合）

**デザイン**:

- 並び替えセレクトは右上に配置
- 日報アイテムは縦にスタック
- 各日報アイテム間の余白: 0.75rem
- 「もっと見る」ボタンは中央に配置

### 5.4 DailyReportListItem

**目的**: 日報の概要を表示するアイテムコンポーネント

**Props**:

```typescript
interface DailyReportListItemProps {
  reportId: string; // 日報ID
  date: string; // 日付（YYYY-MM-DD）
  events: string; // やったこと
  onClick?: () => void; // クリック時のハンドラ（日報詳細画面に遷移）
}
```

**機能**:

- 日報の概要（日付、やったこと）を表示
- クリック時に日報詳細画面に遷移（`onClick` が指定されている場合）
- 「やったこと」は3行以上の場合は「...」で省略

**デザイン**:

- カード形式（Card コンポーネントを使用）
- 日付: 太字、サイズ: `--font-size-small`
- やったこと: 通常フォント、サイズ: `--font-size-base`、3行以上は省略
- ホバー時: 背景色を少し濃くする（`--color-neutral-50`）、カーソルをポインターに変更

---

## 6. レイアウト方針

### 6.1 モバイルファースト設計

- すべての画面をモバイルファーストで設計
- レスポンシブ対応（PC時は中央寄せ・最大幅制限）

### 6.2 スペーシング

- 目標選択セクションと既存フィールド間の余白: `1rem` (16px)
- 目標チップ間の余白: `0.5rem` (8px)
- 関連日報アイテム間の余白: `0.75rem` (12px)
- セクション間の余白: `1.5rem` (24px)

---

## 7. インタラクション

### 7.1 日報作成・編集時の目標選択

- 目標選択フィールドをクリックすると、ドロップダウンメニューが表示される
- ドロップダウンメニューで目標を検索・選択できる
- 選択した目標はチップ形式で表示される
- チップの削除ボタンをクリックすると、目標の選択が解除される
- 最大選択数（10個）に達した場合は、選択を無効化し、ヘルパーテキストを表示

### 7.2 日報一覧での目標表示

- 日報カードに目標チップが表示される（最大3つ）
- 3つ以上の目標がある場合は「+N」と表示される
- 目標チップをクリックすると、目標詳細画面に遷移する

### 7.3 目標詳細画面での関連日報表示

- 関連日報が一覧表示される（初期表示: 10件）
- 並び替えセレクトで「新しい順」「古い順」を選択できる
- 日報アイテムをクリックすると、日報詳細画面に遷移する
- 「もっと見る」ボタンをクリックすると、追加の日報が読み込まれる（10件ずつ）
- すべての日報が表示された場合は、「もっと見る」ボタンは非表示

---

## 8. エラーハンドリング

### 8.1 目標選択フィールド

- 最大選択数（10個）を超えた場合: エラーメッセージを表示（「最大10個まで選択できます」）
- 目標の取得に失敗した場合: エラーメッセージを表示（「目標の取得に失敗しました」）

### 8.2 関連日報一覧

- 関連日報の取得に失敗した場合: エラーメッセージを表示（「関連日報の取得に失敗しました」）
- 「もっと見る」ボタンで追加読み込みに失敗した場合: エラーメッセージを表示（「日報の読み込みに失敗しました」）

---

## 9. アクセシビリティ

### 9.1 キーボード操作

- 目標選択フィールドはキーボード操作に対応
  - Tab: フィールドにフォーカス
  - Enter/Space: ドロップダウンメニューを開く
  - ↑/↓: 目標を選択
  - Enter: 目標を選択
  - Esc: ドロップダウンメニューを閉じる

- 目標チップはキーボード操作に対応
  - Tab: チップにフォーカス
  - Enter: 目標詳細画面に遷移
  - Delete/Backspace: チップを削除（削除ボタンがある場合）

### 9.2 スクリーンリーダー対応

- 目標選択フィールド: ラベル、プレースホルダー、エラーメッセージを読み上げ
- 目標チップ: 目標名を読み上げ（「目標: {目標名}」）
- 関連日報アイテム: 日付とやったことを読み上げ（「{日付}: {やったこと}」）

---

## 10. デザイントークン

### 10.1 カラー

既存のデザインシステムを利用。

| 用途               | トークン              | 説明             |
| :----------------- | :-------------------- | :--------------- |
| 目標チップ背景     | `--color-neutral-100` | 薄いグレー       |
| 目標チップテキスト | `--color-neutral-900` | 濃いグレー       |
| 目標チップホバー   | `--color-neutral-200` | グレー           |
| 削除ボタンホバー   | `--color-error-500`   | 赤               |
| 日報アイテムホバー | `--color-neutral-50`  | 非常に薄いグレー |
| エラーメッセージ   | `--color-error-500`   | 赤               |
| 成功メッセージ     | `--color-success`     | 緑               |

### 10.2 タイポグラフィ

既存のデザインシステムを利用。

| 用途                   | トークン            | 説明                 |
| :--------------------- | :------------------ | :------------------- |
| 目標チップテキスト     | `--font-size-small` | 小さいフォントサイズ |
| 日報アイテム日付       | `--font-size-small` | 小さいフォントサイズ |
| 日報アイテムやったこと | `--font-size-base`  | 基本フォントサイズ   |

### 10.3 スペーシング

既存のデザインシステムを利用。

| 用途                 | トークン             | 説明 |
| :------------------- | :------------------- | :--- |
| 目標チップ間の余白   | `--spacing-2` (8px)  | 小   |
| 日報アイテム間の余白 | `--spacing-3` (12px) | 中   |
| セクション間の余白   | `--spacing-6` (24px) | 大   |

---

## 11. 画面フロー

### 11.1 日報作成時の目標関連付けフロー

```
1. 日報作成画面を開く
2. 目標選択フィールドをクリック
3. ドロップダウンメニューで目標を検索・選択
4. 選択した目標がチップ形式で表示される
5. 日報を保存
6. 日報一覧画面に遷移
7. 日報カードに選択した目標がチップ形式で表示される
```

### 11.2 日報編集時の目標変更フロー

```
1. 日報詳細画面を開く
2. 編集ボタンをクリック
3. 日報編集画面に遷移
4. 目標チップの削除ボタンをクリックして目標を削除
5. 目標選択フィールドで新しい目標を追加
6. 日報を保存
7. 日報詳細画面に遷移
8. 更新された目標がチップ形式で表示される
```

### 11.3 目標詳細画面での関連日報確認フロー

```
1. 目標詳細画面を開く
2. 関連日報セクションに関連日報が一覧表示される
3. 並び替えセレクトで並び順を変更
4. 日報アイテムをクリック
5. 日報詳細画面に遷移
6. 戻るボタンをクリックして目標詳細画面に戻る
7. 「もっと見る」ボタンをクリックして追加の日報を読み込む
```

---

## 12. セルフレビュー結果

### 12.1 既存コンポーネントの活用

- [x] 既存コンポーネント（Button、InputField、Card、Select等）を最大限活用している
- [x] 新規コンポーネントは、既存コンポーネントで実現できないものに限定している
- [x] EntitySelectField（BL-01）を参考に、GoalMultiSelectField を設計している

### 12.2 PRDの要件実現

- [x] US-1（日報作成時の目標関連付け）が実現可能なUI設計になっている
- [x] US-2（日報編集時の目標変更）が実現可能なUI設計になっている
- [x] US-3（日報一覧での目標表示）が実現可能なUI設計になっている
- [x] US-4（目標詳細画面での関連日報表示）が実現可能なUI設計になっている
- [x] US-5（目標階層構造との整合性）が実現可能なUI設計になっている

### 12.3 アクセシビリティ

- [x] キーボード操作に対応している
- [x] スクリーンリーダーに対応している
- [x] エラーメッセージが明確に表示される

### 12.4 レスポンシブ対応

- [x] モバイルファーストで設計されている
- [x] PC時の表示も考慮されている

**ステータス**: Approved（Helperレビューの改善提案を反映済み）

---

_本UI Designは、日報と目標の関連付け機能のUI/UX設計を定義したものです。_
