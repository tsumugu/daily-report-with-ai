# 編集機能 UI/UX設計書（UI Design）

**バージョン**: Phase 3-1  
**作成日**: 2025-01-XX  
**作成者**: Des  
**ステータス**: Approved  
**承認日**: 2025-01-XX  
**承認者**: PdM, Helper（レビュー完了）

---

## 1. 概要

編集機能のUI/UX設計方針を定義する。  
日報の編集機能、エピソード/アクションの編集機能の設計を記載する。

---

## 2. 画面構成

### 2.1 日報詳細画面（拡張）

- ページヘッダー：戻るボタン、ページタイトル（例: 「2025-01-15の日報」）、**「編集する」ボタン**（Phase 3-1で有効化）
- 日報コンテンツ：日付、できごと、学び、よかったこと一覧、改善点一覧

### 2.2 日報編集画面

- ページヘッダー：戻るボタン、ページタイトル（例: 「日報を編集」）
- フォーム部：各入力フィールド（日報入力画面と同じフォーマット、既存データを読み込み）
- フッター：キャンセルボタン、保存ボタン

### 2.3 エピソード/アクション編集モーダル

- モーダルオーバーレイ：半透明背景
- モーダルヘッダー：タイトル（例: 「エピソードを編集」）、閉じるボタン
- エピソード/アクション入力フォーム：日付入力（必須）、メモ入力（最大500文字、文字数カウンター付き）
- モーダルフッター：キャンセルボタン、保存ボタン

### 2.4 フォローアップ画面（拡張）

- エピソード/アクションカード：**編集ボタン**を追加（削除ボタンの近く、右側）

---

## 3. UIコンポーネント

### 3.1 日報詳細画面

| 項目           | コンポーネント   | 備考                                           |
| :------------- | :--------------- | :--------------------------------------------- |
| 編集ボタン     | Button (Outline) | ヘッダー右側に配置、「編集する」ラベル         |
| 日報コンテンツ | Card             | 既存の日報詳細表示コンポーネントをそのまま使用 |

### 3.2 日報編集画面

| 項目              | コンポーネント      | 備考                                                 |
| :---------------- | :------------------ | :--------------------------------------------------- |
| 日付              | DatePicker          | 既存の日報データを初期値として設定                   |
| できごと          | Textarea            | 必須、既存データを初期値として設定、文字数カウンター |
| 学び              | Textarea            | 任意、既存データを初期値として設定、文字数カウンター |
| よかったこと      | カード + Textarea×2 | 既存のよかったことを表示、編集・削除可能、追加可能   |
| 改善点/アクション | カード + Textarea×2 | 既存の改善点を表示、編集・削除可能、追加可能         |
| 削除ボタン        | IconButton          | 各よかったこと/改善点カードに配置（削除アイコン）    |
| 追加ボタン        | Button (Secondary)  | 「＋ 追加」                                          |
| キャンセルボタン  | Button (Outline)    | 「キャンセル」                                       |
| 保存ボタン        | Button (Primary)    | 「保存する」、モバイルでは下部固定                   |

### 3.3 エピソード/アクション編集モーダル

| 項目             | コンポーネント   | 備考                                                        |
| :--------------- | :--------------- | :---------------------------------------------------------- |
| 日付入力         | DateField        | 再現日/完了日（必須）、既存データを初期値として設定         |
| メモ入力         | TextareaField    | 最大500文字、既存データを初期値として設定、文字数カウンター |
| 保存ボタン       | Button (Primary) | 「保存」                                                    |
| キャンセルボタン | Button (Outline) | 「キャンセル」                                              |

### 3.4 フォローアップ画面（拡張）

| 項目       | コンポーネント | 備考                                                                          |
| :--------- | :------------- | :---------------------------------------------------------------------------- |
| 編集ボタン | IconButton     | 各エピソード/アクションカードに配置（編集アイコン）、削除ボタンの近く（右側） |
| 削除ボタン | IconButton     | 既存の削除ボタン（変更なし）                                                  |

### 3.5 確認ダイアログ

| 項目             | コンポーネント       | 備考                                                                       |
| :--------------- | :------------------- | :------------------------------------------------------------------------- |
| ダイアログ       | Dialog               | モーダルダイアログ                                                         |
| メッセージ       | Text                 | 確認メッセージ（例: 「この項目を削除しますか？削除すると元に戻せません」） |
| キャンセルボタン | Button (Outline)     | 「キャンセル」                                                             |
| 削除ボタン       | Button (Destructive) | 「削除する」                                                               |

---

## 4. レイアウト方針

### 4.1 日報詳細画面

- ページヘッダー：固定ヘッダー（sticky）、戻るボタン、タイトル、編集ボタンを横並び
- 編集ボタン：ヘッダー右側に配置、`variant="outline"`、`size="sm"`

### 4.2 日報編集画面

- **日報入力画面と同じレイアウト**: 日報入力画面と完全に同じレイアウト構造を使用
- ページ全体：最大幅800px、中央配置
- フォーム：縦1カラム配置、スクロールで全項目表示
- よかったこと/改善点カード：
  - 既存のよかったこと/改善点をカード形式で表示
  - 各カードに削除ボタンを配置（右上）
  - カード内の内容・要因・アクションを編集可能
- フッター：キャンセルボタンと保存ボタンを横並び、モバイルでは下部固定

### 4.3 エピソード/アクション編集モーダル

- **エピソード/アクション追加モーダルと同じレイアウト**: 追加モーダルと完全に同じレイアウト構造を使用
- モーダルオーバーレイ：画面全体を覆う半透明背景
- モーダルコンテンツ：最大幅500px、中央配置
- フォーム：縦方向に配置、日付入力とメモ入力

### 4.4 フォローアップ画面

- エピソード/アクションカード：
  - 既存のカードレイアウトを維持
  - 編集ボタンと削除ボタンを右側に横並びで配置
  - 編集ボタンは削除ボタンの左側に配置

### 4.5 確認ダイアログ

- ダイアログコンテンツ：最大幅400px、中央配置
- メッセージ：中央配置
- ボタン：キャンセルボタンと削除ボタンを横並び、フッターに配置

---

## 5. インタラクション

### 5.1 日報編集

#### 5.1.1 編集画面への遷移

- 「編集する」ボタンクリック時：日報編集画面に遷移
- 日報編集画面で既存の日報データをフォームに読み込む

#### 5.1.2 編集画面での操作

- フォーム入力：日報入力画面と同じ操作感
- よかったこと/改善点の編集：
  - カード内のテキストエリアを直接編集可能
  - 削除ボタンクリック時：確認ダイアログを表示
- よかったこと/改善点の追加：
  - 「＋ 追加」ボタンクリック時：新しいカードを追加
- 保存ボタンクリック時：
  - バリデーション実行
  - エラーがある場合：エラーメッセージを表示
  - エラーがない場合：更新APIを呼び出し、日報詳細画面に戻る
- キャンセルボタンクリック時：
  - 変更がある場合：確認ダイアログを表示（「編集内容が失われますが、よろしいですか？」）
  - 変更がない場合：日報詳細画面に戻る

#### 5.1.3 削除確認ダイアログ

- よかったこと/改善点の削除ボタンクリック時：
  - 確認ダイアログを表示（「この項目を削除しますか？削除すると元に戻せません」）
  - 「削除する」ボタンクリック時：カードを削除
  - 「キャンセル」ボタンクリック時：ダイアログを閉じる

### 5.2 エピソード/アクション編集

#### 5.2.1 編集モーダルの表示

- 編集ボタンクリック時：エピソード/アクション編集モーダルを表示
- 既存のエピソード/アクションデータをフォームに読み込む

#### 5.2.2 編集モーダルでの操作

- フォーム入力：エピソード/アクション追加モーダルと同じ操作感
- 保存ボタンクリック時：
  - バリデーション実行
  - エラーがある場合：エラーメッセージを表示
  - エラーがない場合：更新APIを呼び出し、モーダルを閉じる、ステータスを自動再計算
- キャンセルボタン/×ボタン/オーバーレイクリック/Escapeキー：
  - 変更がある場合：確認ダイアログを表示（「編集内容が失われますが、よろしいですか？」）
  - 変更がない場合：モーダルを閉じる

#### 5.2.3 ステータス自動再計算

- エピソード/アクション更新後：自動的にステータスを再計算
- ステータス変更時：トースト通知でユーザーに通知（例: 「ステータスが「再現成功」に更新されました」）

### 5.3 ブラウザ離脱時の確認

- 編集画面でブラウザを閉じる/ページ遷移する場合：
  - 変更がある場合：確認ダイアログを表示（「編集内容が失われますが、よろしいですか？」）
  - 変更がない場合：確認なしで離脱可能

---

## 6. デザイントークン

### 6.1 カラー

| 用途                 | トークン              | 説明 |
| :------------------- | :-------------------- | :--- |
| 編集ボタン（ホバー） | `--color-primary-500` | 青   |
| 削除ボタン（ホバー） | `--color-error`       | 赤   |
| エラーメッセージ     | `--color-error`       | 赤   |
| 成功メッセージ       | `--color-success`     | 緑   |

### 6.2 スペーシング

- 編集ボタンと削除ボタンの間の余白: `0.5rem` (8px)
- カード内のパディング: `1rem` (16px)
- モーダル内のフォーム要素間の余白: `1rem` (16px)

### 6.3 アイコン

- 編集アイコン: `PencilIcon` (Heroicons)
- 削除アイコン: `TrashIcon` (Heroicons)
- 閉じるアイコン: `XMarkIcon` (Heroicons)

---

## 7. 既存コンポーネントの使用計画

### 7.1 日報編集画面

- **日報入力画面のコンポーネントを再利用**: 日報入力画面と同じコンポーネントを使用
  - `DailyReportFormComponent`: 日報入力フォームコンポーネント
  - `GoodPointCardComponent`: よかったことカードコンポーネント
  - `ImprovementCardComponent`: 改善点カードコンポーネント
- **変更点**:
  - 既存データを初期値として設定するプロパティを追加
  - キャンセルボタンを追加
  - 削除ボタンを各カードに追加

### 7.2 エピソード/アクション編集モーダル

- **エピソード/アクション追加モーダルのコンポーネントを再利用**: 追加モーダルと同じコンポーネントを使用
  - `FollowupFormModalComponent`: フォローアップ入力フォームモーダルコンポーネント
- **変更点**:
  - 既存データを初期値として設定するプロパティを追加
  - タイトルを「エピソードを追加」から「エピソードを編集」に変更

### 7.3 確認ダイアログ

- **既存のダイアログコンポーネントを使用**:
  - `ConfirmDialogComponent`: 確認ダイアログコンポーネント（既存または新規作成）

---

## 8. ワイヤーフレーム

### 8.1 日報詳細画面（編集ボタン追加）

```
┌──────────────────────────┐
│ ← 2025-01-15の日報  [編集する] │
├──────────────────────────┤
│ 日付: 2025-01-15         │
├──────────────────────────┤
│ ■ できごと               │
│ 今日の主な業務...         │
├──────────────────────────┤
│ ■ 学び                   │
│ ...                      │
├──────────────────────────┤
│ ■ よかったこと ✨        │
│ ...                      │
├──────────────────────────┤
│ ■ 改善点/アクション 📝   │
│ ...                      │
└──────────────────────────┘
```

### 8.2 日報編集画面

```
┌──────────────────────────┐
│ ← 日報を編集             │
├──────────────────────────┤
│ 日付: [2025-01-15 ▼]     │
├──────────────────────────┤
│ ■ できごと *（必須）     │
│ ┌────────────────────┐   │
│ │ 今日の主な業務...  │   │
│ └────────────────────┘   │
│                 500/1000│
├──────────────────────────┤
│ ■ 学び                   │
│ ┌────────────────────┐   │
│ │ ...                │   │
│ └────────────────────┘   │
│                 200/1000│
├──────────────────────────┤
│ ■ よかったこと ✨        │
│ ┌────────────────────┐   │
│ │ 内容               │   │
│ │ 要因               │   │
│ └────────────────────┘   │
│                    [🗑️]  │
│ [＋ 追加]                │
├──────────────────────────┤
│ ■ 改善点/アクション 📝   │
│ ┌────────────────────┐   │
│ │ 内容               │   │
│ │ アクション         │   │
│ └────────────────────┘   │
│                    [🗑️]  │
│ [＋ 追加]                │
├──────────────────────────┤
│  [キャンセル]  [保存する] │
└──────────────────────────┘
```

### 8.3 エピソード/アクション編集モーダル

```
┌──────────────────────────┐
│ エピソードを編集          [×] │
├──────────────────────────┤
│ 日付 *（必須）            │
│ [2025-01-15 ▼]           │
├──────────────────────────┤
│ メモ                     │
│ ┌────────────────────┐   │
│ │ 再現メモ...        │   │
│ └────────────────────┘   │
│                 100/500  │
├──────────────────────────┤
│  [キャンセル]  [保存]    │
└──────────────────────────┘
```

### 8.4 フォローアップ画面（編集ボタン追加）

```
┌──────────────────────────┐
│ ← よかったことのフォローアップ │
├──────────────────────────┤
│ 再現エピソード 進行中 2/3件 │
├──────────────────────────┤
│ ┌────────────────────┐   │
│ │ 2025-01-15        │   │
│ │ 再現メモ...        │   │
│ │            [✏️][🗑️] │
│ └────────────────────┘   │
│ ┌────────────────────┐   │
│ │ 2025-01-14        │   │
│ │ 再現メモ...        │   │
│ │            [✏️][🗑️] │
│ └────────────────────┘   │
│ [エピソードを追加]        │
└──────────────────────────┘
```

### 8.5 確認ダイアログ（削除確認）

```
┌──────────────────────────┐
│                          │
│  この項目を削除しますか？  │
│  削除すると元に戻せません  │
│                          │
│  [キャンセル]  [削除する] │
└──────────────────────────┘
```

---

## 9. 状態別表示

### 9.1 ローディング状態

- 保存ボタン押下後：ボタン非活性 + スピナー表示
- 編集画面の読み込み中：スケルトンローダーまたはスピナー表示

### 9.2 エラー状態

- バリデーションエラー：該当フィールド下に赤字メッセージ
- 必須未入力：フィールド枠を赤色に
- ネットワークエラー：トースト通知でエラーメッセージを表示
- サーバーエラー：トースト通知でエラーメッセージを表示

### 9.3 成功状態

- 保存完了：トースト通知「日報を更新しました」/「エピソードを更新しました」/「アクションを更新しました」
- ステータス更新：トースト通知「ステータスが更新されました」

---

## 10. アクセシビリティ

### 10.1 キーボード操作

- Tabキー：フォーカス移動
- Enterキー：保存ボタン押下（フォーカスがフォーム内の場合）
- Escapeキー：モーダル/ダイアログを閉じる

### 10.2 スクリーンリーダー対応

- 編集ボタン：aria-label="編集する"
- 削除ボタン：aria-label="削除する"
- フォームフィールド：適切なラベルとaria-describedby

---

## 11. 実装方針

### 11.1 既存コンポーネントの活用

- **日報入力画面のコンポーネントを再利用**: 日報編集画面は日報入力画面と同じコンポーネントを使用し、既存データを初期値として設定
- **エピソード/アクション追加モーダルのコンポーネントを再利用**: 編集モーダルは追加モーダルと同じコンポーネントを使用し、既存データを初期値として設定

### 11.2 新規コンポーネント

- **確認ダイアログコンポーネント**: 既存のコンポーネントがない場合は新規作成
- **編集ボタン**: 既存のIconButtonコンポーネントを使用

### 11.3 Storybookへの反映

- 新規コンポーネント（確認ダイアログ）はFE実装と同時にStorybookストーリーを作成
- 既存コンポーネントの変更もStorybookに反映

---

## 12. 関連ドキュメント

| ドキュメント                                      | 説明                             |
| :------------------------------------------------ | :------------------------------- |
| `docs/features/edit-functionality/prd.md`         | 編集機能のPRD                    |
| `docs/features/edit-functionality/tech_spec.md`   | 編集機能の技術設計書             |
| `docs/features/daily-report-input/ui_design.md`   | 日報入力機能のUI設計書           |
| `docs/features/followup-enhancement/ui_design.md` | フォローアップ動作改善のUI設計書 |

---

## 13. 実装前の確認事項

- [x] PRDの要件を確認し、UI Designに反映
- [x] Tech Specを確認し、UI Designとの整合性を確認
- [x] 既存のUI Designパターンを確認し、統一性を保つ設計にした
- [x] 既存コンポーネントの使用計画を明確化
- [x] プロトタイプ作成（HTML/CSS/JS）

---

_本UI Designは Approved ステータスです。PdMレビュー・Helperレビュー完了。実装開始可能です。_
