# データ永続化機能 判断材料（PdM → Eng）

**作成日**: 2025-12-17  
**作成者**: PdM  
**対象**: Eng（Tech Spec作成の判断材料として）

---

## 1. プロダクトの現状と今後の展開

### 1.1 現在のフェーズ

- **フェーズ**: Zero to One（プロダクトの最初期段階）
- **開発環境**: 開発環境での開発が中心
- **本番環境**: 将来的に本番環境への展開を想定（具体的な時期は未定）

### 1.2 ロードマップ上の位置づけ

**Phase 1（MVP）**: ✅ 完了

- 日報入力・一覧表示機能
- ユーザー認証機能

**Phase 2（フォローアップ）**: ✅ 完了

- フォローアップ管理機能
- 週次フォーカス管理機能

**Phase 2 v2（拡張）**: 📋 進行中

- フォローアップ動作改善
- 日報一覧情報拡張

**Phase 3（編集機能と目標連携）**: 📋 計画中

- 編集機能
- 目標階層管理機能（BL-01: ✅ 完了）
- 日報と目標の関連付け（BL-03: ✅ 完了）

**Phase 3以降**: 🔮 将来検討

- 検索・拡張・組織展開
- AI分析機能
- データエクスポート機能

### 1.3 デプロイ計画

- **現時点**: デプロイ時期は未定
- **デプロイ時のタスク**: Phase 2.5のブランドイメージ改善（ロゴ、Favicon）が「デプロイ時に実装」と記載されているが、具体的な時期は未定
- **方針**: 開発環境での開発を優先し、本番環境への展開は将来的に検討

---

## 2. データの重要性と要件

### 2.1 データの性質

**保存されるデータの種類**:

- **ユーザー情報**: 認証情報、プロフィール情報
- **日報データ**: できごと、学び、よかったこと、改善点
- **目標データ**: 長期・中期・短期目標、階層構造
- **フォローアップデータ**: エピソード、アクション、ステータス
- **週次フォーカス**: 週単位のフォーカス項目

**データの重要性**:

- **ユーザーの成長記録**: 日報データはユーザーの成長の記録として重要
- **目標達成の追跡**: 目標データと日報の関連付けにより、目標達成への道筋を可視化
- **振り返りの基盤**: フォローアップデータは振り返りの基盤となる
- **データ損失の影響**: データが失われると、ユーザーの成長記録が失われ、信頼を損なう

### 2.2 非機能要件（general_prd.mdより）

- **データの永続性・セキュリティ**: 社外漏洩対策/本人特定管理
- **将来の組織横断展開**: 他人材データ連携も見据えた設計
- **変更容易性**: 運用者による柔軟拡張

---

## 3. 開発環境での優先度

### 3.1 現状の課題

- **開発効率の低下**: BE再起動時にデータが失われるため、開発中のデータが失われる
- **テストの困難さ**: データが失われるため、継続的なテストが困難
- **デモ・検証の困難さ**: デモや検証のためのデータが失われる

### 3.2 開発環境での要件

1. **即座の改善**: 開発環境でのデータ永続化を即座に実現
2. **簡単なセットアップ**: 開発環境でのセットアップが簡単
3. **既存コードへの影響最小化**: 既存のコードへの影響を最小限に

---

## 4. 本番環境への展開を考慮した要件

### 4.1 本番環境での要件（将来）

1. **スケーラビリティ**: 将来的に組織展開を想定
2. **パフォーマンス**: 大量のデータを扱う可能性
3. **セキュリティ**: データのセキュリティが重要
4. **バックアップ・復旧**: データのバックアップ・復旧機能

### 4.2 移行の容易性

- **段階的な移行**: 開発環境から本番環境への段階的な移行が可能であること
- **技術的負債の最小化**: 将来的な移行時に技術的負債が少ないこと

---

## 5. 判断材料のまとめ

### 5.1 優先度

**開発環境でのデータ永続化**: **最優先（P0）**

- 開発効率の向上
- テストの継続性
- デモ・検証の容易さ

**本番環境への対応**: **中優先度（P2）**

- 将来的に本番環境への展開を想定
- 現時点では具体的な時期が未定
- 開発環境での実装を優先

### 5.2 技術選択の判断基準

1. **開発環境での即座の改善**: 開発環境でのデータ永続化を即座に実現できること
2. **本番環境への移行容易性**: 将来的に本番環境（PostgreSQL等）への移行が容易であること
3. **既存コードへの影響**: 既存のコードへの影響を最小限にできること
4. **セットアップの簡単さ**: 開発環境でのセットアップが簡単であること

### 5.3 推奨アプローチ

**Phase 1（即座に実装）**: SQLite（better-sqlite3）

- 開発環境でのデータ永続化を即座に実現
- ファイルベースで簡単にセットアップ可能
- 既存のデータ構造をそのまま移行可能

**Phase 2（将来）**: PostgreSQL

- 本番環境で標準的
- 高パフォーマンス・スケーラビリティ
- SQLiteから移行が比較的容易（SQL互換性）

### 5.4 実装方針への影響

1. **インターフェースの維持**: 既存のデータベースクラスのインターフェースを維持し、実装のみを変更
2. **段階的な移行**: 1つのデータベースクラスから順次移行
3. **テストの追加**: 各データベースクラスのテストを追加
4. **ドキュメントの更新**: 開発者向けドキュメントを更新

---

## 6. 制約事項

### 6.1 技術的制約

- **Zero to Oneフェーズ**: 変更容易性を最優先とし、過度な抽象化は避ける
- **既存コードの維持**: 既存のコードへの影響を最小限に

### 6.2 スケジュール制約

- **開発環境の改善**: 即座に実装可能であること
- **本番環境への対応**: 将来的に検討（具体的な時期は未定）

---

## 7. 成功基準

### 7.1 開発環境での成功基準

- ✅ BE再起動後もデータが保持される
- ✅ 開発中のデータが失われない
- ✅ テストが継続的に実行できる
- ✅ デモ・検証が容易になる

### 7.2 本番環境への移行の成功基準（将来）

- ✅ PostgreSQL等への移行が容易であること
- ✅ パフォーマンスが維持または向上すること
- ✅ データのセキュリティが確保されること

---

## 8. リスクと対策

### 8.1 リスク

1. **SQLiteファイルの破損**: 開発環境でのデータ損失
2. **本番環境への移行の困難さ**: 将来的な移行時の技術的負債
3. **パフォーマンスの低下**: 大量データでのパフォーマンス低下

### 8.2 対策

1. **バックアップ機能**: データベースファイルのバックアップ機能
2. **移行容易性**: SQL互換性により、将来的な移行が容易
3. **パフォーマンス最適化**: インデックス、クエリ最適化

---

## 9. 次のステップ

1. **Tech Spec作成**: Engが本判断材料を基にTech Specを作成
2. **実装開始**: Tech Spec承認後、実装を開始
3. **段階的な移行**: 各データベースクラスを順次移行
4. **テスト追加**: ユニットテスト・統合テストを追加

---

**ステータス**: Approved  
**次回レビュー予定**: Tech Spec作成後
