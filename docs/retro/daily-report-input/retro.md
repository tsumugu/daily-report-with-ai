# 日報入力機能 振り返り（Retrospective）

**実施日**: 2025-12-06  
**参加ロール**: PdM, Eng, Des  
**対象機能**: 日報入力・保存（できごと/学び/よかったこと/改善点）

---

## 1. Keep（良かった点・継続すべきこと）

### プロセス面

- **ドキュメントファースト継続**: PRD → Tech Spec → UI Design の順で設計し、実装前に合意形成ができた
- **Auth機能の学びを活用**: 前回の振り返りで挙げたTryを実践できた（TDD、汎用コンポーネント活用）
- **受け入れ要件の明確化**: PRDで成功基準を明確にし、実装完了時に確認できた

### 技術面

- **コンポーネント再利用**: Auth機能で作成した InputField, Button, AlertBanner を活用し、開発効率が向上した
- **新規コンポーネントの追加**: TextareaField, DateField, FormCard を汎用コンポーネントとして実装
- **E2Eテストの充実**: Playwrightで主要フローを網羅し、リグレッション防止を実現
- **API設計の一貫性**: Tech Specに基づき、RESTful APIを実装

### UI/UX面

- **カード形式のUI**: よかったこと・改善点を視覚的にグルーピングし、入力しやすくした
- **文字数カウンター**: リアルタイムで文字数を表示し、ユーザーの入力補助を実現
- **レスポンシブ対応**: モバイル/PC両対応を継続

---

## 2. Problem（改善点・課題）

### プロセス面

- **コンポーネント分割の判断**: AddButton を Button の variant に統合すべきか、最初から判断できていなかった
- **Storybook更新の遅れ**: 実装完了後にStorybookの確認・更新を行ったが、実装と同時に更新すべきだった

### 技術面

- **Sass @import の非推奨警告**: `@use` への移行を後から対応した（最初から @use を使うべきだった）
- **maxlength バインディングエラー**: `[maxlength]` ではなく `[attr.maxlength]` が必要だった（HTMLネイティブ属性の理解不足）
- **ControlValueAccessor の重複**: 複数のフォームコンポーネントで同様のコードが重複している

### UI/UX面

- **トースト通知未実装**: 保存成功時のトースト通知がなく、一覧遷移のみ
- **離脱確認ダイアログ未実装**: 入力途中での離脱時に確認がない

---

## 3. Try（次に試すアクション）

### プロセス面

1. **コンポーネント設計の事前レビュー**: 新規コンポーネント作成前に、既存コンポーネントとの統合可否を検討する
2. **Storybookファースト**: 実装と同時にStorybookを更新するフローを確立する

### 技術面

1. **ControlValueAccessor base class の抽出**: 重複コードを共通化し、新規フォームコンポーネント作成を効率化
2. **エラーメッセージ関数の共通化**: `getFieldError()` を shared/utils に移動
3. **Sass @use の徹底**: 新規SCSSファイルでは @import を使わない

### UI/UX面

1. **トースト通知コンポーネントの実装**: Phase 2 で保存成功時の通知を追加
2. **離脱確認ダイアログ**: canDeactivate ガードで入力途中の離脱を検知

---

## 4. Learnings（学び・知見）

### 技術的な学び

- **Angular Signal**: `signal()`, `computed()` を活用し、リアクティブな状態管理を実現
- **動的フォーム**: FormGroup + signal配列の組み合わせで、動的な入力項目を実装
- **HTML属性バインディング**: ネイティブHTML属性は `[attr.xxx]` で バインドする
- **Sass @use vs @import**: @import は非推奨、@use でモジュールとして読み込む

### アーキテクチャの学び

- **Button variant パターン**: 類似ボタンは別コンポーネントではなく variant で表現する
- **FormCard の汎用性**: 削除可能なカード形式UIは様々な場面で再利用できる
- **コンポーネント統合の判断基準**: スタイルのみの違いなら variant、挙動が大きく異なるなら別コンポーネント

### プロセスの学び

- **Auth機能の振り返りが活きた**: Keep/Problem/Tryを意識して開発を進められた
- **受け入れ要件チェックの価値**: 実装完了時に要件を1つ1つ確認することで、漏れを防げた

---

## 5. 定量データ

| 項目                       | 値                                                     |
| :------------------------- | :----------------------------------------------------- |
| 実装期間                   | 2025-12-05 〜 2025-12-06                               |
| テストケース数（E2E）      | 9件                                                    |
| テストカバレッジ           | 100%                                                   |
| 新規コンポーネント数（FE） | 3（TextareaField, DateField, FormCard）                |
| 更新コンポーネント数       | 1（Button に add variant 追加）                        |
| 削除コンポーネント数       | 1（AddButton → Button に統合）                         |
| API エンドポイント数       | 7（daily-reports x3, good-points x2, improvements x2） |
| Storybook Stories 数       | 6（新規3 + 更新3）                                     |

---

## 6. 次の機能への引き継ぎ事項

- [ ] ControlValueAccessor base class を抽出する（任意）
- [ ] エラーメッセージ関数を shared/utils に共通化する（任意）
- [ ] 新規SCSSファイルでは @use を使用する（必須）
- [ ] Button variant で対応可能か検討してから新規コンポーネントを作成する（推奨）
- [ ] 実装と同時に Storybook を更新する（推奨）
- [ ] Phase 2 でトースト通知コンポーネントを実装する

---

_各ロールの詳細な振り返りは `pdm.md`, `eng.md`, `des.md` を参照_
