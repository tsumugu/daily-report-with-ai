# 日報と目標の関連付け機能 振り返り（Retrospective）

**実施日**: 2025-12-17  
**参加ロール**: PdM, Eng, Des, QA  
**対象機能**: BL-03 日報と目標の関連付け機能

---

## 1. Keep（良かった点・継続すべきこと）

### プロセス面

- **TDDアプローチの徹底**: BE実装でTDDを徹底し、テストファーストで実装
- **Storybookファースト**: FE実装でStorybookファーストを実践し、コンポーネントの品質を確保
- **N+1問題の事前対策**: `findByDailyReportIds()` でN+1問題を回避する設計を実装
- **品質基準の遵守**: Lint、テスト、E2E、カバレッジすべての基準をクリア

### 技術面

- **多対多関係の適切な設計**: `DailyReportGoal` 中間テーブルで多対多関係を管理
- **バリデーションの充実**: 最大10個制限、存在チェック、所有権チェックを実装
- **アクセシビリティ対応**: キーボード操作、スクリーンリーダー対応を実装
- **コンポーネントの再利用性**: `GoalChip`, `GoalMultiSelectField` を汎用的に設計

### UI/UX面

- **チップ形式の表示**: 目標をチップ形式で表示し、視認性を向上
- **階層構造の視覚化**: 目標選択時に階層構造を表示
- **空状態の適切な対応**: 関連目標がない場合の空状態を実装

---

## 2. Problem（改善点・課題）

### プロセス面

- **E2Eテストの追加タイミング**: E2Eテストの追加を実装完了後に実施したが、実装中に追加すべきだった
- **ドキュメントの更新タイミング**: 実装完了後にドキュメントを更新したが、実装中に随時更新すべきだった

### 技術面

- **型定義の重複**: `DailyReportResponse` に `goals` フィールドを追加したが、型定義の整理が必要
- **エラーハンドリングの統一**: エラーメッセージの統一性を向上させる必要がある

### UI/UX面

- **目標選択のUX**: 目標が多数ある場合の選択が煩雑になる可能性がある
- **関連日報の表示**: 目標詳細画面での関連日報表示の並び替え機能が未実装

---

## 3. Try（次に試すアクション）

### プロセス面

1. **E2Eテストの早期追加**: 実装中にE2Eテストを追加する
2. **ドキュメントの随時更新**: 実装中にドキュメントを随時更新する

### 技術面

1. **型定義の整理**: `DailyReportResponse` と `DailyReport` の関係を明確化
2. **エラーハンドリングの統一**: エラーメッセージの統一性を向上させる

### UI/UX面

1. **目標選択の改善**: Phase 2で検索・フィルタ機能を追加
2. **関連日報の並び替え**: 目標詳細画面での並び替え機能を追加

---

## 4. Learnings（学び・知見）

### 技術的な学び

- **N+1問題の対策**: `findByDailyReportIds()` で一括取得することでN+1問題を回避
- **多対多関係の管理**: 中間テーブルで多対多関係を管理する設計パターン
- **バリデーションの重要性**: 最大10個制限、存在チェック、所有権チェックの重要性

### アーキテクチャの学び

- **コンポーネントの再利用性**: `GoalChip`, `GoalMultiSelectField` を汎用的に設計することで再利用性を向上
- **データモデルの拡張性**: 既存の `DailyReport` モデルを変更せず、中間テーブルで拡張

### プロセスの学び

- **TDDの効果**: テストファーストで実装することで、品質を確保
- **Storybookファーストの効果**: Storybookファーストで実装することで、コンポーネントの品質を確保

---

## 5. 定量データ

| 項目                       | 値                                                           |
| :------------------------- | :----------------------------------------------------------- |
| 実装期間                   | 2025-12-16 〜 2025-12-17                                     |
| テストケース数（Unit）     | DailyReportGoalsDatabase: 複数件                             |
| テストカバレッジ           | 94.67%（閾値80%を超過）                                      |
| 新規コンポーネント数（FE） | 3（GoalChip, GoalMultiSelectField, RelatedDailyReportsList） |
| 更新ファイル数             | 複数（routes, service, model, components等）                 |
| API エンドポイント更新     | 3（日報作成・更新、日報取得、目標詳細取得）                  |

---

## 6. 次の機能への引き継ぎ事項

- [ ] 型定義の整理（`DailyReportResponse` と `DailyReport` の関係を明確化）
- [ ] エラーハンドリングの統一（エラーメッセージの統一性を向上）
- [ ] Phase 2 で目標選択の検索・フィルタ機能を追加
- [ ] Phase 2 で関連日報の並び替え機能を追加
- [ ] E2Eテストの早期追加（実装中に追加）

---

_各ロールの詳細な振り返りは `pdm.md`, `eng.md`, `des.md`, `qa.md` を参照_
