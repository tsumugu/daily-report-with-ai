# 振り返り: 2025-12-05 [Eng]

## 📛 問題

### TDDを実践できなかった

`docs/general/test-rules.md` にt-wada式Red-Green TDDのルールを定義しておきながら、実際の実装では**一切実践しなかった**。

---

## 🔍 何が起きたか

### 実装した機能

| 機能 | テスト | TDD実践 |
|------|--------|---------|
| AuthService（signup, login, logout, getMe） | ❌ なし | ❌ |
| AuthInterceptor | ❌ なし | ❌ |
| AuthGuard | ❌ なし | ❌ |
| form-validation.util.ts | ❌ なし | ❌ |
| InputFieldComponent | ❌ なし | ❌ |
| ButtonComponent | ❌ なし | ❌ |
| AlertBannerComponent | ❌ なし | ❌ |
| LoginPageComponent | ❌ なし | ❌ |
| SignupPageComponent | ❌ なし | ❌ |
| HomePageComponent | ❌ なし | ❌ |
| API（Express routes） | ❌ なし | ❌ |

### 実際の流れ

```
期待: Red → Green → Refactor
実際: Code → Code → Code → (テストなし)
```

---

## 🤔 なぜ起きたか（5 Whys）

1. **Why:** テストを書かなかった
   - **Because:** 機能実装を急いでいた

2. **Why:** 機能実装を急いでいた
   - **Because:** ユーザーの要求に素早く応えたかった

3. **Why:** ユーザーの要求に素早く応えたかった
   - **Because:** TDDのオーバーヘッドを避けたかった

4. **Why:** TDDのオーバーヘッドを避けたかった
   - **Because:** TDDの習慣が身についていなかった

5. **Why:** TDDの習慣が身についていなかった
   - **Because:** 意識的にTDDサイクルを回すチェックポイントがなかった

---

## 🎯 根本原因

**TDDを実践するための仕組み（チェックポイント）がなかった**

ドキュメントにルールを書いただけで、実装時に強制する仕組みがなかった。

---

## 📋 対策

### 短期（今回の対応）

1. 既存コードに後追いでテストを追加
2. テストカバレッジを可視化

### 中期（次の実装から）

1. **実装前にテストファイルを作成することを必須化**
   - `feature.component.ts` を作る前に `feature.component.spec.ts` を作成
   
2. **PRテンプレートにTDDチェックリストを追加**
   ```markdown
   ## TDDチェックリスト
   - [ ] テストを先に書いた
   - [ ] Red（テスト失敗）を確認した
   - [ ] Green（テスト成功）を確認した
   - [ ] Refactorした
   ```

3. **コミットメッセージにテスト状況を含める**
   ```
   feat: ユーザー認証機能を追加
   
   - [x] AuthService テスト済み
   - [x] AuthGuard テスト済み
   ```

### 長期

1. **カバレッジ閾値を設定**
   - 80%未満のPRはマージ不可

2. **CI/CDでテスト必須化**
   - テストが通らないとデプロイ不可

---

## 📝 学び

1. **ルールを書くだけでは実践されない**
   - 仕組みで強制する必要がある

2. **TDDは意識的に実践しないと忘れる**
   - 習慣化するまでチェックリストが必要

3. **「後でテストを書く」は「テストを書かない」と同義**
   - テストは先に書くか、永遠に書かないかの二択

---

## ✅ アクションアイテム

- [x] 反省を記録（このファイル）
- [x] 既存コードにテストを追加
  - [x] AuthService
  - [x] AuthInterceptor
  - [x] AuthGuard
  - [x] form-validation.util.ts
  - [x] InputFieldComponent
  - [x] ButtonComponent
  - [x] AlertBannerComponent
  - [x] LoginPageComponent
  - [x] SignupPageComponent
  - [x] HomePageComponent
  - [x] API (users.db, auth.middleware, auth.routes)
- [ ] PRテンプレートにTDDチェックリストを追加
- [ ] 次の機能（日報入力）からTDDを実践

---

## 📅 次回確認

次の機能実装時に、このretroを見返してTDDを実践すること。

