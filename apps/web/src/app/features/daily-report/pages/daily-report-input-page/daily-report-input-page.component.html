<div class="daily-report-input">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <a routerLink="/daily-reports" class="back-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m15 18-6-6 6-6"/>
      </svg>
    </a>
    <h1 class="title">æ—¥å ±ã‚’æ›¸ã</h1>
  </header>

  <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  @if (errorMessage()) {
    <app-alert-banner
      [message]="errorMessage()"
      variant="error"
      [dismissible]="true"
      (dismissed)="errorMessage.set(null)"
    />
  }

  <!-- ãƒ•ã‚©ãƒ¼ãƒ  -->
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form">
    <!-- æ—¥ä»˜ -->
    <div class="form-group">
      <label class="label">æ—¥ä»˜ <span class="required">*</span></label>
      <input
        type="date"
        formControlName="date"
        class="date-input"
        [class.error]="form.get('date')?.touched && form.get('date')?.invalid"
      />
      @if (getFieldError('date')) {
        <span class="error-message">{{ getFieldError('date') }}</span>
      }
    </div>

    <!-- ã§ãã”ã¨ -->
    <div class="form-group">
      <label class="label">
        <span class="label-icon">ğŸ“</span>
        ã§ãã”ã¨ <span class="required">*</span>
      </label>
      <textarea
        formControlName="events"
        class="textarea"
        [class.error]="form.get('events')?.touched && form.get('events')?.invalid"
        placeholder="ä»Šæ—¥ã®ä¸»ãªæ¥­å‹™å†…å®¹ã€å‡ºæ¥äº‹ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"
        rows="4"
      ></textarea>
      <div class="char-count" [class.over]="eventsCharCount() > MAX_LENGTH">
        {{ eventsCharCount() }}/{{ MAX_LENGTH }}
      </div>
      @if (getFieldError('events')) {
        <span class="error-message">{{ getFieldError('events') }}</span>
      }
    </div>

    <!-- å­¦ã³ -->
    <div class="form-group">
      <label class="label">
        <span class="label-icon">ğŸ’¡</span>
        å­¦ã³
      </label>
      <textarea
        formControlName="learnings"
        class="textarea"
        [class.error]="form.get('learnings')?.touched && form.get('learnings')?.invalid"
        placeholder="æ¥­å‹™ã‚’é€šã˜ã¦å¾—ãŸæ°—ã¥ãã€å­¦ã³ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"
        rows="3"
      ></textarea>
      <div class="char-count" [class.over]="learningsCharCount() > MAX_LENGTH">
        {{ learningsCharCount() }}/{{ MAX_LENGTH }}
      </div>
    </div>

    <!-- ã‚ˆã‹ã£ãŸã“ã¨ -->
    <div class="form-group">
      <label class="label">
        <span class="label-icon">âœ¨</span>
        ã‚ˆã‹ã£ãŸã“ã¨
      </label>

      @for (gp of goodPoints(); track $index) {
        <div class="card">
          <button type="button" class="card-remove" (click)="removeGoodPoint($index)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
          </button>
          <div class="card-field">
            <label class="card-label">å†…å®¹</label>
            <textarea
              class="textarea textarea--small"
              [value]="gp.content"
              (input)="updateGoodPoint($index, 'content', $any($event.target).value)"
              placeholder="ã†ã¾ãã„ã£ãŸã“ã¨ã€æˆåŠŸä½“é¨“"
              rows="2"
            ></textarea>
          </div>
          <div class="card-field">
            <label class="card-label">è¦å› ãƒ»èƒŒæ™¯</label>
            <textarea
              class="textarea textarea--small"
              [value]="gp.factors"
              (input)="updateGoodPoint($index, 'factors', $any($event.target).value)"
              placeholder="ãªãœã†ã¾ãã„ã£ãŸã‹"
              rows="2"
            ></textarea>
          </div>
        </div>
      }

      <button type="button" class="add-button" (click)="addGoodPoint()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"/><path d="M12 5v14"/>
        </svg>
        è¿½åŠ 
      </button>
    </div>

    <!-- æ”¹å–„ç‚¹/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-group">
      <label class="label">
        <span class="label-icon">ğŸ“ˆ</span>
        æ”¹å–„ç‚¹/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
      </label>

      @for (imp of improvements(); track $index) {
        <div class="card">
          <button type="button" class="card-remove" (click)="removeImprovement($index)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
          </button>
          <div class="card-field">
            <label class="card-label">æ”¹å–„ã—ãŸã„ã“ã¨</label>
            <textarea
              class="textarea textarea--small"
              [value]="imp.content"
              (input)="updateImprovement($index, 'content', $any($event.target).value)"
              placeholder="æ”¹å–„ã—ãŸã„ç‚¹ã€èª²é¡Œ"
              rows="2"
            ></textarea>
          </div>
          <div class="card-field">
            <label class="card-label">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
            <textarea
              class="textarea textarea--small"
              [value]="imp.action"
              (input)="updateImprovement($index, 'action', $any($event.target).value)"
              placeholder="æ˜æ—¥ä»¥é™ã«è©¦ã—ãŸã„ã“ã¨"
              rows="2"
            ></textarea>
          </div>
        </div>
      }

      <button type="button" class="add-button" (click)="addImprovement()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"/><path d="M12 5v14"/>
        </svg>
        è¿½åŠ 
      </button>
    </div>

    <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
    <div class="form-actions">
      <app-button
        type="submit"
        variant="primary"
        [fullWidth]="true"
        [loading]="isLoading()"
        [disabled]="isLoading()"
      >
        ä¿å­˜ã™ã‚‹
      </app-button>
    </div>
  </form>
</div>

