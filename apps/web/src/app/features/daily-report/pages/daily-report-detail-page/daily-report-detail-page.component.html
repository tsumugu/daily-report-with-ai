<div class="detail-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a routerLink="/" class="logo">
        <app-icon name="file-text" [size]="24" color="var(--color-primary-500)" ariaLabel="Daily Report" />
        Daily Report
      </a>
      <div class="user-menu">
        @if (currentUser()) {
          <span class="user-email">{{ currentUser()?.email }}</span>
        }
        <button class="logout-button" (click)="logout()">ログアウト</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <!-- Back button -->
    <div class="back-nav">
      <button class="back-button" (click)="goBack()">
        <span class="back-icon">←</span>
        一覧に戻る
      </button>
    </div>

    <!-- Loading -->
    @if (isLoading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>読み込み中...</p>
      </div>
    }

    <!-- Error -->
    @if (errorMessage()) {
      <div class="error-container">
        <app-alert-banner variant="error" [message]="errorMessage()!" />
        <div class="error-actions">
          <app-button variant="secondary" (clicked)="goBack()">一覧に戻る</app-button>
          <app-button variant="primary" (clicked)="retry()">再読み込み</app-button>
        </div>
      </div>
    }

    <!-- Report Detail -->
    @if (!isLoading() && !errorMessage() && report()) {
      <article class="report-detail">
        <header class="report-header">
          <h1 class="report-date">
            <span class="date-icon">
              <app-icon name="calendar" [size]="20" color="var(--color-gray-600)" ariaLabel="日付" />
            </span>
            {{ formatDate(report()!.date) }}
          </h1>
          <!-- 編集ボタン -->
          <app-button
            variant="secondary"
            size="sm"
            (clicked)="onEdit()"
            ariaLabel="編集する"
          >
            編集する
          </app-button>
        </header>

        <!-- 関連目標 -->
        @if (report()!.goals && report()!.goals.length > 0) {
          <section class="section section--goals">
            <h2 class="section-title">関連する目標</h2>
            <div class="goals-list">
              @for (goal of report()!.goals; track goal.id) {
                <app-goal-chip
                  [goalId]="goal.id"
                  [goalName]="goal.name"
                />
              }
            </div>
          </section>
        }

        <!-- できごと -->
        <section class="section">
          <h2 class="section-title">できごと</h2>
          <div class="section-content">
            <p class="content-text">{{ report()!.events }}</p>
          </div>
        </section>

        <!-- 学び -->
        @if (report()!.learnings) {
          <section class="section">
            <h2 class="section-title">学び</h2>
            <div class="section-content">
              <p class="content-text">{{ report()!.learnings }}</p>
            </div>
          </section>
        }

        <!-- よかったこと -->
        @if (report()!.goodPoints && report()!.goodPoints.length > 0) {
          <section class="section">
            <h2 class="section-title">
              <span class="title-icon">
                <app-icon name="heart" [size]="20" color="var(--color-primary-500)" ariaLabel="よかったこと" />
              </span>
              よかったこと
            </h2>
            <div class="items-list">
              @for (gp of report()!.goodPoints; track gp.id) {
                <div class="item-card">
                  <p class="item-content">{{ gp.content }}</p>
                  @if (gp.factors) {
                    <div class="item-sub">
                      <span class="sub-label">要因：</span>
                      <span class="sub-value">{{ gp.factors }}</span>
                    </div>
                  }
                  <app-status-badge [status]="getGoodPointStatusBadgeType(gp.status)"></app-status-badge>
                </div>
              }
            </div>
          </section>
        }

        <!-- 改善点 -->
        @if (report()!.improvements && report()!.improvements.length > 0) {
          <section class="section">
            <h2 class="section-title">
              <span class="title-icon">
                <app-icon name="file-text" [size]="20" color="var(--color-primary-500)" ariaLabel="改善点" />
              </span>
              改善点 / アクション
            </h2>
            <div class="items-list">
              @for (imp of report()!.improvements; track imp.id) {
                <div class="item-card">
                  <p class="item-content">{{ imp.content }}</p>
                  @if (imp.action) {
                    <div class="item-sub">
                      <span class="sub-label">アクション：</span>
                      <span class="sub-value">{{ imp.action }}</span>
                    </div>
                  }
                  <app-status-badge [status]="getImprovementStatusBadgeType(imp.status)"></app-status-badge>
                </div>
              }
            </div>
          </section>
        }

        <!-- メタ情報 -->
        <footer class="report-footer">
          <span class="meta-text">作成: {{ report()!.createdAt | date:'yyyy/MM/dd HH:mm' }}</span>
          @if (report()!.updatedAt !== report()!.createdAt) {
            <span class="meta-text">更新: {{ report()!.updatedAt | date:'yyyy/MM/dd HH:mm' }}</span>
          }
        </footer>
      </article>
    }
  </main>
</div>

