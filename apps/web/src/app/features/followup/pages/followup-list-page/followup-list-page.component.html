<div class="followup-list-page">
  <header class="followup-list-page__header">
    <button class="followup-list-page__back" routerLink="/home" aria-label="戻る">
      ←
    </button>
    <h1 class="followup-list-page__title">フォロー項目</h1>
  </header>

  <div class="followup-list-page__filters">
    <select
      class="followup-list-page__filter"
      [value]="statusFilter()"
      (change)="onStatusFilterChange(getSelectValue($event))"
    >
      <option value="未着手,進行中">未完了</option>
      <option value="すべて">すべて</option>
      <option value="未着手">未着手</option>
      <option value="進行中">進行中</option>
      <option value="定着,習慣化">成功</option>
      <option value="再現できず,未達成">失敗</option>
    </select>

    <select
      class="followup-list-page__filter"
      [value]="itemTypeFilter()"
      (change)="onItemTypeFilterChange(getItemTypeValue($event))"
    >
      <option value="すべて">すべて</option>
      <option value="goodPoint">よかったこと</option>
      <option value="improvement">改善点</option>
    </select>
  </div>

  <div class="followup-list-page__content">
    @if (errorMessage()) {
      <app-alert-banner
        variant="error"
        [message]="errorMessage()!"
        [dismissible]="true"
        (dismissed)="errorMessage.set(null)"
      ></app-alert-banner>
    }

    @if (isLoading()) {
      <div class="followup-list-page__loading">
        読み込み中...
      </div>
    }

    @if (isEmpty) {
      <div class="followup-list-page__empty">
        <p class="followup-list-page__empty-message">
          <app-icon name="alert-triangle" [size]="48" color="var(--color-error-500)" ariaLabel="警告" />
          <br />
          フォローする項目が<br />
          ありません
        </p>
        <p class="followup-list-page__empty-submessage">
          日報を入力して、よかったことや改善点を記録しましょう
        </p>
        <app-button
          variant="primary"
          (clicked)="router.navigate(['/daily-reports/new'])"
          ariaLabel="日報を書く"
        >
          日報を書く
        </app-button>
      </div>
    }

    @if (!isLoading() && !isEmpty) {
      <div class="followup-list-page__list">
        @for (item of items(); track item.item.id) {
          <app-followup-card
            [item]="item"
            [isInWeeklyFocus]="isInWeeklyFocus(item)"
            [isAddingToWeeklyFocus]="isAddingToWeeklyFocusCheck(item)"
            [isWeeklyFocusLimitReached]="isWeeklyFocusLimitReached()"
            (cardClick)="onCardClick($event)"
            (followupClick)="onFollowupClick($event)"
            (toggleWeeklyFocus)="onToggleWeeklyFocus($event)"
          ></app-followup-card>
        }
      </div>
    }

    @if (hasMore && !isLoading()) {
      <div class="followup-list-page__load-more">
        <app-button
          variant="outline"
          [loading]="isLoadingMore()"
          (clicked)="onLoadMore()"
          ariaLabel="もっと見る"
        >
          もっと見る
        </app-button>
      </div>
    }
  </div>

  @if (selectedItem()) {
    <app-followup-input-modal
      [item]="selectedItem()!"
      [isOpen]="isModalOpen()"
      (closed)="onModalClosed()"
      (saved)="onModalSaved()"
    ></app-followup-input-modal>
  }

  <!-- トースト通知 -->
  @if (toastMessage()) {
    <div class="followup-list-page__toast">
      <app-toast
        [variant]="toastVariant()"
        [message]="toastMessage()!"
      ></app-toast>
    </div>
  }
</div>
