<div class="followup-list-page">
  <header class="followup-list-page__header">
    <button class="followup-list-page__back" routerLink="/home" aria-label="戻る">
      ←
    </button>
    <h1 class="followup-list-page__title">フォロー項目</h1>
  </header>

  <div class="followup-list-page__filters">
    <select
      class="followup-list-page__filter"
      [value]="statusFilter()"
      (change)="onStatusFilterChange($any($event.target).value)"
    >
      <option value="未着手,進行中">未完了</option>
      <option value="すべて">すべて</option>
      <option value="未着手">未着手</option>
      <option value="進行中">進行中</option>
      <option value="再現成功,完了">成功</option>
      <option value="定着,習慣化">定着</option>
      <option value="再現できず,未達成">失敗</option>
    </select>

    <select
      class="followup-list-page__filter"
      [value]="itemTypeFilter()"
      (change)="onItemTypeFilterChange($any($event.target).value)"
    >
      <option value="すべて">すべて</option>
      <option value="goodPoint">よかったこと</option>
      <option value="improvement">改善点</option>
    </select>
  </div>

  <div class="followup-list-page__content">
    <app-alert-banner
      *ngIf="errorMessage()"
      variant="error"
      [message]="errorMessage()!"
      [dismissible]="true"
      (dismissed)="errorMessage.set(null)"
    ></app-alert-banner>

    <div *ngIf="isLoading()" class="followup-list-page__loading">
      読み込み中...
    </div>

    <div *ngIf="isEmpty" class="followup-list-page__empty">
      <p class="followup-list-page__empty-message">
        ⚠️ フォローする項目が<br />
        ありません
      </p>
      <p class="followup-list-page__empty-submessage">
        日報を入力して、よかったことや改善点を記録しましょう
      </p>
      <app-button
        variant="primary"
        (clicked)="router.navigate(['/daily-reports/new'])"
        ariaLabel="日報を書く"
      >
        日報を書く
      </app-button>
    </div>

    <div *ngIf="!isLoading() && !isEmpty" class="followup-list-page__list">
      <app-followup-card
        *ngFor="let item of items()"
        [item]="item"
        (cardClick)="onCardClick($event)"
        (followupClick)="onFollowupClick($event)"
      ></app-followup-card>
    </div>

    <div *ngIf="hasMore && !isLoading()" class="followup-list-page__load-more">
      <app-button
        variant="outline"
        [loading]="isLoadingMore()"
        (clicked)="onLoadMore()"
        ariaLabel="もっと見る"
      >
        もっと見る
      </app-button>
    </div>
  </div>

  <app-followup-input-modal
    *ngIf="selectedItem()"
    [item]="selectedItem()!"
    [isOpen]="isModalOpen()"
    (closed)="onModalClosed()"
    (saved)="onModalSaved()"
  ></app-followup-input-modal>
</div>

