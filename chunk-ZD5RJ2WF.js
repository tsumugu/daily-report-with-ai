import{e as P,g as I}from"./chunk-ZJX46FKY.js";import{a as T}from"./chunk-SDZWKREU.js";import{r as L}from"./chunk-QUKDKHRQ.js";import"./chunk-LVTD2VF5.js";import"./chunk-OJTORZQT.js";import{b as E}from"./chunk-OLWX3WVW.js";import{e as b,s as w}from"./chunk-HCRNHK5J.js";import{$ as h,Ba as l,Ka as y,Pa as x,S as C,Wa as f,_ as m,_a as p,cb as s,db as r,eb as v,fb as G,ib as _,jb as d,na as c,pb as u}from"./chunk-TUMKYTCV.js";import"./chunk-4CLCTAJ7.js";function M(o,e){if(o&1&&v(0,"app-alert-banner",6),o&2){let t=d();f("message",t.errorMessage())}}function B(o,e){o&1&&(s(0,"div",7),u(1,"\u8AAD\u307F\u8FBC\u307F\u4E2D..."),r())}function D(o,e){o&1&&v(0,"app-empty-state",8)}function S(o,e){if(o&1){let t=G();s(0,"div",9)(1,"app-hierarchy-tree-view",10),_("nodeClicked",function(i){m(t);let a=d();return h(a.onGoalClick(i))})("expandToggled",function(i){m(t);let a=d();return h(a.onExpandToggle(i))})("createChild",function(i){m(t);let a=d();return h(a.onCreateChild(i))}),r()()}if(o&2){let t=d();l(),f("nodes",t.convertToTreeNodes(t.goals()))("expandedIds",t.expandedIds())("showCreateChildButton",!0)}}var k=class o{goalService=C(I);router=C(w);goals=c([]);isLoading=c(!1);errorMessage=c(null);expandedIds=c(new Set);ngOnInit(){this.loadGoals()}loadGoals(){this.isLoading.set(!0),this.errorMessage.set(null),this.goalService.getGoals(!0).subscribe({next:e=>{let t=e.data;this.goals.set(t);let n=new Set,i=a=>{a.forEach(g=>{n.add(g.id),g.children&&g.children.length>0&&i(g.children)})};i(t),this.expandedIds.set(n),this.isLoading.set(!1)},error:e=>{this.errorMessage.set(e.error?.message||"\u76EE\u6A19\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),this.isLoading.set(!1)}})}onGoalClick(e){this.router.navigate(["/goals",e])}onExpandToggle(e){let t=new Set(this.expandedIds());t.has(e)?t.delete(e):t.add(e),this.expandedIds.set(t)}onCreateChild(e){let t=this.findGoalById(e,this.goals());if(!t){this.router.navigate(["/goals/new"]);return}let n=t.parentId||null;n?this.router.navigate(["/goals/new"],{queryParams:{parentId:n}}):this.router.navigate(["/goals/new"])}convertToTreeNodes(e){return e.map(t=>this.convertGoalToNode(t))}convertGoalToNode(e){let t={id:e.id,title:e.name,subtitle:e.description?e.description:void 0,metadata:e.startDate&&e.endDate?`${e.startDate} \u301C ${e.endDate}`:void 0,level:this.getGoalLevel(e),type:e.goalType?e.goalType:void 0};return{id:e.id,data:t,children:e.children.map(n=>this.convertGoalToNode(n))}}getGoalLevel(e){let t=this.calculateDepth(e,this.goals());return t===1?"long":t===2?"medium":"short"}calculateDepth(e,t){if(!e.parentId)return 1;let n=this.findGoalById(e.parentId,t);return n?1+this.calculateDepth(n,t):1}findGoalById(e,t){for(let n of t){if(n.id===e)return n;if(n.children&&n.children.length>0){let i=this.findGoalById(e,n.children);if(i)return i}}return null}get isEmpty(){return!this.isLoading()&&this.goals().length===0}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-goal-list-page"]],decls:13,vars:4,consts:[[1,"goal-list-page"],[1,"goal-list-page__header"],["type","button","aria-label","\u623B\u308B",1,"goal-list-page__back-button",3,"click"],[1,"goal-list-page__title"],[1,"goal-list-page__actions"],["variant","primary","icon","plus",3,"clicked"],["variant","error",3,"message"],[1,"goal-list-page__loading"],["iconName","target","message","\u76EE\u6A19\u304C\u307E\u3060\u4F5C\u6210\u3055\u308C\u3066\u3044\u307E\u305B\u3093","subMessage","\u76EE\u6A19\u3092\u4F5C\u6210\u3057\u3066\u3001\u76EE\u6A19\u9054\u6210\u3092\u76EE\u6307\u3057\u307E\u3057\u3087\u3046","actionButtonText","\u76EE\u6A19\u3092\u4F5C\u6210","actionButtonRoute","/goals/new","actionButtonIcon","plus"],[1,"goal-list-page__tree-view"],[3,"nodeClicked","expandToggled","createChild","nodes","expandedIds","showCreateChildButton"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"header",1)(2,"button",2),_("click",function(){return n.router.navigate(["/"])}),u(3," \u2190 "),r(),s(4,"h1",3),u(5,"\u76EE\u6A19\u7BA1\u7406"),r()(),s(6,"div",4)(7,"app-button",5),_("clicked",function(){return n.router.navigate(["/goals/new"])}),u(8," \u76EE\u6A19\u3092\u4F5C\u6210 "),r()(),x(9,M,1,1,"app-alert-banner",6)(10,B,2,0,"div",7)(11,D,1,0,"app-empty-state",8)(12,S,2,3,"div",9),r()),t&2&&(l(9),p(n.errorMessage()?9:-1),l(),p(n.isLoading()?10:-1),l(),p(n.isEmpty?11:-1),l(),p(!n.isLoading()&&!n.isEmpty?12:-1))},dependencies:[b,E,T,P,L],styles:[".goal-list-page[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}.goal-list-page__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}.goal-list-page__back-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:2rem;height:2rem;border:none;background-color:transparent;color:var(--color-gray-700);font-size:1.25rem;cursor:pointer;border-radius:.25rem;transition:all .2s ease}.goal-list-page__back-button[_ngcontent-%COMP%]:hover{background-color:var(--color-gray-100);color:var(--color-gray-900)}.goal-list-page__back-button[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--color-primary-500);outline-offset:2px}.goal-list-page__title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--color-gray-900);margin:0}.goal-list-page__actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}.goal-list-page__loading[_ngcontent-%COMP%]{padding:2rem;text-align:center;color:var(--color-gray-600)}.goal-list-page__tree-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})};export{k as GoalListPageComponent};
