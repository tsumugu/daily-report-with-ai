import{a as K}from"./chunk-BCZMHKAQ.js";import{b as J}from"./chunk-IDH2I7ZG.js";import"./chunk-NAOTXHQH.js";import"./chunk-4JFTRTP5.js";import{a as v,b as k,c as A,d as T,e as B,f as R,j as V,k as N,m as $,n as q,o as H,p as X,q as z,t as W,z as j}from"./chunk-YHDQOJME.js";import{s as O,t as G}from"./chunk-HCRNHK5J.js";import{$ as g,$a as M,Ba as i,Ka as D,Pa as S,S as C,Wa as l,Ya as P,_ as c,_a as L,aa as E,ab as w,ba as I,bb as F,cb as a,db as u,eb as h,fb as b,ib as d,jb as m,na as _,pb as f}from"./chunk-TUMKYTCV.js";import{a as x,b as y}from"./chunk-4CLCTAJ7.js";function U(s,o){if(s&1){let e=b();a(0,"app-alert-banner",22),d("dismissed",function(){c(e);let n=m();return g(n.errorMessage.set(null))}),u()}if(s&2){let e=m();l("message",e.errorMessage())("dismissible",!0)}}function Y(s,o){if(s&1){let e=b();a(0,"app-form-card",23),d("removed",function(){let n=c(e).$index,r=m();return g(r.removeGoodPoint(n))}),a(1,"div",24)(2,"app-textarea-field",25),d("valueChange",function(n){let r=c(e).$index,p=m();return g(p.updateGoodPoint(r,"content",n))}),u()(),a(3,"div",24)(4,"app-textarea-field",26),d("valueChange",function(n){let r=c(e).$index,p=m();return g(p.updateGoodPoint(r,"factors",n))}),u()()()}if(s&2){let e=o.$implicit,t=o.$index,n=m();i(2),l("label","\u5185\u5BB9")("id","good-point-content-"+t)("maxLength",n.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.content),i(2),l("label","\u8981\u56E0\u30FB\u80CC\u666F")("id","good-point-factors-"+t)("maxLength",n.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.factors)}}function Z(s,o){if(s&1){let e=b();a(0,"app-form-card",23),d("removed",function(){let n=c(e).$index,r=m();return g(r.removeImprovement(n))}),a(1,"div",24)(2,"app-textarea-field",27),d("valueChange",function(n){let r=c(e).$index,p=m();return g(p.updateImprovement(r,"content",n))}),u()(),a(3,"div",24)(4,"app-textarea-field",28),d("valueChange",function(n){let r=c(e).$index,p=m();return g(p.updateImprovement(r,"action",n))}),u()()()}if(s&2){let e=o.$implicit,t=o.$index,n=m();i(2),l("label","\u6539\u5584\u3057\u305F\u3044\u3053\u3068")("id","improvement-content-"+t)("maxLength",n.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.content),i(2),l("label","\u30A2\u30AF\u30B7\u30E7\u30F3")("id","improvement-action-"+t)("maxLength",n.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.action)}}var Q=class s{fb=C(N);router=C(O);dailyReportService=C(K);form;goodPoints=_([]);improvements=_([]);selectedGoalIds=_([]);isLoading=_(!1);errorMessage=_(null);isSubmitted=_(!1);MAX_LENGTH=1e3;constructor(){let o=new Date().toISOString().split("T")[0];this.form=this.fb.group({date:[o,[v.required]],events:["",[v.required,v.maxLength(this.MAX_LENGTH)]],learnings:["",[v.maxLength(this.MAX_LENGTH)]]})}addGoodPoint(){this.goodPoints.update(o=>[...o,{content:"",factors:""}])}removeGoodPoint(o){this.goodPoints.update(e=>e.filter((t,n)=>n!==o))}updateGoodPoint(o,e,t){this.goodPoints.update(n=>n.map((r,p)=>p===o?y(x({},r),{[e]:t}):r))}addImprovement(){this.improvements.update(o=>[...o,{content:"",action:""}])}removeImprovement(o){this.improvements.update(e=>e.filter((t,n)=>n!==o))}updateImprovement(o,e,t){this.improvements.update(n=>n.map((r,p)=>p===o?y(x({},r),{[e]:t}):r))}onSubmit(){if(this.isSubmitted.set(!0),this.form.invalid){this.form.markAllAsTouched();return}this.isLoading.set(!0),this.errorMessage.set(null);let o={date:this.form.get("date")?.value,events:this.form.get("events")?.value,learnings:this.form.get("learnings")?.value||void 0,goalIds:this.selectedGoalIds().length>0?this.selectedGoalIds():void 0,goodPoints:this.goodPoints().filter(e=>e.content.trim()).map(e=>({content:e.content,factors:e.factors||void 0})),improvements:this.improvements().filter(e=>e.content.trim()).map(e=>({content:e.content,action:e.action||void 0}))};this.dailyReportService.create(o).subscribe({next:()=>{this.isLoading.set(!1),this.router.navigate(["/daily-reports"])},error:e=>{this.isLoading.set(!1),this.errorMessage.set(e.error?.message||"\u65E5\u5831\u306E\u4FDD\u5B58\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u3082\u3046\u4E00\u5EA6\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002")}})}getFieldError(o){let e=this.form.get(o);return!e||!e.errors||!e.touched&&!this.isSubmitted()?null:e.errors.required?"\u3053\u306E\u9805\u76EE\u306F\u5FC5\u9808\u3067\u3059":e.errors.maxlength?`${this.MAX_LENGTH}\u6587\u5B57\u4EE5\u5185\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044`:null}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=D({type:s,selectors:[["app-daily-report-input-page"]],decls:36,vars:30,consts:[[1,"daily-report-input"],[1,"header"],["routerLink","/daily-reports",1,"back-link"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","m15 18-6-6 6-6"],[1,"title"],["variant","error",3,"message","dismissible"],[1,"form",3,"ngSubmit","formGroup"],["label","\u65E5\u4ED8","id","date","formControlName","date",3,"required","errorMessage","touched","submitted"],["label","\u95A2\u9023\u3059\u308B\u76EE\u6A19","placeholder","\u76EE\u6A19\u3092\u9078\u629E",3,"valueChange","value"],["label","\u3067\u304D\u3054\u3068","id","events","formControlName","events","placeholder","\u4ECA\u65E5\u306E\u4E3B\u306A\u696D\u52D9\u5185\u5BB9\u3001\u51FA\u6765\u4E8B\u3092\u8A18\u5165\u3057\u3066\u304F\u3060\u3055\u3044",3,"labelIcon","required","maxLength","rows","errorMessage","touched","submitted"],["label","\u5B66\u3073","id","learnings","formControlName","learnings","placeholder","\u696D\u52D9\u3092\u901A\u3058\u3066\u5F97\u305F\u6C17\u3065\u304D\u3001\u5B66\u3073\u3092\u8A18\u5165\u3057\u3066\u304F\u3060\u3055\u3044",3,"labelIcon","maxLength","rows","touched","submitted"],[1,"form-group","form-group--no-border"],[1,"label"],[1,"label-icon"],["name","heart","color","var(--color-primary-500)","ariaLabel","\u3088\u304B\u3063\u305F\u3053\u3068",3,"size"],[1,"form-group__card"],[1,"form-group__add-button"],["variant","secondary","icon","plus",3,"clicked","fullWidth"],["name","file-text","color","var(--color-primary-500)","ariaLabel","\u6539\u5584\u70B9",3,"size"],[1,"form-actions"],["type","submit","variant","primary",3,"fullWidth","loading","disabled"],["variant","error",3,"dismissed","message","dismissible"],[1,"form-group__card",3,"removed"],[1,"card-field"],["placeholder","\u3046\u307E\u304F\u3044\u3063\u305F\u3053\u3068\u3001\u6210\u529F\u4F53\u9A13",3,"valueChange","label","id","maxLength","rows","showCharCount","value"],["placeholder","\u306A\u305C\u3046\u307E\u304F\u3044\u3063\u305F\u304B",3,"valueChange","label","id","maxLength","rows","showCharCount","value"],["placeholder","\u6539\u5584\u3057\u305F\u3044\u70B9\u3001\u8AB2\u984C",3,"valueChange","label","id","maxLength","rows","showCharCount","value"],["placeholder","\u660E\u65E5\u4EE5\u964D\u306B\u8A66\u3057\u305F\u3044\u3053\u3068",3,"valueChange","label","id","maxLength","rows","showCharCount","value"]],template:function(e,t){if(e&1&&(a(0,"div",0)(1,"header",1)(2,"a",2),E(),a(3,"svg",3),h(4,"path",4),u()(),I(),a(5,"h1",5),f(6,"\u65E5\u5831\u3092\u66F8\u304F"),u()(),S(7,U,1,2,"app-alert-banner",6),a(8,"form",7),d("ngSubmit",function(){return t.onSubmit()}),h(9,"app-date-field",8),a(10,"app-goal-multi-select-field",9),d("valueChange",function(r){return t.selectedGoalIds.set(r)}),u(),h(11,"app-textarea-field",10)(12,"app-textarea-field",11),a(13,"fieldset",12)(14,"legend",13)(15,"span",14),h(16,"app-icon",15),u(),f(17," \u3088\u304B\u3063\u305F\u3053\u3068 "),u(),w(18,Y,5,12,"app-form-card",16,M),a(20,"div",17)(21,"app-button",18),d("clicked",function(){return t.addGoodPoint()}),f(22,"\u8FFD\u52A0"),u()()(),a(23,"fieldset",12)(24,"legend",13)(25,"span",14),h(26,"app-icon",19),u(),f(27," \u6539\u5584\u70B9/\u30A2\u30AF\u30B7\u30E7\u30F3 "),u(),w(28,Z,5,12,"app-form-card",16,M),a(30,"div",17)(31,"app-button",18),d("clicked",function(){return t.addImprovement()}),f(32,"\u8FFD\u52A0"),u()()(),a(33,"div",20)(34,"app-button",21),f(35," \u4FDD\u5B58\u3059\u308B "),u()()()()),e&2){let n,r,p;i(7),L(t.errorMessage()?7:-1),i(),l("formGroup",t.form),i(),l("required",!0)("errorMessage",t.getFieldError("date")||"")("touched",((n=t.form.get("date"))==null?null:n.touched)||!1)("submitted",t.isSubmitted()),i(),l("value",t.selectedGoalIds()),i(),l("labelIcon","file-text")("required",!0)("maxLength",t.MAX_LENGTH)("rows",4)("errorMessage",t.getFieldError("events")||"")("touched",((r=t.form.get("events"))==null?null:r.touched)||!1)("submitted",t.isSubmitted()),i(),l("labelIcon","lightbulb")("maxLength",t.MAX_LENGTH)("rows",3)("touched",((p=t.form.get("learnings"))==null?null:p.touched)||!1)("submitted",t.isSubmitted()),i(),P("form-group--empty",t.goodPoints().length===0),i(3),l("size",20),i(2),F(t.goodPoints()),i(3),l("fullWidth",!0),i(2),P("form-group--empty",t.improvements().length===0),i(3),l("size",20),i(2),F(t.improvements()),i(3),l("fullWidth",!0),i(3),l("fullWidth",!0)("loading",t.isLoading())("disabled",t.isLoading())}},dependencies:[$,T,k,A,V,B,R,G,H,q,X,j,W,z,J],styles:[".daily-report-input[_ngcontent-%COMP%]{min-height:100vh;background:var(--color-bg-secondary);padding-bottom:100px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 20px;background:var(--color-white);border-bottom:1px solid var(--color-gray-200);position:sticky;top:0;z-index:100}.back-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;color:var(--color-gray-700);transition:background-color .2s}.back-link[_ngcontent-%COMP%]:hover{background:var(--color-gray-100)}.title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--color-gray-900);margin:0}.form[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:24px 20px}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:32px}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form[_ngcontent-%COMP%]   app-date-field[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   app-textarea-field[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   app-goal-multi-select-field[_ngcontent-%COMP%]{display:block;margin-bottom:32px}.form-group[_ngcontent-%COMP%]{margin-bottom:32px;border:none;padding:0}.form-group--no-border[_ngcontent-%COMP%]{border:none;padding:0;margin:0 0 32px}.form-group[_ngcontent-%COMP%]     app-form-card.form-group__card{display:block;margin-bottom:24px}.form-group[_ngcontent-%COMP%]     app-form-card.form-group__card:last-of-type{margin-bottom:0}.form-group__add-button[_ngcontent-%COMP%]{margin-top:24px}.form-group--empty[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:4px}.form-group--empty[_ngcontent-%COMP%]   .form-group__add-button[_ngcontent-%COMP%]{margin-top:0}.label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.95rem;font-weight:600;color:var(--color-gray-800);margin-bottom:16px;padding:0}.label-icon[_ngcontent-%COMP%]{font-size:1.1rem}.card-field[_ngcontent-%COMP%]{margin-bottom:16px}.card-field[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-actions[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;padding:16px 20px;background:var(--color-white);border-top:1px solid var(--color-gray-200);box-shadow:0 -2px 10px #0000000d}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{position:static;padding:24px 0 0;background:transparent;border-top:none;box-shadow:none}}app-alert-banner[_ngcontent-%COMP%]{display:block;margin:16px 20px 0;max-width:600px}@media (min-width: 640px){app-alert-banner[_ngcontent-%COMP%]{margin:16px auto 0}}"]})};export{Q as DailyReportInputPageComponent};
