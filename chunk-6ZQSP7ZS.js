import{a as R,f as X,g as V}from"./chunk-67QQE4MI.js";import{a as k}from"./chunk-EHRPYQYN.js";import{b as m,c as T,d as D,e as L,f as x,g as P,l as O,n as N,o as q,p as w,q as H}from"./chunk-BNY3RDUL.js";import"./chunk-IY3UEH2H.js";import"./chunk-S7Y6GWYN.js";import{b as B}from"./chunk-GCOMOK3V.js";import{e as G,q as S,s as A}from"./chunk-H77UF764.js";import{Ab as I,Ba as r,Ka as F,Pa as v,S as f,Wa as i,_a as b,cb as o,db as n,eb as l,ib as C,jb as M,na as p,pb as g,rb as y,sb as _}from"./chunk-TUMKYTCV.js";import"./chunk-4CLCTAJ7.js";function j(d,a){if(d&1&&l(0,"app-alert-banner",4),d&2){let e=M();i("message",e.errorMessage())}}function z(d,a){if(d&1&&l(0,"app-toast",18),d&2){let e=M();i("message",e.toastMessage())("variant",e.toastVariant())}}var U=class d{fb=f(O);route=f(S);router=f(A);goalService=f(V);cdr=f(I);isEditMode=p(!1);goalId=p(null);isLoading=p(!1);errorMessage=p(null);parentGoalOptions=p([]);goalTypeOptions=[{id:"skill",label:"\u30B9\u30AD\u30EB\u7FD2\u5F97"},{id:"project",label:"\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u5B8C\u4E86"},{id:"habit",label:"\u7FD2\u6163\u5F62\u6210"},{id:"other",label:"\u305D\u306E\u4ED6"}];toastMessage=p(null);toastVariant=p("success");form;MAX_NAME_LENGTH=100;MAX_DESCRIPTION_LENGTH=1e3;MAX_SUCCESS_CRITERIA_LENGTH=500;pendingParentId=null;constructor(){this.form=this.fb.group({name:["",[m.required,m.maxLength(this.MAX_NAME_LENGTH)]],description:["",[m.maxLength(this.MAX_DESCRIPTION_LENGTH)]],startDate:["",m.required],endDate:["",m.required],parentId:[null],goalType:[null],successCriteria:["",[m.maxLength(this.MAX_SUCCESS_CRITERIA_LENGTH)]]})}ngOnInit(){let a=this.route.snapshot.paramMap.get("id");if(a)this.isEditMode.set(!0),this.goalId.set(a),this.loadGoal(a);else{let e=this.route.snapshot.queryParamMap.get("parentId");e&&e.trim()!==""&&(this.pendingParentId=e.trim())}this.loadParentGoalOptions()}loadGoal(a){this.isLoading.set(!0),this.errorMessage.set(null),this.goalService.getGoal(a).subscribe({next:e=>{this.form.patchValue({name:e.name,description:e.description||"",startDate:e.startDate,endDate:e.endDate,parentId:e.parentId,goalType:e.goalType,successCriteria:e.successCriteria||""}),this.isLoading.set(!1)},error:e=>{this.errorMessage.set(e.error?.message||"\u76EE\u6A19\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),this.isLoading.set(!1)}})}loadParentGoalOptions(){this.goalService.getGoals(!0).subscribe({next:a=>{let e=a.data,t=[{id:"",label:"\u306A\u3057"}],s=u=>{let E=[];for(let c of u)E.push(c),c.children&&c.children.length>0&&E.push(...s(c.children));return E},h=s(e);for(let u of h)this.isEditMode()&&this.goalId()&&(u.id===this.goalId()||this.isDescendant(u.id,this.goalId(),h))||t.push({id:u.id,label:u.name});if(this.parentGoalOptions.set(t),!this.isEditMode()&&this.pendingParentId){let u=this.pendingParentId;t.some(c=>c.id===u)?(this.cdr.detectChanges(),Promise.resolve().then(()=>{this.form.patchValue({parentId:u}),this.cdr.detectChanges()}),this.pendingParentId=null):this.pendingParentId=null}},error:()=>{this.parentGoalOptions.set([{id:"",label:"\u306A\u3057"}])}})}isDescendant(a,e,t){let s=t.find(h=>h.id===a);return!s||!s.parentId?!1:s.parentId===e?!0:this.isDescendant(s.parentId,e,t)}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.isLoading.set(!0),this.errorMessage.set(null);let a=this.form.value,e={name:a.name,description:a.description||null,startDate:a.startDate,endDate:a.endDate,parentId:a.parentId||null,goalType:a.goalType||null,successCriteria:a.successCriteria||null};this.isEditMode()&&this.goalId()?this.goalService.updateGoal(this.goalId(),e).subscribe({next:()=>{this.showToast("\u76EE\u6A19\u3092\u66F4\u65B0\u3057\u307E\u3057\u305F","success"),this.router.navigate(["/goals",this.goalId()])},error:t=>{this.errorMessage.set(t.error?.message||"\u76EE\u6A19\u306E\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),this.isLoading.set(!1)}}):this.goalService.createGoal(e).subscribe({next:t=>{this.showToast("\u76EE\u6A19\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success"),this.router.navigate(["/goals",t.id])},error:t=>{this.errorMessage.set(t.error?.message||"\u76EE\u6A19\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),this.isLoading.set(!1)}})}onCancel(){this.isEditMode()&&this.goalId()?this.router.navigate(["/goals",this.goalId()]):this.router.navigate(["/goals"])}showToast(a,e){this.toastMessage.set(a),this.toastVariant.set(e),setTimeout(()=>{this.toastMessage.set(null)},3e3)}getErrorMessage(a){let e=this.form.get(a);if(e&&e.invalid&&e.touched){if(e.errors?.required)return`${this.getFieldLabel(a)}\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044`;if(e.errors?.maxlength){let t=e.errors.maxlength.requiredLength;return`${this.getFieldLabel(a)}\u306F${t}\u6587\u5B57\u4EE5\u5185\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044`}}return""}getFieldLabel(a){return{name:"\u76EE\u6A19\u540D",description:"\u76EE\u6A19\u306E\u8AAC\u660E",startDate:"\u958B\u59CB\u65E5",endDate:"\u7D42\u4E86\u65E5",successCriteria:"\u9054\u6210\u57FA\u6E96"}[a]||a}getCharacterCount(a){return this.form.get(a)?.value?.length||0}getMaxLength(a){return{name:this.MAX_NAME_LENGTH,description:this.MAX_DESCRIPTION_LENGTH,successCriteria:this.MAX_SUCCESS_CRITERIA_LENGTH}[a]||0}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=F({type:d,selectors:[["app-goal-form-page"]],decls:34,vars:21,consts:[[1,"goal-form-page"],[1,"goal-form-page__header"],["type","button","aria-label","\u623B\u308B",1,"goal-form-page__back-button",3,"click"],[1,"goal-form-page__title"],["variant","error",3,"message"],[1,"goal-form-page__form",3,"ngSubmit","formGroup"],[1,"goal-form-page__field"],["formControlName","name","label","\u76EE\u6A19\u540D","placeholder","\u76EE\u6A19\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044","id","goal-name",3,"errorMessage"],[1,"goal-form-page__character-count"],["formControlName","description","label","\u76EE\u6A19\u306E\u8AAC\u660E","placeholder","\u76EE\u6A19\u306E\u8AAC\u660E\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF08\u4EFB\u610F\uFF09","id","goal-description",3,"errorMessage"],["formControlName","startDate","label","\u958B\u59CB\u65E5","id","goal-start-date",3,"errorMessage"],["formControlName","endDate","label","\u7D42\u4E86\u65E5","id","goal-end-date",3,"errorMessage"],["formControlName","parentId","label","\u4E0A\u4F4D\u76EE\u6A19","emptyLabel","\u306A\u3057","id","goal-parent-id",3,"options"],["formControlName","goalType","label","\u76EE\u6A19\u306E\u6027\u8CEA","placeholder","\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\uFF08\u4EFB\u610F\uFF09","id","goal-type",3,"options","showEmptyOption"],["formControlName","successCriteria","label","\u9054\u6210\u57FA\u6E96","placeholder","\u9054\u6210\u57FA\u6E96\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF08\u4EFB\u610F\uFF09","id","goal-success-criteria",3,"errorMessage"],[1,"goal-form-page__actions"],["variant","secondary",3,"clicked","disabled"],["variant","primary","type","submit",3,"disabled"],[3,"message","variant"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"header",1)(2,"button",2),C("click",function(){return t.onCancel()}),g(3," \u2190 "),n(),o(4,"h1",3),g(5),n()(),v(6,j,1,1,"app-alert-banner",4),o(7,"form",5),C("ngSubmit",function(){return t.onSubmit()}),o(8,"div",6),l(9,"app-input-field",7),o(10,"div",8),g(11),n()(),o(12,"div",6),l(13,"app-textarea-field",9),o(14,"div",8),g(15),n()(),o(16,"div",6),l(17,"app-date-field",10),n(),o(18,"div",6),l(19,"app-date-field",11),n(),o(20,"div",6),l(21,"app-entity-select-field",12),n(),o(22,"div",6),l(23,"app-entity-select-field",13),n(),o(24,"div",6),l(25,"app-textarea-field",14),o(26,"div",8),g(27),n()(),o(28,"div",15)(29,"app-button",16),C("clicked",function(){return t.onCancel()}),g(30," \u30AD\u30E3\u30F3\u30BB\u30EB "),n(),o(31,"app-button",17),g(32),n()()(),v(33,z,1,2,"app-toast",18),n()),e&2&&(r(5),y(" ",t.isEditMode()?"\u76EE\u6A19\u3092\u7DE8\u96C6":"\u76EE\u6A19\u3092\u4F5C\u6210"," "),r(),b(t.errorMessage()?6:-1),r(),i("formGroup",t.form),r(2),i("errorMessage",t.getErrorMessage("name")),r(2),_(" ",t.getCharacterCount("name")," / ",t.getMaxLength("name")," "),r(2),i("errorMessage",t.getErrorMessage("description")),r(2),_(" ",t.getCharacterCount("description")," / ",t.getMaxLength("description")," "),r(2),i("errorMessage",t.getErrorMessage("startDate")),r(2),i("errorMessage",t.getErrorMessage("endDate")),r(2),i("options",t.parentGoalOptions()),r(2),i("options",t.goalTypeOptions)("showEmptyOption",!1),r(2),i("errorMessage",t.getErrorMessage("successCriteria")),r(2),_(" ",t.getCharacterCount("successCriteria")," / ",t.getMaxLength("successCriteria")," "),r(2),i("disabled",t.isLoading()),r(2),i("disabled",t.form.invalid||t.isLoading()),r(),y(" ",t.isEditMode()?"\u66F4\u65B0\u3059\u308B":"\u4FDD\u5B58\u3059\u308B"," "),r(),b(t.toastMessage()?33:-1))},dependencies:[G,N,L,T,D,x,P,B,R,w,q,X,k,H],styles:[".goal-form-page[_ngcontent-%COMP%]{padding:1rem;max-width:800px;margin:0 auto}.goal-form-page__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}.goal-form-page__back-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:2rem;height:2rem;border:none;background-color:transparent;color:var(--color-gray-700);font-size:1.25rem;cursor:pointer;border-radius:.25rem;transition:all .2s ease}.goal-form-page__back-button[_ngcontent-%COMP%]:hover{background-color:var(--color-gray-100);color:var(--color-gray-900)}.goal-form-page__back-button[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--color-primary-500);outline-offset:2px}.goal-form-page__title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--color-gray-900);margin:0}.goal-form-page__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.goal-form-page__field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.goal-form-page__character-count[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-gray-500);text-align:right}.goal-form-page__actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem}"]})};export{U as GoalFormPageComponent};
