import{a as E}from"./chunk-4SEINJZR.js";import{c as se}from"./chunk-ZCBRORG4.js";import"./chunk-VIH4BLUS.js";import{a as ae}from"./chunk-NAOTXHQH.js";import{A as le,a as P,b as N,c as $,d as q,e as j,f as G,g as U,h as H,i as J,j as K,k as Q,m as X,n as Y,o as k,p as Z,q as ee,r as oe,t as te,w as re,y as ie,z as ne}from"./chunk-YHDQOJME.js";import{e as A,s as z,t as R}from"./chunk-HCRNHK5J.js";import{$ as m,Ba as a,Ka as x,Pa as b,S as w,Wa as d,Ya as V,_ as p,_a as _,ab as T,bb as I,cb as i,db as l,eb as C,fb as v,ia as F,ib as g,jb as c,na as y,pb as s,qb as S,rb as h,sb as D,t as W}from"./chunk-TUMKYTCV.js";import{a as B}from"./chunk-4CLCTAJ7.js";function fe(r,o){if(r&1&&C(0,"app-status-badge",4),r&2){let e=c(2);d("status",e.status)}}function ge(r,o){if(r&1){let e=v();i(0,"div",0)(1,"div",1)(2,"span",2),C(3,"app-icon",3),s(4),l(),b(5,fe,1,1,"app-status-badge",4),l(),i(6,"div",5)(7,"p",6),s(8),l(),i(9,"div",7)(10,"span",8),s(11),l()()(),i(12,"div",9)(13,"span",10),C(14,"app-icon",11),s(15),l(),i(16,"div",12)(17,"app-icon-button",13),g("clicked",function(){p(e);let n=c();return m(n.onToggleWeeklyFocus())}),l(),i(18,"app-button",14),g("clicked",function(){p(e);let n=c();return m(n.onFollowupClick())}),s(19," \u30D5\u30A9\u30ED\u30FC\u30A2\u30C3\u30D7 "),l(),i(20,"app-button",15),g("clicked",function(){p(e);let n=c();return m(n.onCardClick())}),s(21," \u65E5\u5831\u3092\u898B\u308B "),l()()()()}if(r&2){let e=c();a(3),d("name",e.itemTypeIcon)("size",20)("color","var(--color-primary-500)")("ariaLabel",e.itemTypeLabel),a(),h(" ",e.itemTypeLabel," "),a(),_(e.status?5:-1),a(3),S(e.item.item.content),a(3),D("",e.countLabel,": ",e.successCount,"\u56DE"),a(3),d("size",16),a(),h(" ",e.item.reportDate," "),a(2),d("size",20)("color",e.isInWeeklyFocus?"var(--color-primary-600)":"var(--color-primary-500)")("tooltip",e.isInWeeklyFocus?"\u30D5\u30A9\u30FC\u30AB\u30B9\u304B\u3089\u524A\u9664":"\u30D5\u30A9\u30FC\u30AB\u30B9\u306B\u8FFD\u52A0")("loading",e.isAddingToWeeklyFocus)("disabled",e.isAddingToWeeklyFocus||!e.isInWeeklyFocus&&e.isWeeklyFocusLimitReached)("pinned",e.isInWeeklyFocus)("ariaLabel",e.isInWeeklyFocus?"\u30D5\u30A9\u30FC\u30AB\u30B9\u304B\u3089\u524A\u9664":"\u30D5\u30A9\u30FC\u30AB\u30B9\u306B\u8FFD\u52A0")}}var O=class r{item;isInWeeklyFocus=!1;isAddingToWeeklyFocus=!1;isWeeklyFocusLimitReached=!1;cardClick=new F;followupClick=new F;toggleWeeklyFocus=new F;onCardClick(){this.cardClick.emit(this.item.reportId)}onFollowupClick(){this.followupClick.emit(this.item)}onToggleWeeklyFocus(){this.toggleWeeklyFocus.emit(this.item)}get itemTypeLabel(){return this.item.itemType==="goodPoint"?"\u3088\u304B\u3063\u305F\u3053\u3068":"\u6539\u5584\u70B9"}get itemTypeIcon(){return this.item.itemType==="goodPoint"?"heart":"file-text"}get status(){return this.item?.item?.status}get successCount(){return this.item?.item?.success_count??0}get countLabel(){return this.item?.itemType==="goodPoint"?"\u30A8\u30D4\u30BD\u30FC\u30C9":"\u30A2\u30AF\u30B7\u30E7\u30F3"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-followup-card"]],inputs:{item:"item",isInWeeklyFocus:"isInWeeklyFocus",isAddingToWeeklyFocus:"isAddingToWeeklyFocus",isWeeklyFocusLimitReached:"isWeeklyFocusLimitReached"},outputs:{cardClick:"cardClick",followupClick:"followupClick",toggleWeeklyFocus:"toggleWeeklyFocus"},decls:1,vars:1,consts:[[1,"followup-card"],[1,"followup-card__header"],[1,"followup-card__type"],[3,"name","size","color","ariaLabel"],[3,"status"],[1,"followup-card__content"],[1,"followup-card__text"],[1,"followup-card__meta"],[1,"followup-card__success-count"],[1,"followup-card__footer"],[1,"followup-card__date"],["name","calendar","color","var(--color-gray-600)","ariaLabel","\u65E5\u4ED8",3,"size"],[1,"followup-card__actions"],["iconName","pin",3,"clicked","size","color","tooltip","loading","disabled","pinned","ariaLabel"],["variant","secondary","size","sm","ariaLabel","\u30D5\u30A9\u30ED\u30FC\u30A2\u30C3\u30D7\u3092\u5165\u529B",3,"clicked"],["variant","ghost","size","sm","ariaLabel","\u65E5\u5831\u3092\u898B\u308B",3,"clicked"]],template:function(e,t){e&1&&b(0,ge,22,18,"div",0),e&2&&_(t.item?0:-1)},dependencies:[A,ie,k,ee,re],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--color-primary-50: #fffbeb;--color-primary-100: #fef3c7;--color-primary-200: #fde68a;--color-primary-300: #fcd34d;--color-primary-400: #fbbf24;--color-primary-500: #f59e0b;--color-primary-600: #d97706;--color-primary-700: #b45309;--color-primary-800: #92400e;--color-primary-900: #78350f;--color-secondary-50: #f0fdfa;--color-secondary-100: #ccfbf1;--color-secondary-200: #99f6e4;--color-secondary-300: #5eead4;--color-secondary-400: #2dd4bf;--color-secondary-500: #14b8a6;--color-secondary-600: #0d9488;--color-secondary-700: #0f766e;--color-secondary-800: #115e59;--color-secondary-900: #134e4a;--color-gray-50: #f9fafb;--color-gray-100: #f3f4f6;--color-gray-200: #e5e7eb;--color-gray-300: #d1d5db;--color-gray-400: #9ca3af;--color-gray-500: #6b7280;--color-gray-600: #4b5563;--color-gray-700: #374151;--color-gray-800: #1f2937;--color-gray-900: #111827;--color-success-50: #ecfdf5;--color-success-100: #d1fae5;--color-success-500: #10b981;--color-success-600: #059669;--color-success-700: #047857;--color-warning-50: #fffbeb;--color-warning-100: #fef3c7;--color-warning-500: #f59e0b;--color-warning-600: #d97706;--color-warning-700: #b45309;--color-error-50: #fef2f2;--color-error-100: #fee2e2;--color-error-500: #ef4444;--color-error-600: #dc2626;--color-error-700: #b91c1c;--color-info-50: #eff6ff;--color-info-100: #dbeafe;--color-info-500: #3b82f6;--color-info-600: #2563eb;--color-info-700: #1d4ed8;--color-bg-primary: #ffffff;--color-bg-secondary: #ffffff;--color-bg-tertiary: #ffffff;--color-text-primary: var(--color-gray-900);--color-text-secondary: var(--color-gray-600);--color-text-tertiary: var(--color-gray-500);--color-text-disabled: var(--color-gray-400);--color-text-inverse: #ffffff;--color-border-default: var(--color-gray-200);--color-border-hover: var(--color-gray-300);--color-border-focus: var(--color-primary-500);--color-border-error: var(--color-error-500)}.followup-card[_ngcontent-%COMP%]{background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:.5rem;padding:1rem;display:flex;flex-direction:column;gap:.75rem;transition:box-shadow .2s}.followup-card[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a}.followup-card__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.followup-card__type[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-secondary)}.followup-card__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.followup-card__text[_ngcontent-%COMP%]{margin:0;font-size:.9375rem;line-height:1.5;color:var(--color-text-primary);display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.followup-card__meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}.followup-card__success-count[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary)}.followup-card__footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:.5rem;border-top:1px solid var(--color-border-default)}.followup-card__date[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary)}.followup-card__actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}']})};var _e=(r,o)=>o.value;function ye(r,o){if(r&1&&(i(0,"option",11),s(1),l()),r&2){let e=o.$implicit;d("value",e.value),a(),h(" ",e.label," ")}}function be(r,o){r&1&&(i(0,"span",12),s(1," \u30B9\u30C6\u30FC\u30BF\u30B9\u306F\u5FC5\u9808\u3067\u3059 "),l())}function Ce(r,o){if(r&1&&(i(0,"p",15),s(1),l()),r&2){let e,t=c(2);a(),h(" \u203B \u30B9\u30C6\u30FC\u30BF\u30B9\u304C\u300C",(e=t.form.get("status"))==null?null:e.value,"\u300D\u306E\u5834\u5408\u306F\u5FC5\u9808 ")}}function ve(r,o){if(r&1&&(i(0,"div",16),s(1),l()),r&2){let e=c(2);a(),h(" ",e.errorMessage," ")}}function we(r,o){if(r&1){let e=v();i(0,"div",1),g("click",function(){p(e);let n=c();return m(n.onClose())})("keydown.escape",function(){p(e);let n=c();return m(n.onClose())}),i(1,"div",2),g("click",function(n){return p(e),m(n.stopPropagation())})("keydown.escape",function(n){return p(e),m(n.stopPropagation())}),i(2,"header",3)(3,"h2",4),s(4),l(),i(5,"button",5),g("click",function(){p(e);let n=c();return m(n.onClose())}),s(6,"\xD7"),l()(),i(7,"form",6),g("ngSubmit",function(){p(e);let n=c();return m(n.onSubmit())}),i(8,"app-form-card")(9,"div",7)(10,"label",8),s(11," \u30B9\u30C6\u30FC\u30BF\u30B9 "),i(12,"span",9),s(13,"*"),l()(),i(14,"select",10),T(15,ye,2,2,"option",11,_e),l(),b(17,be,2,0,"span",12),l(),i(18,"div",7),C(19,"app-textarea-field",13),l(),i(20,"div",7),C(21,"app-date-field",14),b(22,Ce,2,1,"p",15),l(),b(23,ve,2,1,"div",16),i(24,"div",17)(25,"app-button",18),g("clicked",function(){p(e);let n=c();return m(n.onClose())}),s(26," \u30AD\u30E3\u30F3\u30BB\u30EB "),l(),i(27,"app-button",19),s(28," \u4FDD\u5B58\u3059\u308B "),l()()()()()()}if(r&2){let e,t,n,f,u=c();d("@modalScale",void 0),a(4),S(u.modalTitle),a(3),d("formGroup",u.form),a(7),V("form-select--error",((e=u.form.get("status"))==null?null:e.invalid)&&((e=u.form.get("status"))==null?null:e.touched)),a(),I(u.statusOptions),a(2),_((t=u.form.get("status"))!=null&&t.invalid&&((t=u.form.get("status"))!=null&&t.touched)?17:-1),a(2),d("label",u.memoLabel)("placeholder",u.memoPlaceholder)("maxLength",500)("showCharCount",!0)("errorMessage",(n=u.form.get("memo"))!=null&&n.invalid&&((n=u.form.get("memo"))!=null&&n.touched)?"\u30E1\u30E2\u306F500\u6587\u5B57\u4EE5\u5185\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044":""),a(2),d("label",u.dateLabel)("required",u.dateRequired)("errorMessage",(f=u.form.get("date"))!=null&&f.invalid&&((f=u.form.get("date"))!=null&&f.touched)?u.dateLabel+"\u306F\u5FC5\u9808\u3067\u3059":""),a(),_(u.dateRequired?22:-1),a(),_(u.errorMessage?23:-1),a(2),d("disabled",u.isSubmitting),a(2),d("loading",u.isSubmitting)("disabled",u.form.invalid||u.isSubmitting)}}var L=class r{fb=w(Q);followupService=w(E);item;isOpen=!1;closed=new F;saved=new F;form;isSubmitting=!1;errorMessage=null;statusOptions=[];ngOnInit(){this.initializeStatusOptions(),this.initializeForm()}initializeStatusOptions(){this.item.itemType==="goodPoint"?this.statusOptions.push({value:"\u672A\u7740\u624B",label:"\u672A\u7740\u624B"},{value:"\u9032\u884C\u4E2D",label:"\u9032\u884C\u4E2D"},{value:"\u518D\u73FE\u6210\u529F",label:"\u518D\u73FE\u6210\u529F"},{value:"\u518D\u73FE\u3067\u304D\u305A",label:"\u518D\u73FE\u3067\u304D\u305A"}):this.statusOptions.push({value:"\u672A\u7740\u624B",label:"\u672A\u7740\u624B"},{value:"\u9032\u884C\u4E2D",label:"\u9032\u884C\u4E2D"},{value:"\u5B8C\u4E86",label:"\u5B8C\u4E86"},{value:"\u672A\u9054\u6210",label:"\u672A\u9054\u6210"})}initializeForm(){this.form=this.fb.group({status:["\u9032\u884C\u4E2D",P.required],memo:["",[P.maxLength(500)]],date:[""]}),this.form.get("status")?.valueChanges.subscribe(o=>{let e=this.form.get("date");o==="\u518D\u73FE\u6210\u529F"||o==="\u5B8C\u4E86"?e?.setValidators([P.required]):e?.clearValidators(),e?.updateValueAndValidity()})}get modalTitle(){return this.item.itemType==="goodPoint"?"\u3088\u304B\u3063\u305F\u3053\u3068\u306E\u30D5\u30A9\u30ED\u30FC\u30A2\u30C3\u30D7":"\u6539\u5584\u70B9\u306E\u30D5\u30A9\u30ED\u30FC\u30A2\u30C3\u30D7"}get dateLabel(){return this.item.itemType==="goodPoint"?"\u518D\u73FE\u65E5":"\u30A2\u30AF\u30B7\u30E7\u30F3\u3092\u3057\u305F\u65E5"}get memoLabel(){return this.item.itemType==="goodPoint"?"\u518D\u73FE\u30E1\u30E2":"\u5B9F\u65BD\u5185\u5BB9"}get memoPlaceholder(){return this.item.itemType==="goodPoint"?"\u3069\u306E\u3088\u3046\u306B\u518D\u73FE\u3057\u305F\u304B\u3001\u3067\u304D\u306A\u304B\u3063\u305F\u7406\u7531\u306A\u3069\u3092\u8A18\u9332\u3057\u3066\u304F\u3060\u3055\u3044":"\u3069\u306E\u3088\u3046\u306A\u30A2\u30AF\u30B7\u30E7\u30F3\u3092\u5B9F\u65BD\u3057\u305F\u304B\u3001\u3067\u304D\u306A\u304B\u3063\u305F\u7406\u7531\u306A\u3069\u3092\u8A18\u9332\u3057\u3066\u304F\u3060\u3055\u3044"}get dateRequired(){let o=this.form.get("status")?.value;return o==="\u518D\u73FE\u6210\u529F"||o==="\u5B8C\u4E86"}onClose(){this.closed.emit()}onSubmit(){if(this.form.invalid){this.markFormGroupTouched(this.form);return}this.isSubmitting=!0,this.errorMessage=null;let o=this.form.value,e=B(B({status:o.status},o.memo?{memo:o.memo}:{}),o.date?{date:o.date}:{});(this.item.itemType==="goodPoint"?this.followupService.addGoodPointFollowup(this.item.item.id,e):this.followupService.addImprovementFollowup(this.item.item.id,e)).subscribe({next:()=>{this.saved.emit(),this.onClose()},error:n=>{this.errorMessage=n.error?.message||"\u30D5\u30A9\u30ED\u30FC\u30A2\u30C3\u30D7\u306E\u4FDD\u5B58\u306B\u5931\u6557\u3057\u307E\u3057\u305F",this.isSubmitting=!1}})}markFormGroupTouched(o){Object.keys(o.controls).forEach(e=>{o.get(e)?.markAsTouched()})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-followup-input-modal"]],inputs:{item:"item",isOpen:"isOpen"},outputs:{closed:"closed",saved:"saved"},decls:1,vars:1,consts:[["tabindex","0","role","dialog","aria-modal","true","aria-labelledby","modal-title",1,"modal-overlay"],["tabindex","0","role","dialog","aria-modal","true","aria-labelledby","modal-title",1,"modal-overlay",3,"click","keydown.escape"],["role","document",1,"modal-content",3,"click","keydown.escape"],[1,"modal-header"],["id","modal-title",1,"modal-title"],["aria-label","\u9589\u3058\u308B",1,"modal-close",3,"click"],[1,"modal-form",3,"ngSubmit","formGroup"],[1,"form-field"],["for","status",1,"form-label"],[1,"form-required"],["id","status","formControlName","status",1,"form-select"],[3,"value"],[1,"form-error"],["id","memo","formControlName","memo",3,"label","placeholder","maxLength","showCharCount","errorMessage"],["id","date","formControlName","date",3,"label","required","errorMessage"],[1,"form-hint"],[1,"form-error-message"],[1,"form-actions"],["type","button","variant","secondary","ariaLabel","\u30AD\u30E3\u30F3\u30BB\u30EB",3,"clicked","disabled"],["type","submit","variant","primary","ariaLabel","\u4FDD\u5B58",3,"loading","disabled"]],template:function(e,t){e&1&&b(0,we,29,19,"div",0),e&2&&_(t.isOpen?0:-1)},dependencies:[X,q,H,J,U,N,$,K,j,G,k,ne,Z,te],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--color-primary-50: #fffbeb;--color-primary-100: #fef3c7;--color-primary-200: #fde68a;--color-primary-300: #fcd34d;--color-primary-400: #fbbf24;--color-primary-500: #f59e0b;--color-primary-600: #d97706;--color-primary-700: #b45309;--color-primary-800: #92400e;--color-primary-900: #78350f;--color-secondary-50: #f0fdfa;--color-secondary-100: #ccfbf1;--color-secondary-200: #99f6e4;--color-secondary-300: #5eead4;--color-secondary-400: #2dd4bf;--color-secondary-500: #14b8a6;--color-secondary-600: #0d9488;--color-secondary-700: #0f766e;--color-secondary-800: #115e59;--color-secondary-900: #134e4a;--color-gray-50: #f9fafb;--color-gray-100: #f3f4f6;--color-gray-200: #e5e7eb;--color-gray-300: #d1d5db;--color-gray-400: #9ca3af;--color-gray-500: #6b7280;--color-gray-600: #4b5563;--color-gray-700: #374151;--color-gray-800: #1f2937;--color-gray-900: #111827;--color-success-50: #ecfdf5;--color-success-100: #d1fae5;--color-success-500: #10b981;--color-success-600: #059669;--color-success-700: #047857;--color-warning-50: #fffbeb;--color-warning-100: #fef3c7;--color-warning-500: #f59e0b;--color-warning-600: #d97706;--color-warning-700: #b45309;--color-error-50: #fef2f2;--color-error-100: #fee2e2;--color-error-500: #ef4444;--color-error-600: #dc2626;--color-error-700: #b91c1c;--color-info-50: #eff6ff;--color-info-100: #dbeafe;--color-info-500: #3b82f6;--color-info-600: #2563eb;--color-info-700: #1d4ed8;--color-bg-primary: #ffffff;--color-bg-secondary: #ffffff;--color-bg-tertiary: #ffffff;--color-text-primary: var(--color-gray-900);--color-text-secondary: var(--color-gray-600);--color-text-tertiary: var(--color-gray-500);--color-text-disabled: var(--color-gray-400);--color-text-inverse: #ffffff;--color-border-default: var(--color-gray-200);--color-border-hover: var(--color-gray-300);--color-border-focus: var(--color-primary-500);--color-border-error: var(--color-error-500)}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.modal-content[_ngcontent-%COMP%]{background-color:var(--color-bg-primary);border-radius:.5rem;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 25px #0003}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid var(--color-border-default)}.modal-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--color-text-primary)}.modal-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s}.modal-close[_ngcontent-%COMP%]:hover{color:var(--color-text-primary)}.modal-form[_ngcontent-%COMP%]{padding:1.5rem}.form-field[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;font-weight:500;color:var(--color-text-primary)}.form-required[_ngcontent-%COMP%]{color:var(--color-error-500)}.form-select[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;border:1px solid var(--color-border-default);border-radius:.375rem;font-size:.9375rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);cursor:pointer;transition:border-color .2s}.form-select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-border-focus)}.form-select--error[_ngcontent-%COMP%]{border-color:var(--color-border-error)}.form-error[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.875rem;color:var(--color-error-500)}.form-hint[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:.75rem;color:var(--color-text-secondary)}.form-error-message[_ngcontent-%COMP%]{padding:.75rem;margin-bottom:1rem;background-color:var(--color-error-50);border-left:4px solid var(--color-error-500);color:var(--color-error-700);font-size:.875rem;border-radius:.25rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1.5rem}'],data:{animation:[se]}})};var Fe=(r,o)=>o.item.id;function he(r,o){if(r&1){let e=v();i(0,"app-alert-banner",22),g("dismissed",function(){p(e);let n=c();return m(n.errorMessage.set(null))}),l()}if(r&2){let e=c();d("message",e.errorMessage())("dismissible",!0)}}function xe(r,o){r&1&&(i(0,"div",16),s(1," \u8AAD\u307F\u8FBC\u307F\u4E2D... "),l())}function ke(r,o){r&1&&C(0,"app-empty-state",17)}function Me(r,o){if(r&1){let e=v();i(0,"app-followup-card",24),g("cardClick",function(n){p(e);let f=c(2);return m(f.onCardClick(n))})("followupClick",function(n){p(e);let f=c(2);return m(f.onFollowupClick(n))})("toggleWeeklyFocus",function(n){p(e);let f=c(2);return m(f.onToggleWeeklyFocus(n))}),l()}if(r&2){let e=o.$implicit,t=c(2);d("item",e)("isInWeeklyFocus",t.isInWeeklyFocus(e))("isAddingToWeeklyFocus",t.isAddingToWeeklyFocusCheck(e))("isWeeklyFocusLimitReached",t.isWeeklyFocusLimitReached())}}function Te(r,o){if(r&1&&(i(0,"div",18),T(1,Me,1,4,"app-followup-card",23,Fe),l()),r&2){let e=c();a(),I(e.items())}}function Ie(r,o){if(r&1){let e=v();i(0,"div",19)(1,"app-button",25),g("clicked",function(){p(e);let n=c();return m(n.onLoadMore())}),s(2," \u3082\u3063\u3068\u898B\u308B "),l()()}if(r&2){let e=c();a(),d("loading",e.isLoadingMore())}}function Se(r,o){if(r&1){let e=v();i(0,"app-followup-input-modal",26),g("closed",function(){p(e);let n=c();return m(n.onModalClosed())})("saved",function(){p(e);let n=c();return m(n.onModalSaved())}),l()}if(r&2){let e=c();d("item",e.selectedItem())("isOpen",e.isModalOpen())}}function Pe(r,o){if(r&1&&(i(0,"div",21),C(1,"app-toast",27),l()),r&2){let e=c();a(),d("variant",e.toastVariant())("message",e.toastMessage())}}var de=class r{followupService=w(E);weeklyFocusService=w(ae);router=w(z);items=y([]);total=y(0);isLoading=y(!0);isLoadingMore=y(!1);errorMessage=y(null);selectedItem=y(null);isModalOpen=y(!1);statusFilter=y("\u672A\u7740\u624B,\u9032\u884C\u4E2D");itemTypeFilter=y("\u3059\u3079\u3066");weeklyFocusMap=new Map;weeklyFocusCount=y(0);addingToWeeklyFocusItemId=y(null);toastMessage=y(null);toastVariant=y("success");offset=0;limit=20;subscription;ngOnInit(){this.loadItems(),this.loadWeeklyFocuses()}ngOnDestroy(){this.subscription?.unsubscribe()}getSelectValue(o){return o.target.value}getItemTypeValue(o){return o.target.value}loadItems(o=!0){o?(this.offset=0,this.isLoading.set(!0)):this.isLoadingMore.set(!0),this.errorMessage.set(null);let e=this.statusFilter(),t=this.itemTypeFilter(),n=t==="\u3059\u3079\u3066"?void 0:t,f=this.followupService.getFollowupItems({status:e,itemType:n,limit:this.limit,offset:this.offset}),u=this.weeklyFocusService.getCurrentWeekFocuses();this.subscription=W({followupItems:f,weeklyFocuses:u}).subscribe({next:({followupItems:M,weeklyFocuses:pe})=>{this.updateWeeklyFocusMap(pe),o?this.items.set(M.data):this.items.update(me=>[...me,...M.data]),this.total.set(M.total),this.offset+=M.data.length,this.isLoading.set(!1),this.isLoadingMore.set(!1)},error:()=>{this.errorMessage.set("\u30D5\u30A9\u30ED\u30FC\u9805\u76EE\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),this.isLoading.set(!1),this.isLoadingMore.set(!1)}})}loadWeeklyFocuses(){this.subscription=this.weeklyFocusService.getCurrentWeekFocuses().subscribe({next:o=>{this.updateWeeklyFocusMap(o)},error:()=>{}})}updateWeeklyFocusMap(o){this.weeklyFocusMap.clear(),o.forEach(e=>{let t=`${e.itemType}-${e.itemId}`;this.weeklyFocusMap.set(t,e.id)}),this.weeklyFocusCount.set(o.length)}isInWeeklyFocus(o){let e=`${o.itemType}-${o.item.id}`;return this.weeklyFocusMap.has(e)}isWeeklyFocusLimitReached(){return this.weeklyFocusCount()>=5}isAddingToWeeklyFocusCheck(o){let e=`${o.itemType}-${o.item.id}`;return this.addingToWeeklyFocusItemId()===e}onStatusFilterChange(o){this.statusFilter.set(o),this.loadItems()}onItemTypeFilterChange(o){this.itemTypeFilter.set(o),this.loadItems()}onLoadMore(){this.loadItems(!1)}onCardClick(o){this.router.navigate(["/daily-reports",o])}onFollowupClick(o){this.router.navigate(["/followups",o.itemType,o.item.id])}onModalClosed(){this.isModalOpen.set(!1),this.selectedItem.set(null)}onModalSaved(){this.loadItems(!0),this.onModalClosed()}getWeeklyFocusId(o){let e=`${o.itemType}-${o.item.id}`;return this.weeklyFocusMap.get(e)||null}onToggleWeeklyFocus(o){let e=`${o.itemType}-${o.item.id}`,t=this.weeklyFocusMap.get(e);t?this.onRemoveFromWeeklyFocus(o,t):this.onAddToWeeklyFocus(o)}onAddToWeeklyFocus(o){if(this.isWeeklyFocusLimitReached()){this.showToast("\u4ECA\u9031\u306E\u30D5\u30A9\u30FC\u30AB\u30B9\u306F\u6700\u59275\u4EF6\u307E\u3067\u8A2D\u5B9A\u3067\u304D\u307E\u3059","error");return}this.addingToWeeklyFocusItemId.set(`${o.itemType}-${o.item.id}`),this.toastMessage.set(null),this.subscription=this.weeklyFocusService.addWeeklyFocus({itemType:o.itemType,itemId:o.item.id}).subscribe({next:()=>{this.showToast("\u4ECA\u9031\u306E\u30D5\u30A9\u30FC\u30AB\u30B9\u306B\u8FFD\u52A0\u3057\u307E\u3057\u305F","success"),this.loadWeeklyFocuses(),this.loadItems(!0),this.addingToWeeklyFocusItemId.set(null)},error:e=>{let t=e.error?.message||"\u9031\u6B21\u30D5\u30A9\u30FC\u30AB\u30B9\u306E\u8FFD\u52A0\u306B\u5931\u6557\u3057\u307E\u3057\u305F";this.showToast(t,"error"),this.addingToWeeklyFocusItemId.set(null)}})}onRemoveFromWeeklyFocus(o,e){let t=`${o.itemType}-${o.item.id}`;this.addingToWeeklyFocusItemId.set(t),this.toastMessage.set(null),this.subscription=this.weeklyFocusService.deleteWeeklyFocus(e).subscribe({next:()=>{this.showToast("\u4ECA\u9031\u306E\u30D5\u30A9\u30FC\u30AB\u30B9\u304B\u3089\u524A\u9664\u3057\u307E\u3057\u305F","success"),this.loadWeeklyFocuses(),this.loadItems(!0),this.addingToWeeklyFocusItemId.set(null)},error:n=>{let f=n.error?.message||"\u9031\u6B21\u30D5\u30A9\u30FC\u30AB\u30B9\u306E\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F";this.showToast(f,"error"),this.addingToWeeklyFocusItemId.set(null)}})}showToast(o,e){this.toastMessage.set(o),this.toastVariant.set(e),setTimeout(()=>{this.toastMessage.set(null)},3e3)}onToastDismiss(){this.toastMessage.set(null)}get hasMore(){return this.items().length<this.total()}get isEmpty(){return!this.isLoading()&&this.items().length===0}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-followup-list-page"]],decls:35,vars:9,consts:[[1,"followup-list-page"],[1,"followup-list-page__header"],["routerLink","/home","aria-label","\u623B\u308B",1,"followup-list-page__back"],[1,"followup-list-page__title"],[1,"followup-list-page__filters"],[1,"followup-list-page__filter",3,"change","value"],["value","\u672A\u7740\u624B,\u9032\u884C\u4E2D"],["value","\u3059\u3079\u3066"],["value","\u672A\u7740\u624B"],["value","\u9032\u884C\u4E2D"],["value","\u5B9A\u7740,\u7FD2\u6163\u5316"],["value","\u518D\u73FE\u3067\u304D\u305A,\u672A\u9054\u6210"],["value","goodPoint"],["value","improvement"],[1,"followup-list-page__content"],["variant","error",3,"message","dismissible"],[1,"followup-list-page__loading"],["iconName","alert-triangle","iconColor","var(--color-error-500)","message","\u30D5\u30A9\u30ED\u30FC\u3059\u308B\u9805\u76EE\u304C\u3042\u308A\u307E\u305B\u3093","subMessage","\u65E5\u5831\u3092\u5165\u529B\u3057\u3066\u3001\u3088\u304B\u3063\u305F\u3053\u3068\u3084\u6539\u5584\u70B9\u3092\u8A18\u9332\u3057\u307E\u3057\u3087\u3046","actionButtonText","\u65E5\u5831\u3092\u66F8\u304F","actionButtonRoute","/daily-reports/new","actionButtonIcon","plus"],[1,"followup-list-page__list"],[1,"followup-list-page__load-more"],[3,"item","isOpen"],[1,"followup-list-page__toast"],["variant","error",3,"dismissed","message","dismissible"],[3,"item","isInWeeklyFocus","isAddingToWeeklyFocus","isWeeklyFocusLimitReached"],[3,"cardClick","followupClick","toggleWeeklyFocus","item","isInWeeklyFocus","isAddingToWeeklyFocus","isWeeklyFocusLimitReached"],["variant","secondary","ariaLabel","\u3082\u3063\u3068\u898B\u308B",3,"clicked","loading"],[3,"closed","saved","item","isOpen"],[3,"variant","message"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"header",1)(2,"button",2),s(3," \u2190 "),l(),i(4,"h1",3),s(5,"\u30D5\u30A9\u30ED\u30FC\u9805\u76EE"),l()(),i(6,"div",4)(7,"select",5),g("change",function(f){return t.onStatusFilterChange(t.getSelectValue(f))}),i(8,"option",6),s(9,"\u672A\u5B8C\u4E86"),l(),i(10,"option",7),s(11,"\u3059\u3079\u3066"),l(),i(12,"option",8),s(13,"\u672A\u7740\u624B"),l(),i(14,"option",9),s(15,"\u9032\u884C\u4E2D"),l(),i(16,"option",10),s(17,"\u6210\u529F"),l(),i(18,"option",11),s(19,"\u5931\u6557"),l()(),i(20,"select",5),g("change",function(f){return t.onItemTypeFilterChange(t.getItemTypeValue(f))}),i(21,"option",7),s(22,"\u3059\u3079\u3066"),l(),i(23,"option",12),s(24,"\u3088\u304B\u3063\u305F\u3053\u3068"),l(),i(25,"option",13),s(26,"\u6539\u5584\u70B9"),l()()(),i(27,"div",14),b(28,he,1,2,"app-alert-banner",15)(29,xe,2,0,"div",16)(30,ke,1,0,"app-empty-state",17)(31,Te,3,0,"div",18)(32,Ie,3,1,"div",19),l(),b(33,Se,1,2,"app-followup-input-modal",20)(34,Pe,2,2,"div",21),l()),e&2&&(a(7),d("value",t.statusFilter()),a(13),d("value",t.itemTypeFilter()),a(8),_(t.errorMessage()?28:-1),a(),_(t.isLoading()?29:-1),a(),_(t.isEmpty?30:-1),a(),_(!t.isLoading()&&!t.isEmpty?31:-1),a(),_(t.hasMore&&!t.isLoading()?32:-1),a(),_(t.selectedItem()?33:-1),a(),_(t.toastMessage()?34:-1))},dependencies:[R,O,L,k,Y,le,oe],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--color-primary-50: #fffbeb;--color-primary-100: #fef3c7;--color-primary-200: #fde68a;--color-primary-300: #fcd34d;--color-primary-400: #fbbf24;--color-primary-500: #f59e0b;--color-primary-600: #d97706;--color-primary-700: #b45309;--color-primary-800: #92400e;--color-primary-900: #78350f;--color-secondary-50: #f0fdfa;--color-secondary-100: #ccfbf1;--color-secondary-200: #99f6e4;--color-secondary-300: #5eead4;--color-secondary-400: #2dd4bf;--color-secondary-500: #14b8a6;--color-secondary-600: #0d9488;--color-secondary-700: #0f766e;--color-secondary-800: #115e59;--color-secondary-900: #134e4a;--color-gray-50: #f9fafb;--color-gray-100: #f3f4f6;--color-gray-200: #e5e7eb;--color-gray-300: #d1d5db;--color-gray-400: #9ca3af;--color-gray-500: #6b7280;--color-gray-600: #4b5563;--color-gray-700: #374151;--color-gray-800: #1f2937;--color-gray-900: #111827;--color-success-50: #ecfdf5;--color-success-100: #d1fae5;--color-success-500: #10b981;--color-success-600: #059669;--color-success-700: #047857;--color-warning-50: #fffbeb;--color-warning-100: #fef3c7;--color-warning-500: #f59e0b;--color-warning-600: #d97706;--color-warning-700: #b45309;--color-error-50: #fef2f2;--color-error-100: #fee2e2;--color-error-500: #ef4444;--color-error-600: #dc2626;--color-error-700: #b91c1c;--color-info-50: #eff6ff;--color-info-100: #dbeafe;--color-info-500: #3b82f6;--color-info-600: #2563eb;--color-info-700: #1d4ed8;--color-bg-primary: #ffffff;--color-bg-secondary: #ffffff;--color-bg-tertiary: #ffffff;--color-text-primary: var(--color-gray-900);--color-text-secondary: var(--color-gray-600);--color-text-tertiary: var(--color-gray-500);--color-text-disabled: var(--color-gray-400);--color-text-inverse: #ffffff;--color-border-default: var(--color-gray-200);--color-border-hover: var(--color-gray-300);--color-border-focus: var(--color-primary-500);--color-border-error: var(--color-error-500)}.followup-list-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;background-color:var(--color-bg-secondary)}.followup-list-page__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background-color:var(--color-bg-primary);border-bottom:1px solid var(--color-border-default)}.followup-list-page__back[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;color:var(--color-text-primary);cursor:pointer;padding:.25rem;transition:opacity .2s}.followup-list-page__back[_ngcontent-%COMP%]:hover{opacity:.7}.followup-list-page__title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600;color:var(--color-text-primary)}.followup-list-page__filters[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding:1rem;background-color:var(--color-bg-primary);border-bottom:1px solid var(--color-border-default)}.followup-list-page__filter[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid var(--color-border-default);border-radius:.375rem;font-size:.875rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);cursor:pointer}.followup-list-page__filter[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-border-focus)}.followup-list-page__content[_ngcontent-%COMP%]{flex:1;padding:1rem;display:flex;flex-direction:column;gap:1rem}.followup-list-page__loading[_ngcontent-%COMP%], .followup-list-page__empty[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;text-align:center}.followup-list-page__empty-message[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.125rem;font-weight:500;color:var(--color-text-primary);line-height:1.6}.followup-list-page__empty-submessage[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:.9375rem;color:var(--color-text-secondary);line-height:1.6}.followup-list-page__list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.followup-list-page__load-more[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:1rem 0}.followup-list-page__toast[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;z-index:1000;animation:_ngcontent-%COMP%_slideIn .3s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@media (max-width: 768px){.followup-list-page__toast[_ngcontent-%COMP%]{top:1rem;right:1rem;left:1rem}}']})};export{de as FollowupListPageComponent};
