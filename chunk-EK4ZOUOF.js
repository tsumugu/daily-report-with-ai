import{a as Q}from"./chunk-IRG3K2SF.js";import{h as K}from"./chunk-67QQE4MI.js";import{a as z,b as J}from"./chunk-EHRPYQYN.js";import{b as C,c as L,d as G,e as B,f as T,g as V,k as N,l as $,n as q,o as W,p as j}from"./chunk-BNY3RDUL.js";import"./chunk-IY3UEH2H.js";import"./chunk-S7Y6GWYN.js";import{a as H,b as X}from"./chunk-GCOMOK3V.js";import{q as R,s as k,t as A}from"./chunk-H77UF764.js";import{$ as m,$a as M,Ba as r,Ka as O,Pa as I,S as v,Wa as s,Ya as E,_ as p,_a as b,aa as D,ab as w,ba as S,bb as F,cb as a,db as l,eb as h,fb as x,ib as c,jb as d,na as f,pb as _}from"./chunk-TUMKYTCV.js";import{a as y,b as P}from"./chunk-4CLCTAJ7.js";function Y(u,i){u&1&&(a(0,"div",6),h(1,"div",9),a(2,"p"),_(3,"\u8AAD\u307F\u8FBC\u307F\u4E2D..."),l()())}function Z(u,i){if(u&1){let e=x();a(0,"app-alert-banner",10),c("dismissed",function(){p(e);let t=d();return m(t.errorMessage.set(null))}),l()}if(u&2){let e=d();s("message",e.errorMessage())("dismissible",!0)}}function ee(u,i){if(u&1){let e=x();a(0,"app-form-card",27),c("removed",function(){let t=p(e).$index,n=d(2);return m(n.removeGoodPoint(t))}),a(1,"div",28)(2,"app-textarea-field",29),c("valueChange",function(t){let n=p(e).$index,g=d(2);return m(g.updateGoodPoint(n,"content",t))}),l()(),a(3,"div",28)(4,"app-textarea-field",30),c("valueChange",function(t){let n=p(e).$index,g=d(2);return m(g.updateGoodPoint(n,"factors",t))}),l()()()}if(u&2){let e=i.$implicit,o=i.$index,t=d(2);r(2),s("label","\u5185\u5BB9")("id","good-point-content-"+o)("maxLength",t.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.content),r(2),s("label","\u8981\u56E0\u30FB\u80CC\u666F")("id","good-point-factors-"+o)("maxLength",t.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.factors)}}function te(u,i){if(u&1){let e=x();a(0,"app-form-card",27),c("removed",function(){let t=p(e).$index,n=d(2);return m(n.removeImprovement(t))}),a(1,"div",28)(2,"app-textarea-field",31),c("valueChange",function(t){let n=p(e).$index,g=d(2);return m(g.updateImprovement(n,"content",t))}),l()(),a(3,"div",28)(4,"app-textarea-field",32),c("valueChange",function(t){let n=p(e).$index,g=d(2);return m(g.updateImprovement(n,"action",t))}),l()()()}if(u&2){let e=i.$implicit,o=i.$index,t=d(2);r(2),s("label","\u6539\u5584\u3057\u305F\u3044\u3053\u3068")("id","improvement-content-"+o)("maxLength",t.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.content),r(2),s("label","\u30A2\u30AF\u30B7\u30E7\u30F3")("id","improvement-action-"+o)("maxLength",t.MAX_LENGTH)("rows",2)("showCharCount",!1)("value",e.action)}}function ne(u,i){if(u&1){let e=x();a(0,"form",11),c("ngSubmit",function(){p(e);let t=d();return m(t.onSubmit())}),h(1,"app-date-field",12),a(2,"app-goal-multi-select-field",13),c("valueChange",function(t){p(e);let n=d();return m(n.selectedGoalIds.set(t))}),l(),h(3,"app-textarea-field",14)(4,"app-textarea-field",15),a(5,"fieldset",16)(6,"legend",17)(7,"span",18),h(8,"app-icon",19),l(),_(9," \u3088\u304B\u3063\u305F\u3053\u3068 "),l(),w(10,ee,5,12,"app-form-card",20,M),a(12,"div",21)(13,"app-button",22),c("clicked",function(){p(e);let t=d();return m(t.addGoodPoint())}),_(14,"\u8FFD\u52A0"),l()()(),a(15,"fieldset",16)(16,"legend",17)(17,"span",18),h(18,"app-icon",23),l(),_(19," \u6539\u5584\u70B9/\u30A2\u30AF\u30B7\u30E7\u30F3 "),l(),w(20,te,5,12,"app-form-card",20,M),a(22,"div",21)(23,"app-button",22),c("clicked",function(){p(e);let t=d();return m(t.addImprovement())}),_(24,"\u8FFD\u52A0"),l()()(),a(25,"div",24)(26,"app-button",25),c("clicked",function(){p(e);let t=d();return m(t.onCancel())}),_(27," \u30AD\u30E3\u30F3\u30BB\u30EB "),l(),a(28,"app-button",26),_(29," \u4FDD\u5B58\u3059\u308B "),l()()()}if(u&2){let e,o,t,n=d();s("formGroup",n.form),r(),s("required",!0)("errorMessage",n.getFieldError("date")||"")("touched",((e=n.form.get("date"))==null?null:e.touched)||!1)("submitted",n.isSubmitted()),r(),s("value",n.selectedGoalIds()),r(),s("labelIcon","file-text")("required",!0)("maxLength",n.MAX_LENGTH)("rows",4)("errorMessage",n.getFieldError("events")||"")("touched",((o=n.form.get("events"))==null?null:o.touched)||!1)("submitted",n.isSubmitted()),r(),s("labelIcon","lightbulb")("maxLength",n.MAX_LENGTH)("rows",3)("touched",((t=n.form.get("learnings"))==null?null:t.touched)||!1)("submitted",n.isSubmitted()),r(),E("form-group--empty",n.goodPoints().length===0),r(3),s("size",20),r(2),F(n.goodPoints()),r(3),s("fullWidth",!0),r(2),E("form-group--empty",n.improvements().length===0),r(3),s("size",20),r(2),F(n.improvements()),r(3),s("fullWidth",!0),r(3),s("fullWidth",!0)("disabled",n.isSaving()),r(2),s("fullWidth",!0)("loading",n.isSaving())("disabled",n.isSaving())}}var U=class u{fb=v($);router=v(k);route=v(R);dailyReportService=v(Q);form;goodPoints=f([]);improvements=f([]);selectedGoalIds=f([]);reportId=null;isLoading=f(!0);isSaving=f(!1);errorMessage=f(null);isSubmitted=f(!1);MAX_LENGTH=1e3;constructor(){this.form=this.fb.group({date:["",[C.required]],events:["",[C.required,C.maxLength(this.MAX_LENGTH)]],learnings:["",[C.maxLength(this.MAX_LENGTH)]]})}ngOnInit(){let i=this.route.snapshot.paramMap.get("id");i?(this.reportId=i,this.loadReport(i)):(this.errorMessage.set("\u65E5\u5831ID\u304C\u6307\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093"),this.isLoading.set(!1))}loadReport(i){this.isLoading.set(!0),this.errorMessage.set(null),this.dailyReportService.getById(i).subscribe({next:e=>{this.form.patchValue({date:e.date,events:e.events,learnings:e.learnings||""}),this.goodPoints.set(e.goodPoints.map(o=>({content:o.content,factors:o.factors||""}))),this.improvements.set(e.improvements.map(o=>({content:o.content,action:o.action||""}))),this.selectedGoalIds.set(e.goals.map(o=>o.id)),this.isLoading.set(!1)},error:e=>{this.isLoading.set(!1),e.status===404?this.errorMessage.set("\u65E5\u5831\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093"):e.status===403?this.errorMessage.set("\u3053\u306E\u65E5\u5831\u3078\u306E\u30A2\u30AF\u30BB\u30B9\u6A29\u9650\u304C\u3042\u308A\u307E\u305B\u3093"):this.errorMessage.set(e.error?.message||"\u65E5\u5831\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}})}addGoodPoint(){this.goodPoints.update(i=>[...i,{content:"",factors:""}])}removeGoodPoint(i){this.goodPoints.update(e=>e.filter((o,t)=>t!==i))}updateGoodPoint(i,e,o){this.goodPoints.update(t=>t.map((n,g)=>g===i?P(y({},n),{[e]:o}):n))}addImprovement(){this.improvements.update(i=>[...i,{content:"",action:""}])}removeImprovement(i){this.improvements.update(e=>e.filter((o,t)=>t!==i))}updateImprovement(i,e,o){this.improvements.update(t=>t.map((n,g)=>g===i?P(y({},n),{[e]:o}):n))}onCancel(){this.router.navigate(["/daily-reports",this.reportId])}onSubmit(){if(this.isSubmitted.set(!0),this.form.invalid){this.form.markAllAsTouched();return}if(!this.reportId){this.errorMessage.set("\u65E5\u5831ID\u304C\u6307\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093");return}this.isSaving.set(!0),this.errorMessage.set(null);let i={date:this.form.get("date")?.value,events:this.form.get("events")?.value,learnings:this.form.get("learnings")?.value||void 0,goalIds:this.selectedGoalIds().length>0?this.selectedGoalIds():void 0,goodPoints:this.goodPoints().filter(e=>e.content.trim()).map(e=>({content:e.content,factors:e.factors||void 0})),improvements:this.improvements().filter(e=>e.content.trim()).map(e=>({content:e.content,action:e.action||void 0}))};this.dailyReportService.update(this.reportId,i).subscribe({next:()=>{this.isSaving.set(!1),this.router.navigate(["/daily-reports",this.reportId])},error:e=>{this.isSaving.set(!1),this.errorMessage.set(e.error?.message||"\u65E5\u5831\u306E\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u3082\u3046\u4E00\u5EA6\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002")}})}getFieldError(i){let e=this.form.get(i);return!e||!e.errors||!e.touched&&!this.isSubmitted()?null:e.errors.required?"\u3053\u306E\u9805\u76EE\u306F\u5FC5\u9808\u3067\u3059":e.errors.maxlength?`${this.MAX_LENGTH}\u6587\u5B57\u4EE5\u5185\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044`:null}static \u0275fac=function(e){return new(e||u)};static \u0275cmp=O({type:u,selectors:[["app-daily-report-edit-page"]],decls:10,vars:3,consts:[[1,"daily-report-edit"],[1,"header"],["routerLink","/daily-reports",1,"back-link"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","m15 18-6-6 6-6"],[1,"title"],[1,"loading-container"],["variant","error",3,"message","dismissible"],[1,"form",3,"formGroup"],[1,"spinner"],["variant","error",3,"dismissed","message","dismissible"],[1,"form",3,"ngSubmit","formGroup"],["label","\u65E5\u4ED8","id","date","formControlName","date",3,"required","errorMessage","touched","submitted"],["label","\u95A2\u9023\u3059\u308B\u76EE\u6A19","placeholder","\u76EE\u6A19\u3092\u9078\u629E",3,"valueChange","value"],["label","\u3067\u304D\u3054\u3068","id","events","formControlName","events","placeholder","\u4ECA\u65E5\u306E\u4E3B\u306A\u696D\u52D9\u5185\u5BB9\u3001\u51FA\u6765\u4E8B\u3092\u8A18\u5165\u3057\u3066\u304F\u3060\u3055\u3044",3,"labelIcon","required","maxLength","rows","errorMessage","touched","submitted"],["label","\u5B66\u3073","id","learnings","formControlName","learnings","placeholder","\u696D\u52D9\u3092\u901A\u3058\u3066\u5F97\u305F\u6C17\u3065\u304D\u3001\u5B66\u3073\u3092\u8A18\u5165\u3057\u3066\u304F\u3060\u3055\u3044",3,"labelIcon","maxLength","rows","touched","submitted"],[1,"form-group","form-group--no-border"],[1,"label"],[1,"label-icon"],["name","heart","color","var(--color-primary-500)","ariaLabel","\u3088\u304B\u3063\u305F\u3053\u3068",3,"size"],[1,"form-group__card"],[1,"form-group__add-button"],["variant","secondary","icon","plus",3,"clicked","fullWidth"],["name","file-text","color","var(--color-primary-500)","ariaLabel","\u6539\u5584\u70B9",3,"size"],[1,"form-actions"],["type","button","variant","secondary",3,"clicked","fullWidth","disabled"],["type","submit","variant","primary",3,"fullWidth","loading","disabled"],[1,"form-group__card",3,"removed"],[1,"card-field"],["placeholder","\u3046\u307E\u304F\u3044\u3063\u305F\u3053\u3068\u3001\u6210\u529F\u4F53\u9A13",3,"valueChange","label","id","maxLength","rows","showCharCount","value"],["placeholder","\u306A\u305C\u3046\u307E\u304F\u3044\u3063\u305F\u304B",3,"valueChange","label","id","maxLength","rows","showCharCount","value"],["placeholder","\u6539\u5584\u3057\u305F\u3044\u70B9\u3001\u8AB2\u984C",3,"valueChange","label","id","maxLength","rows","showCharCount","value"],["placeholder","\u660E\u65E5\u4EE5\u964D\u306B\u8A66\u3057\u305F\u3044\u3053\u3068",3,"valueChange","label","id","maxLength","rows","showCharCount","value"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"header",1)(2,"a",2),D(),a(3,"svg",3),h(4,"path",4),l()(),S(),a(5,"h1",5),_(6,"\u65E5\u5831\u3092\u7DE8\u96C6"),l()(),I(7,Y,4,0,"div",6)(8,Z,1,2,"app-alert-banner",7)(9,ne,30,31,"form",8),l()),e&2&&(r(7),b(o.isLoading()?7:-1),r(),b(o.errorMessage()?8:-1),r(),b(o.isLoading()?-1:9))},dependencies:[q,B,L,G,N,T,V,A,X,z,W,j,J,H,K],styles:[".daily-report-edit[_ngcontent-%COMP%]{min-height:100vh;background:var(--color-bg-secondary);padding-bottom:100px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 20px;background:var(--color-bg-primary);border-bottom:1px solid var(--color-gray-200);position:sticky;top:0;z-index:100}.back-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;color:var(--color-gray-700);transition:background-color .2s}.back-link[_ngcontent-%COMP%]:hover{background:var(--color-gray-100)}.title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--color-gray-900);margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:var(--color-gray-600)}.loading-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--color-gray-200);border-top-color:var(--color-primary-500);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.form[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:24px 20px}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:32px}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form[_ngcontent-%COMP%]   app-date-field[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   app-textarea-field[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   app-goal-multi-select-field[_ngcontent-%COMP%]{display:block;margin-bottom:32px}.form-group[_ngcontent-%COMP%]{margin-bottom:32px;border:none;padding:0}.form-group--no-border[_ngcontent-%COMP%]{border:none;padding:0;margin:0 0 32px}.form-group[_ngcontent-%COMP%]     app-form-card.form-group__card{display:block;margin-bottom:24px}.form-group[_ngcontent-%COMP%]     app-form-card.form-group__card:last-of-type{margin-bottom:0}.form-group__add-button[_ngcontent-%COMP%]{margin-top:24px}.form-group--empty[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:4px}.form-group--empty[_ngcontent-%COMP%]   .form-group__add-button[_ngcontent-%COMP%]{margin-top:0}.label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.95rem;font-weight:600;color:var(--color-gray-800);margin-bottom:16px;padding:0}.label-icon[_ngcontent-%COMP%]{font-size:1.1rem}.card-field[_ngcontent-%COMP%]{margin-bottom:16px}.card-field[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-actions[_ngcontent-%COMP%]{display:flex;gap:12px;position:fixed;bottom:0;left:0;right:0;padding:16px 20px;background:var(--color-bg-primary);border-top:1px solid var(--color-gray-200);box-shadow:0 -2px 10px #0000000d}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{position:static;padding:24px 0 0;background:transparent;border-top:none;box-shadow:none}}app-alert-banner[_ngcontent-%COMP%]{display:block;margin:16px 20px 0;max-width:600px}@media (min-width: 640px){app-alert-banner[_ngcontent-%COMP%]{margin:16px auto 0}}"]})};export{U as DailyReportEditPageComponent};
